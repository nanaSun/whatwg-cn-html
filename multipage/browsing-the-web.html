<!DOCTYPE html><html class=split lang=en-US-x-hixie><script src=/html/link-fixup.js defer=""></script><meta charset=utf-8><meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name=viewport><title>HTML Standard</title><meta content=#3c790a name=theme-color><link rel=stylesheet href=https://resources.whatwg.org/spec.css crossorigin=""><link rel=stylesheet href=https://resources.whatwg.org/standard.css crossorigin=""><link rel=stylesheet href=https://resources.whatwg.org/standard-shared-with-dev.css crossorigin=""><link rel=icon href=https://resources.whatwg.org/logo.svg crossorigin=""><link rel=stylesheet href=/html/styles.css crossorigin=""><script>
   function toggleStatus(div) {
     div.parentNode.classList.toggle('wrapped');
   }
   function setLinkFragment(link) {
     link.hash = location.hash;
   }
  </script><link rel=stylesheet href=/html/resources/zh-cn.css><body>
  
  <script async="" crossorigin="" src=/html/resources/html-dfn.js></script>
  <script data-file-issue-url=https://github.com/whatwg/html/issues/new async="" crossorigin="" src=https://resources.whatwg.org/file-issue.js></script>
  
  <header id=head class="head with-buttons">
   <a href=https://whatwg.org/ class=logo><img width=100 alt=WHATWG crossorigin="" src=https://resources.whatwg.org/logo.svg height=100></a>
   <hgroup><h1 class=allcaps>HTML</h1><h2 id=living-standard class="no-num no-toc">Living Standard — Last Updated <span class=pubdate>17 May 2022</span></h2><div data-en-date="Sat Aug 11 2018 08:00:56 GMT+0000 (UTC)" class=translate-info data-zh-date="" data-en-file=https://github.com/whatwg-cn/html/blob/master/src/living-standard-mdash-last-updated-date-01-jan-1901.en.html data-zh-file="https://github.com/whatwg-cn/html/new/master/src/living-standard-mdash-last-updated-date-01-jan-1901.zh.html?filename=living-standard-mdash-last-updated-date-01-jan-1901.zh.html&amp;value=%E4%BB%8E%20https%3A%2F%2Fgithub.com%2Fwhatwg-cn%2Fhtml%2Fblob%2Fmaster%2Fsrc%2Fliving-standard-mdash-last-updated-date-01-jan-1901.en.html%20%E6%8B%B7%E8%B4%9D%E8%8B%B1%E6%96%87%E6%BA%90%E7%A0%81%E8%87%B3%E6%AD%A4%EF%BC%8C%E5%BC%80%E5%A7%8B%E7%BF%BB%E8%AF%91"></div><div data-en-date="Sat Aug 11 2018 08:00:56 GMT+0000 (UTC)" class=translate-info data-zh-date="" data-en-file=https://github.com/whatwg-cn/html/blob/master/src/commit-snapshot-mdash-last-updated-date-01-jan-1901.en.html data-zh-file="https://github.com/whatwg-cn/html/new/master/src/commit-snapshot-mdash-last-updated-date-01-jan-1901.zh.html?filename=commit-snapshot-mdash-last-updated-date-01-jan-1901.zh.html&amp;value=%E4%BB%8E%20https%3A%2F%2Fgithub.com%2Fwhatwg-cn%2Fhtml%2Fblob%2Fmaster%2Fsrc%2Fcommit-snapshot-mdash-last-updated-date-01-jan-1901.en.html%20%E6%8B%B7%E8%B4%9D%E8%8B%B1%E6%96%87%E6%BA%90%E7%A0%81%E8%87%B3%E6%AD%A4%EF%BC%8C%E5%BC%80%E5%A7%8B%E7%BF%BB%E8%AF%91"></div><div data-en-date="Sat Aug 11 2018 08:00:56 GMT+0000 (UTC)" class=translate-info data-zh-date="" data-en-file=https://github.com/whatwg-cn/html/blob/master/src/review-draft-mdash-published-date-01-jan-1901.en.html data-zh-file="https://github.com/whatwg-cn/html/new/master/src/review-draft-mdash-published-date-01-jan-1901.zh.html?filename=review-draft-mdash-published-date-01-jan-1901.zh.html&amp;value=%E4%BB%8E%20https%3A%2F%2Fgithub.com%2Fwhatwg-cn%2Fhtml%2Fblob%2Fmaster%2Fsrc%2Freview-draft-mdash-published-date-01-jan-1901.en.html%20%E6%8B%B7%E8%B4%9D%E8%8B%B1%E6%96%87%E6%BA%90%E7%A0%81%E8%87%B3%E6%AD%A4%EF%BC%8C%E5%BC%80%E5%A7%8B%E7%BF%BB%E8%AF%91"></div></hgroup>
   
   
   <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-91053840-1', 'auto');
      ga('send', 'pageview');
   </script>
  </header>

  

  


  
<div data-en-date="Thu Mar 01 2018 15:52:12 GMT+0000 (UTC)" class=translate-info data-zh-date="Thu Mar 01 2018 15:52:12 GMT+0000 (UTC)" data-en-file=https://github.com/whatwg-cn/html/blob/master/src/table-of-contents.en.html data-zh-file=https://github.com/whatwg-cn/html/edit/master/src/table-of-contents.zh.html></div>
  


  
<div data-en-date="Sat Aug 11 2018 08:00:56 GMT+0000 (UTC)" class=translate-info data-zh-date="Thu Mar 01 2018 15:52:12 GMT+0000 (UTC)" data-en-file=https://github.com/whatwg-cn/html/blob/master/src/full-table-of-contents.en.html data-zh-file=https://github.com/whatwg-cn/html/edit/master/src/full-table-of-contents.zh.html></div>
  

  

  


  <nav><a href=history.html>← 7.9 Session history and navigation</a> — <a href=./>Table of Contents</a> — <a href=offline.html>7.11 Offline web applications →</a></nav><ol class=toc><li id=toc-browsers><ol><li><a href=browsing-the-web.html#browsing-the-web><span class=secno>7.10</span> Browsing the web</a><ol><li><a href=browsing-the-web.html#navigating-across-documents><span class=secno>7.10.1</span> Navigating across documents</a><li><a href=browsing-the-web.html#read-html><span class=secno>7.10.2</span> HTML 文件的页面加载处理模型</a><li><a href=browsing-the-web.html#read-xml><span class=secno>7.10.3</span> XML 文件的页面加载处理模型</a><li><a href=browsing-the-web.html#read-text><span class=secno>7.10.4</span> 文本文件的页面加载处理模型</a><li><a href=browsing-the-web.html#read-multipart-x-mixed-replace><span class=secno>7.10.5</span>  <code>multipart/x-mixed-replace</code> 资源的媒体的页面加载处理模型</a><li><a href=browsing-the-web.html#read-media><span class=secno>7.10.6</span> 媒体的页面加载处理模型</a><li><a href=browsing-the-web.html#read-plugin><span class=secno>7.10.7</span> 使用插件的内容的页面加载处理模型</a><li><a href=browsing-the-web.html#read-ua-inline><span class=secno>7.10.8</span> 没有 DOM 的内联内容的页面加载处理模型</a><li><a href=browsing-the-web.html#scroll-to-fragid><span class=secno>7.10.9</span> Navigating to a fragment</a><li><a href=browsing-the-web.html#history-traversal><span class=secno>7.10.10</span> History traversal</a><ol><li><a href=browsing-the-web.html#persisted-user-state-restoration><span class=secno>7.10.10.1</span> Persisted history entry state</a><li><a href=browsing-the-web.html#the-popstateevent-interface><span class=secno>7.10.10.2</span> The <code>PopStateEvent</code> interface</a><li><a href=browsing-the-web.html#the-hashchangeevent-interface><span class=secno>7.10.10.3</span> The <code>HashChangeEvent</code> interface</a><li><a href=browsing-the-web.html#the-pagetransitionevent-interface><span class=secno>7.10.10.4</span> The <code>PageTransitionEvent</code> interface</a></ol><li><a href=browsing-the-web.html#loading-documents><span class=secno>7.10.11</span> Loading documents</a><li><a href=browsing-the-web.html#unloading-documents><span class=secno>7.10.12</span> Unloading documents</a><ol><li><a href=browsing-the-web.html#the-beforeunloadevent-interface><span class=secno>7.10.12.1</span> The <code>BeforeUnloadEvent</code> interface</a></ol><li><a href=browsing-the-web.html#aborting-a-document-load><span class=secno>7.10.13</span> Aborting a document load</a><li><a href=browsing-the-web.html#the-x-frame-options-header><span class=secno>7.10.14</span> The `<code>X-Frame-Options</code>` header</a></ol></ol></ol><h3 id=browsing-the-web><span class=secno>7.10</span> Browsing the web<a href=#browsing-the-web class=self-link></a></h3>
<div data-zh-date="" data-en-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" class=translate-info data-zh-file="https://github.com/whatwg-cn/html/new/master/src/loading-web-pages/browsing-the-web/index.zh.html?filename=index.zh.html&amp;value=%E4%BB%8E%20https%3A%2F%2Fgithub.com%2Fwhatwg-cn%2Fhtml%2Fblob%2Fmaster%2Fsrc%2Floading-web-pages%2Fbrowsing-the-web%2Findex.en.html%20%E6%8B%B7%E8%B4%9D%E8%8B%B1%E6%96%87%E6%BA%90%E7%A0%81%E8%87%B3%E6%AD%A4%EF%BC%8C%E5%BC%80%E5%A7%8B%E7%BF%BB%E8%AF%91" data-en-file=https://github.com/whatwg-cn/html/blob/master/src/loading-web-pages/browsing-the-web/index.en.html></div>

  


  <h4 id=navigating-across-documents><span class=secno>7.10.1</span> Navigating across documents<a href=#navigating-across-documents class=self-link></a></h4>
<div data-zh-date="" data-en-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" class=translate-info data-zh-file="https://github.com/whatwg-cn/html/new/master/src/loading-web-pages/browsing-the-web/navigating-across-documents.zh.html?filename=navigating-across-documents.zh.html&amp;value=%E4%BB%8E%20https%3A%2F%2Fgithub.com%2Fwhatwg-cn%2Fhtml%2Fblob%2Fmaster%2Fsrc%2Floading-web-pages%2Fbrowsing-the-web%2Fnavigating-across-documents.en.html%20%E6%8B%B7%E8%B4%9D%E8%8B%B1%E6%96%87%E6%BA%90%E7%A0%81%E8%87%B3%E6%AD%A4%EF%BC%8C%E5%BC%80%E5%A7%8B%E7%BF%BB%E8%AF%91" data-en-file=https://github.com/whatwg-cn/html/blob/master/src/loading-web-pages/browsing-the-web/navigating-across-documents.en.html></div>

  <p>Certain actions cause the <a id=navigating-across-documents:browsing-context href=browsers.html#browsing-context>browsing context</a> to <i id=navigating-across-documents:navigate><a href=#navigate>navigate</a></i> to
  a new resource. A user agent may provide various ways for the user to explicitly cause a browsing
  context to navigate, in addition to those defined in this specification.</p>

  <p class=example>For example, <a href=links.html#following-hyperlinks-2 id=navigating-across-documents:following-hyperlinks-2>following a hyperlink</a>,
  <a href=form-control-infrastructure.html#concept-form-submit id=navigating-across-documents:concept-form-submit>form submission</a>, and the <code id=navigating-across-documents:dom-open><a href=window-object.html#dom-open>window.open()</a></code> and <code id=navigating-across-documents:dom-location-assign><a href=history.html#dom-location-assign>location.assign()</a></code> methods can all cause a browsing context to
  navigate.</p>

  <p class=note>A <i>resource</i> has a URL, but that might not be the only information necessary
  to identify it. For example, a form submission that uses HTTP POST would also have the HTTP method
  and payload. Similarly, <a id=navigating-across-documents:an-iframe-srcdoc-document href=iframe-embed-object.html#an-iframe-srcdoc-document>an <code>iframe</code> <code>srcdoc</code> document</a> needs to know the data it is to use.</p>

  <p>Much of the navigation process is concerned with determining how to create a new
  <code id=navigating-across-documents:document><a href=dom.html#document>Document</a></code>, which ultimately happens in the <a href=#initialise-the-document-object id=navigating-across-documents:initialise-the-document-object>create and initialize a <code>Document</code> object</a>
  algorithm. The parameters to this algorithm are tracked via a <dfn id=navigation-params>navigation params</dfn>
  <a id=navigating-across-documents:struct href=https://infra.spec.whatwg.org/#struct data-x-internal=struct>struct</a>, which has the following <a href=https://infra.spec.whatwg.org/#struct-item id=navigating-across-documents:struct-item data-x-internal=struct-item>items</a>:</p>

  <dl><dt><dfn id=navigation-params-request>request</dfn><dd>null or a <a href=https://fetch.spec.whatwg.org/#concept-request id=navigating-across-documents:concept-request data-x-internal=concept-request>request</a> that started the navigation<dt><dfn id=navigation-params-response>response</dfn><dd>a <a href=https://fetch.spec.whatwg.org/#concept-response id=navigating-across-documents:concept-response data-x-internal=concept-response>response</a> that ultimately was navigated to
   (potentially a <a id=navigating-across-documents:network-error href=https://fetch.spec.whatwg.org/#concept-network-error data-x-internal=network-error>network error</a>)<dt><dfn id=navigation-params-origin>origin</dfn><dd>an <a id=navigating-across-documents:concept-origin href=origin.html#concept-origin>origin</a> to use for the new <code id=navigating-across-documents:document-2><a href=dom.html#document>Document</a></code><dt><dfn id=navigation-params-sandboxing>final sandboxing flag set</dfn><dd>a <a id=navigating-across-documents:sandboxing-flag-set href=origin.html#sandboxing-flag-set>sandboxing flag set</a> to impose on the new <code id=navigating-across-documents:document-3><a href=dom.html#document>Document</a></code><dt><dfn id=navigation-params-coop>cross-origin opener policy</dfn><dd>a <a id=navigating-across-documents:cross-origin-opener-policy href=origin.html#cross-origin-opener-policy>cross-origin opener policy</a> to use for the new <code id=navigating-across-documents:document-4><a href=dom.html#document>Document</a></code><dt><dfn id=navigation-params-reserved-environment>reserved environment</dfn><dd>null or an <a id=navigating-across-documents:environment href=webappapis.html#environment>environment</a> reserved for the new <code id=navigating-across-documents:document-5><a href=dom.html#document>Document</a></code><dt><dfn id=navigation-params-browsing-context>browsing context</dfn><dd>the <a id=navigating-across-documents:browsing-context-2 href=browsers.html#browsing-context>browsing context</a> to be navigated (but see below)<dt><dfn id=navigation-params-bc-switch-needed>browsing context switch needed</dfn><dd>a boolean indicating whether or not the navigation should conclude by <a href=window-object.html#a-browsing-context-is-discarded id=navigating-across-documents:a-browsing-context-is-discarded>discarding</a> the given <a href=#navigation-params-browsing-context id=navigating-across-documents:navigation-params-browsing-context>browsing context</a> and creating a new one<dt><dfn id=navigation-params-hh>history handling</dfn><dd>a <a href=#history-handling-behavior id=navigating-across-documents:history-handling-behavior>history handling behavior</a></dl>

  <p class=note>Once a <a href=#navigation-params id=navigating-across-documents:navigation-params>navigation params</a> struct is created, this standard does not
  mutate any of its <a href=https://infra.spec.whatwg.org/#struct-item id=navigating-across-documents:struct-item-2 data-x-internal=struct-item>items</a>. They are only passed onward to other
  algorithms.</p>

  <p>After <code id=navigating-across-documents:document-6><a href=dom.html#document>Document</a></code> creation, the <a id=navigating-across-documents:session-history href=history.html#session-history>session history</a> gets updated. A
  <dfn id=history-handling-behavior>history handling behavior</dfn> is used to track the desired type of session history update
  throughout the navigation process. It is one of the following:</p>

  <dl><dt>"<dfn id=hh-default><code>default</code></dfn>"<dd>A regular navigation which adds a new entry to the session history.<dt>"<dfn id=hh-entry-update><code>entry update</code></dfn>"<dd>A navigation to an existing <a id=navigating-across-documents:session-history-entry href=history.html#session-history-entry>session history entry</a> to recreate that entry's <a href=history.html#she-document id=navigating-across-documents:she-document>document</a>, which was previously <a href=window-object.html#discard-a-document id=navigating-across-documents:discard-a-document>discarded</a>.<dt>"<dfn id=hh-reload><code>reload</code></dfn>"<dd>A navigation intended to reload the current page and replace the <a href=history.html#current-entry id=navigating-across-documents:current-entry>current session history entry</a>.<dt>"<dfn id=hh-replace><code>replace</code></dfn>"<dd>A non-reload navigation that will replace the <a href=history.html#current-entry id=navigating-across-documents:current-entry-2>current session history entry</a>.</dl>

  <p>Navigation always involves <dfn id=source-browsing-context data-export="">source browsing context</dfn>, which is the browsing
  context which was responsible for starting the navigation.</p>

  <p class=XXX>As explained in <a href=https://github.com/whatwg/html/issues/1130>issue
  #1130</a> the use of a browsing context as source might not be the correct architecture.</p>

  
  
  <p>To <dfn id=navigate data-export="">navigate</dfn> a browsing context <var>browsingContext</var> to a resource
  <var>resource</var>, with an optional boolean <dfn id=exceptions-enabled data-export=""><var>exceptionsEnabled</var></dfn> (default false), an optional <a href=#history-handling-behavior id=navigating-across-documents:history-handling-behavior-2>history handling
  behavior</a> <dfn id=navigation-hh><var>historyHandling</var></dfn> (default "<code id=navigating-across-documents:hh-default><a href=#hh-default>default</a></code>"), and an optional string <dfn id=navigation-navigationtype><var>navigationType</var></dfn> (default "<code>other</code>"):</p>

  <ol><li><p>If <var>resource</var> is a <a id=navigating-across-documents:url href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a>, then set <var>resource</var> to a new <a href=https://fetch.spec.whatwg.org/#concept-request id=navigating-across-documents:concept-request-2 data-x-internal=concept-request>request</a> whose <a href=https://fetch.spec.whatwg.org/#concept-request-url id=navigating-across-documents:concept-request-url data-x-internal=concept-request-url>url</a> is
   <var>resource</var>.<li><p>If <var>resource</var> is a <a href=https://fetch.spec.whatwg.org/#concept-request id=navigating-across-documents:concept-request-3 data-x-internal=concept-request>request</a> and
   <var>historyHandling</var> is "<code id=navigating-across-documents:hh-reload><a href=#hh-reload>reload</a></code>", then set
   <var>resource</var>'s <a href=https://fetch.spec.whatwg.org/#concept-request-reload-navigation-flag id=navigating-across-documents:concept-request-reload-navigation-flag data-x-internal=concept-request-reload-navigation-flag>reload-navigation
   flag</a>.<li id=sandboxLinks>
    <p>If the <a href=#source-browsing-context id=navigating-across-documents:source-browsing-context>source browsing context</a> is not <a id=navigating-across-documents:allowed-to-navigate href=browsers.html#allowed-to-navigate>allowed to navigate</a>
    <var>browsingContext</var>, then:</p>

    <ol><li><p>If <var>exceptionsEnabled</var> is given and is true, then throw a
     <a id=navigating-across-documents:securityerror href=https://heycam.github.io/webidl/#securityerror data-x-internal=securityerror>"<code>SecurityError</code>"</a> <code id=navigating-across-documents:domexception><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>.<li>
      <p>Otherwise, the user agent may instead offer to open <var>resource</var> in a new
      <a id=navigating-across-documents:top-level-browsing-context href=browsers.html#top-level-browsing-context>top-level browsing context</a> or in the <a id=navigating-across-documents:top-level-browsing-context-2 href=browsers.html#top-level-browsing-context>top-level browsing context</a> of
      the <a href=#source-browsing-context id=navigating-across-documents:source-browsing-context-2>source browsing context</a>, at the user's option, in which case the user agent
      must <a href=#navigate id=navigating-across-documents:navigate-2>navigate</a> that designated <a id=navigating-across-documents:top-level-browsing-context-3 href=browsers.html#top-level-browsing-context>top-level
      browsing context</a> to <var>resource</var> as if the user had requested it
      independently.</p>

      <p class=note>Doing so, however, can be dangerous, as it means that the user is overriding
      the author's explicit request to sandbox the content.</p>
     </ol>
   <li><p>If there is a preexisting attempt to navigate <var>browsingContext</var>, and the
   <a href=#source-browsing-context id=navigating-across-documents:source-browsing-context-3>source browsing context</a> is the same as <var>browsingContext</var>, and that attempt
   is currently running the <a href=#unload-a-document id=navigating-across-documents:unload-a-document>unload a document</a> algorithm, then return without
   affecting the preexisting attempt to navigate <var>browsingContext</var>.<li><p>If the <a href=#prompt-to-unload-a-document id=navigating-across-documents:prompt-to-unload-a-document>prompt to unload</a> algorithm is being run for the <a id=navigating-across-documents:active-document href=browsers.html#active-document>active
   document</a> of <var>browsingContext</var>, then return without affecting the
   <a href=#prompt-to-unload-a-document id=navigating-across-documents:prompt-to-unload-a-document-2>prompt to unload</a> algorithm.<li id=navigate-fragid-step>
    <p>If <var>historyHandling</var> is not "<code id=navigating-across-documents:hh-reload-2><a href=#hh-reload>reload</a></code>",
    <var>resource</var> is a <a href=https://fetch.spec.whatwg.org/#concept-request id=navigating-across-documents:concept-request-4 data-x-internal=concept-request>request</a>, <var>resource</var>'s
    <a href=https://fetch.spec.whatwg.org/#concept-request-url id=navigating-across-documents:concept-request-url-2 data-x-internal=concept-request-url>url</a> <a href=https://url.spec.whatwg.org/#concept-url-equals id=navigating-across-documents:concept-url-equals data-x-internal=concept-url-equals>equals</a>
    <var>browsingContext</var>'s <a id=navigating-across-documents:active-document-2 href=browsers.html#active-document>active document</a>'s <a href=https://dom.spec.whatwg.org/#concept-document-url id=navigating-across-documents:the-document的-address data-x-internal=the-document的-address>URL</a> with <var>exclude fragments flag</var> set, and
    <var>resource</var>'s <a href=https://fetch.spec.whatwg.org/#concept-request-url id=navigating-across-documents:concept-request-url-3 data-x-internal=concept-request-url>url</a>'s <a href=https://url.spec.whatwg.org/#concept-url-fragment id=navigating-across-documents:concept-url-fragment data-x-internal=concept-url-fragment>fragment</a> is non-null, then:</p>

    <ol><li><p><a href=#navigate-fragid id=navigating-across-documents:navigate-fragid>Navigate to a fragment</a> given
     <var>browsingContext</var>, <var>resource</var>'s <a href=https://fetch.spec.whatwg.org/#concept-request-url id=navigating-across-documents:concept-request-url-4 data-x-internal=concept-request-url>url</a>, and <var>historyHandling</var>.<li><p>Return.</ol>
   <li><p>Let <var>activeDocumentNavigationOrigin</var> be the <a id=navigating-across-documents:concept-origin-2 href=origin.html#concept-origin>origin</a> of the
   <a id=navigating-across-documents:active-document-3 href=browsers.html#active-document>active document</a> of <var>browsingContext</var>.<li><p>Let <var>incumbentNavigationOrigin</var> be the <a id=navigating-across-documents:concept-origin-3 href=origin.html#concept-origin>origin</a> of the <a id=navigating-across-documents:incumbent-settings-object href=webappapis.html#incumbent-settings-object>incumbent
   settings object</a>, or if no <a id=navigating-across-documents:the-script-element href=scripting.html#the-script-element>script</a> was involved, the <a id=navigating-across-documents:concept-origin-4 href=origin.html#concept-origin>origin</a> of the
   <a id=navigating-across-documents:node-document href=https://dom.spec.whatwg.org/#concept-node-document data-x-internal=node-document>node document</a> of the element that initiated the <a href=#navigate id=navigating-across-documents:navigate-3>navigation</a>.<li><p>Cancel any preexisting but not yet <a href=#concept-navigate-mature id=navigating-across-documents:concept-navigate-mature>mature</a>
   attempt to navigate <var>browsingContext</var>, including canceling any instances of the <a href=https://fetch.spec.whatwg.org/#concept-fetch id=navigating-across-documents:concept-fetch data-x-internal=concept-fetch>fetch</a> algorithm started by those attempts. If one of those attempts
   has already <a href=#initialise-the-document-object id=navigating-across-documents:initialise-the-document-object-2>created and initialized a new
   <code>Document</code> object</a>, <a href=#abort-a-document id=navigating-across-documents:abort-a-document>abort</a> that
   <code id=navigating-across-documents:document-7><a href=dom.html#document>Document</a></code> also. (Navigation attempts that have <a href=#concept-navigate-mature id=navigating-across-documents:concept-navigate-mature-2>matured</a> already have session history entries, and are
   therefore handled during the <a href=#update-the-session-history-with-the-new-page id=navigating-across-documents:update-the-session-history-with-the-new-page>update the session history with the new page</a> algorithm,
   later.)<li>
    <p><a href=#prompt-to-unload-a-document id=navigating-across-documents:prompt-to-unload-a-document-3>Prompt to unload</a> the <a id=navigating-across-documents:active-document-4 href=browsers.html#active-document>active document</a> of <var>browsingContext</var>.
    If the user <a href=#refused-to-allow-the-document-to-be-unloaded id=navigating-across-documents:refused-to-allow-the-document-to-be-unloaded>refused to allow the document to be unloaded</a>, then return.</p>

    <p>If this instance of the <a href=#navigate id=navigating-across-documents:navigate-4>navigation</a> algorithm gets canceled
    while this step is running, the <a href=#prompt-to-unload-a-document id=navigating-across-documents:prompt-to-unload-a-document-4>prompt to unload</a> algorithm must nonetheless be run
    to completion.</p>
   <li><p><a href=#abort-a-document id=navigating-across-documents:abort-a-document-2>Abort</a> the <a id=navigating-across-documents:active-document-5 href=browsers.html#active-document>active document</a> of
   <var>browsingContext</var>.<li>
    <p>If <var>browsingContext</var> is a <a id=navigating-across-documents:child-browsing-context href=browsers.html#child-browsing-context>child browsing context</a>, then put it in the
    <a id=navigating-across-documents:delaying-load-events-mode href=browsers.html#delaying-load-events-mode>delaying <code>load</code> events mode</a>.</p>

    <p>The user agent must take this <a id=navigating-across-documents:child-browsing-context-2 href=browsers.html#child-browsing-context>child browsing context</a> out of the <a id=navigating-across-documents:delaying-load-events-mode-2 href=browsers.html#delaying-load-events-mode>delaying
    <code>load</code> events mode</a> when this <a href=#navigate id=navigating-across-documents:navigate-5>navigation</a> algorithm later <a href=#concept-navigate-mature id=navigating-across-documents:concept-navigate-mature-3>matures</a>, or when it terminates (whether due to having
    run all the steps, or being canceled, or being aborted), whichever happens first.</p>

    
   <li><p>Let <var>sandboxFlags</var> be the result of <a id=navigating-across-documents:determining-the-creation-sandboxing-flags href=origin.html#determining-the-creation-sandboxing-flags>determining the creation sandboxing
   flags</a> given <var>browsingContext</var> and <var>browsingContext</var>'s <a href=browsers.html#bc-container id=navigating-across-documents:bc-container>container</a>.<li><p>Return to whatever algorithm invoked the navigation steps and continue running these steps
   <a id=navigating-across-documents:in-parallel href=infrastructure.html#in-parallel>in parallel</a>.<li>
    <p>This is the step that attempts to obtain <var>resource</var>, if necessary. Jump to the first
    appropriate substep:</p>

    <dl><dt>If <var>resource</var> is a <a href=https://fetch.spec.whatwg.org/#concept-response id=navigating-across-documents:concept-response-2 data-x-internal=concept-response>response</a><dd>
      <ol><li><p>Assert: <var>browsingContext</var> is not a <a id=navigating-across-documents:top-level-browsing-context-4 href=browsers.html#top-level-browsing-context>top-level browsing
       context</a>.<li><p>Let <var>finalSandboxFlags</var> be the <a href=https://infra.spec.whatwg.org/#set-union id=navigating-across-documents:set-union data-x-internal=set-union>union</a> of
       <var>browsingContext</var>'s <a href=origin.html#concept-bc-sandboxing-flags id=navigating-across-documents:concept-bc-sandboxing-flags>sandboxing
       flags</a> and <var>resource</var>'s <a id=navigating-across-documents:forced-sandboxing-flag-set href=origin.html#forced-sandboxing-flag-set>forced sandboxing flag set</a>.<li><p>Let <var>responseOrigin</var> be the result of <a id=navigating-across-documents:determining-the-origin href=browsers.html#determining-the-origin>determining the origin</a>
       given <var>browsingContext</var>, <var>resource</var>'s <a href=https://fetch.spec.whatwg.org/#concept-response-url id=navigating-across-documents:concept-response-url data-x-internal=concept-response-url>url</a>, <var>finalSandboxFlags</var>,
       <var>incumbentNavigationOrigin</var>, and <var>activeDocumentNavigationOrigin</var>.<li><p>Let <var>navigationParams</var> be a new <a href=#navigation-params id=navigating-across-documents:navigation-params-2>navigation params</a> whose <a href=#navigation-params-request id=navigating-across-documents:navigation-params-request>request</a> is null, <a href=#navigation-params-response id=navigating-across-documents:navigation-params-response>response</a> is <var>resource</var>, <a href=#navigation-params-origin id=navigating-across-documents:navigation-params-origin>origin</a> is <var>responseOrigin</var>, <a href=#navigation-params-sandboxing id=navigating-across-documents:navigation-params-sandboxing>final sandboxing flag set</a> is
       <var>finalSandboxFlags</var>, <a href=#navigation-params-coop id=navigating-across-documents:navigation-params-coop>cross-origin opener
       policy</a> is "<code id=navigating-across-documents:coop-unsafe-none><a href=origin.html#coop-unsafe-none>unsafe-none</a></code>", <a href=#navigation-params-reserved-environment id=navigating-across-documents:navigation-params-reserved-environment>reserved environment</a> is null, <a href=#navigation-params-browsing-context id=navigating-across-documents:navigation-params-browsing-context-2>browsing context</a> is
       <var>browsingContext</var>, <a href=#navigation-params-bc-switch-needed id=navigating-across-documents:navigation-params-bc-switch-needed>browsing
       context switch needed</a> is false, and <a href=#navigation-params-hh id=navigating-across-documents:navigation-params-hh>history
       handling</a> is <var>historyHandling</var>.<li><p>Run <a href=#process-a-navigate-response id=navigating-across-documents:process-a-navigate-response>process a navigate response</a> with <var>navigationType</var>, the
       <a href=#source-browsing-context id=navigating-across-documents:source-browsing-context-4>source browsing context</a>, and <var>navigationParams</var>.</ol>
     <dt>If <var>resource</var> is a <a href=https://fetch.spec.whatwg.org/#concept-request id=navigating-across-documents:concept-request-5 data-x-internal=concept-request>request</a> whose <a href=https://fetch.spec.whatwg.org/#concept-request-url id=navigating-across-documents:concept-request-url-5 data-x-internal=concept-request-url>url</a>'s <a href=https://url.spec.whatwg.org/#concept-url-scheme id=navigating-across-documents:concept-url-scheme data-x-internal=concept-url-scheme>scheme</a>
     is "<code id=navigating-across-documents:javascript-protocol><a href=#javascript-protocol>javascript</a></code>"<dd>
      <p><a id=navigating-across-documents:queue-a-global-task href=webappapis.html#queue-a-global-task>Queue a global task</a> on the <a id=navigating-across-documents:dom-manipulation-task-source href=webappapis.html#dom-manipulation-task-source>DOM manipulation task source</a> given
      <var>browsingContext</var>'s <a id=navigating-across-documents:active-window href=browsers.html#active-window>active window</a> to run these steps:</p>

      <ol><li><p>Let <var>response</var> be the result of <a href=#javascript-protocol id=navigating-across-documents:javascript-protocol-2>executing
       a <code>javascript:</code> URL request</a> given <var>resource</var>, the <a href=#source-browsing-context id=navigating-across-documents:source-browsing-context-5>source
       browsing context</a>, and <var>browsingContext</var>.<li><p>Let <var>finalSandboxFlags</var> be the <a href=https://infra.spec.whatwg.org/#set-union id=navigating-across-documents:set-union-2 data-x-internal=set-union>union</a> of
       <var>browsingContext</var>'s <a href=origin.html#concept-bc-sandboxing-flags id=navigating-across-documents:concept-bc-sandboxing-flags-2>sandboxing
       flags</a> and <var>response</var>'s <a id=navigating-across-documents:forced-sandboxing-flag-set-2 href=origin.html#forced-sandboxing-flag-set>forced sandboxing flag set</a>.<li><p>Let <var>navigationParams</var> be a new <a href=#navigation-params id=navigating-across-documents:navigation-params-3>navigation params</a> whose <a href=#navigation-params-request id=navigating-across-documents:navigation-params-request-2>request</a> is <var>resource</var>, <a href=#navigation-params-response id=navigating-across-documents:navigation-params-response-2>response</a> is <var>response</var>, <a href=#navigation-params-origin id=navigating-across-documents:navigation-params-origin-2>origin</a> is <var>activeDocumentNavigationOrigin</var>,
       <a href=#navigation-params-sandboxing id=navigating-across-documents:navigation-params-sandboxing-2>final sandboxing flag set</a> is
       <var>finalSandboxFlags</var>, <a href=#navigation-params-coop id=navigating-across-documents:navigation-params-coop-2>cross-origin opener
       policy</a> is <var>browsingContext</var>'s <a id=navigating-across-documents:active-document-6 href=browsers.html#active-document>active document</a>'s <a href=dom.html#concept-document-coop id=navigating-across-documents:concept-document-coop>cross-origin opener policy</a>, <a href=#navigation-params-reserved-environment id=navigating-across-documents:navigation-params-reserved-environment-2>reserved environment</a> is null, <a href=#navigation-params-browsing-context id=navigating-across-documents:navigation-params-browsing-context-3>browsing context</a> is
       <var>browsingContext</var>, <a href=#navigation-params-bc-switch-needed id=navigating-across-documents:navigation-params-bc-switch-needed-2>browsing
       context switch needed</a> is false, and <a href=#navigation-params-hh id=navigating-across-documents:navigation-params-hh-2>history
       handling</a> is <var>historyHandling</var>.<li><p>Run <a href=#process-a-navigate-response id=navigating-across-documents:process-a-navigate-response-2>process a navigate response</a> with <var>navigationType</var>, the
       <a href=#source-browsing-context id=navigating-across-documents:source-browsing-context-6>source browsing context</a>, and <var>navigationParams</var>.</ol>

      <p class=example>So for example a <a href=#javascript-protocol id=navigating-across-documents:javascript-protocol-3><code>javascript:</code> URL</a> in an <code id=navigating-across-documents:attr-hyperlink-href><a href=links.html#attr-hyperlink-href>href</a></code> attribute of an <code id=navigating-across-documents:the-a-element><a href=text-level-semantics.html#the-a-element>a</a></code> element would only be
      evaluated when the link was <a href=links.html#following-hyperlinks-2 id=navigating-across-documents:following-hyperlinks-2-2>followed</a>, while such a
      URL in the <code id=navigating-across-documents:attr-iframe-src><a href=iframe-embed-object.html#attr-iframe-src>src</a></code> attribute of an <code id=navigating-across-documents:the-iframe-element><a href=iframe-embed-object.html#the-iframe-element>iframe</a></code>
      element would be evaluated in the context of the <code id=navigating-across-documents:the-iframe-element-2><a href=iframe-embed-object.html#the-iframe-element>iframe</a></code>'s <a id=navigating-across-documents:nested-browsing-context href=browsers.html#nested-browsing-context>nested browsing
      context</a> when the <code id=navigating-across-documents:the-iframe-element-3><a href=iframe-embed-object.html#the-iframe-element>iframe</a></code> is being set up. Once evaluated, its return value
      (if it was a string) would replace that <a id=navigating-across-documents:browsing-context-3 href=browsers.html#browsing-context>browsing context</a>'s <a id=navigating-across-documents:active-document-7 href=browsers.html#active-document>active
      document</a>, thus also changing the corresponding <code id=navigating-across-documents:window><a href=window-object.html#window>Window</a></code> object.</p>
     <dt>If <var>resource</var> is to be fetched using `<code>GET</code>`, and there are
     <a href=offline.html#relevant-application-cache id=navigating-across-documents:relevant-application-cache>relevant application caches</a> that are
     identified by a URL with the <a id=navigating-across-documents:same-origin href=origin.html#same-origin>same origin</a> as the URL in question, and that have
     this URL as one of their entries, excluding entries marked as <a href=offline.html#concept-appcache-foreign id=navigating-across-documents:concept-appcache-foreign>foreign</a>, and whose <a href=offline.html#concept-appcache-mode id=navigating-across-documents:concept-appcache-mode>mode</a> is <a href=offline.html#concept-appcache-mode-fast id=navigating-across-documents:concept-appcache-mode-fast>fast</a>, and the user agent is not in a mode where it
     will avoid using <a href=offline.html#application-cache id=navigating-across-documents:application-cache>application caches</a><dd>
      <p>Fetch <var>resource</var> from the <a href=offline.html#concept-appcache-selection id=navigating-across-documents:concept-appcache-selection>most
      appropriate application cache</a> of those that match.</p>

      <p class=example>For example, imagine an HTML page with an associated application cache
      displaying an image and a form, where the image is also used by several other application
      caches. If the user right-clicks on the image and chooses "View Image", then the user agent
      could decide to show the image from any of those caches, but it is likely that the most useful
      cache for the user would be the one that was used for the aforementioned HTML page. On the
      other hand, if the user submits the form, and the form does a POST submission, then the user
      agent will not use an application cache at all; the submission will be made to the
      network.</p>

      <p class=XXX>This still needs to be integrated with the Fetch standard. <a href=references.html#refsFETCH>[FETCH]</a></p>
     <dt>If <var>resource</var> is a <a href=https://fetch.spec.whatwg.org/#concept-request id=navigating-across-documents:concept-request-6 data-x-internal=concept-request>request</a> whose <a href=https://fetch.spec.whatwg.org/#concept-request-url id=navigating-across-documents:concept-request-url-6 data-x-internal=concept-request-url>url</a>'s <a href=https://url.spec.whatwg.org/#concept-url-scheme id=navigating-across-documents:concept-url-scheme-2 data-x-internal=concept-url-scheme>scheme</a>
     is a <a id=navigating-across-documents:fetch-scheme href=https://fetch.spec.whatwg.org/#fetch-scheme data-x-internal=fetch-scheme>fetch scheme</a><dd><p>Run <a href=#process-a-navigate-fetch id=navigating-across-documents:process-a-navigate-fetch>process a navigate fetch</a> given <var>resource</var>, the <a href=#source-browsing-context id=navigating-across-documents:source-browsing-context-7>source
     browsing context</a>, <var>browsingContext</var>, <var>navigationType</var>,
     <var>sandboxFlags</var>, <var>incumbentNavigationOrigin</var>,
     <var>activeDocumentNavigationOrigin</var>, and <var>historyHandling</var>.<dt>Otherwise, <var>resource</var> is a <a href=https://fetch.spec.whatwg.org/#concept-request id=navigating-across-documents:concept-request-7 data-x-internal=concept-request>request</a> whose
     <a href=https://fetch.spec.whatwg.org/#concept-request-url id=navigating-across-documents:concept-request-url-7 data-x-internal=concept-request-url>url</a>'s <a href=https://url.spec.whatwg.org/#concept-url-scheme id=navigating-across-documents:concept-url-scheme-3 data-x-internal=concept-url-scheme>scheme</a>
     is neither "<code id=navigating-across-documents:javascript-protocol-4><a href=#javascript-protocol>javascript</a></code>" nor a <a id=navigating-across-documents:fetch-scheme-2 href=https://fetch.spec.whatwg.org/#fetch-scheme data-x-internal=fetch-scheme>fetch
     scheme</a><dd><p>Run <a href=#process-a-navigate-url-scheme id=navigating-across-documents:process-a-navigate-url-scheme>process a navigate URL scheme</a> given <var>resource</var>'s <a href=https://fetch.spec.whatwg.org/#concept-request-url id=navigating-across-documents:concept-request-url-8 data-x-internal=concept-request-url>url</a> and <var>browsingContext</var>.</dl>
   </ol>

  <p>To <dfn id=process-a-navigate-fetch data-export="">process a navigate fetch</dfn>, given a <a href=https://fetch.spec.whatwg.org/#concept-request id=navigating-across-documents:concept-request-8 data-x-internal=concept-request>request</a> <var>request</var>, two <a href=browsers.html#browsing-context id=navigating-across-documents:browsing-context-4>browsing contexts</a> <var>sourceBrowsingContext</var> and <var>browsingContext</var>,
  a string <var>navigationType</var>, a <a id=navigating-across-documents:sandboxing-flag-set-2 href=origin.html#sandboxing-flag-set>sandboxing flag set</a> <var>sandboxFlags</var>,
  two <a href=origin.html#concept-origin id=navigating-across-documents:concept-origin-5>origins</a> <var>incumbentNavigationOrigin</var> and
  <var>activeDocumentNavigationOrigin</var>, and a <a href=#history-handling-behavior id=navigating-across-documents:history-handling-behavior-3>history handling behavior</a>
  <var>historyHandling</var>:</p>

  <ol><li><p>Let <var>response</var> be null.<li><p>Set <var>request</var>'s <a href=https://fetch.spec.whatwg.org/#concept-request-client id=navigating-across-documents:concept-request-client data-x-internal=concept-request-client>client</a> to
   <var>sourceBrowsingContext</var>'s <a id=navigating-across-documents:active-document-8 href=browsers.html#active-document>active document</a>'s <a id=navigating-across-documents:relevant-settings-object href=webappapis.html#relevant-settings-object>relevant settings
   object</a>, <a href=https://fetch.spec.whatwg.org/#concept-request-destination id=navigating-across-documents:concept-request-destination data-x-internal=concept-request-destination>destination</a> to "<code>document</code>", <a href=https://fetch.spec.whatwg.org/#concept-request-mode id=navigating-across-documents:concept-request-mode data-x-internal=concept-request-mode>mode</a> to "<code>navigate</code>", <a href=https://fetch.spec.whatwg.org/#concept-request-credentials-mode id=navigating-across-documents:concept-request-credentials-mode data-x-internal=concept-request-credentials-mode>credentials
   mode</a> to "<code>include</code>", <a id=navigating-across-documents:use-url-credentials-flag href=https://fetch.spec.whatwg.org/#concept-request-use-url-credentials-flag data-x-internal=use-url-credentials-flag>use-URL-credentials flag</a>, <a href=https://fetch.spec.whatwg.org/#concept-request-redirect-mode id=navigating-across-documents:concept-request-redirect-mode data-x-internal=concept-request-redirect-mode>redirect mode</a> to "<code>manual</code>",
   and <a href=https://fetch.spec.whatwg.org/#concept-request-replaces-client-id id=navigating-across-documents:concept-request-replaces-client-id data-x-internal=concept-request-replaces-client-id>replaces client id</a> to
   <var>browsingContext</var>'s <a id=navigating-across-documents:active-document-9 href=browsers.html#active-document>active document</a>'s <a id=navigating-across-documents:relevant-settings-object-2 href=webappapis.html#relevant-settings-object>relevant settings
   object</a>'s <a href=webappapis.html#concept-environment-id id=navigating-across-documents:concept-environment-id>id</a>.<li>
    <p>If <var>browsingContext</var>'s <a href=browsers.html#bc-container id=navigating-across-documents:bc-container-2>container</a> is non-null:</p>

    <ol><li><p>If the <var>browsingContext</var>'s <a href=browsers.html#bc-container id=navigating-across-documents:bc-container-3>container</a> has a
     <a id=navigating-across-documents:browsing-context-scope-origin href=browsers.html#browsing-context-scope-origin>browsing context scope origin</a>, then set <var>request</var>'s <a href=https://fetch.spec.whatwg.org/#concept-request-origin id=navigating-across-documents:concept-request-origin data-x-internal=concept-request-origin>origin</a> to that <a id=navigating-across-documents:browsing-context-scope-origin-2 href=browsers.html#browsing-context-scope-origin>browsing context scope
     origin</a>.<li><p>Set <var>request</var>'s <a href=https://fetch.spec.whatwg.org/#concept-request-destination id=navigating-across-documents:concept-request-destination-2 data-x-internal=concept-request-destination>destination</a> to <var>browsingContext</var>'s
     <a href=browsers.html#bc-container id=navigating-across-documents:bc-container-4>container</a>'s <a href=https://dom.spec.whatwg.org/#concept-element-local-name id=navigating-across-documents:concept-element-local-name data-x-internal=concept-element-local-name>local
     name</a>.</ol>
   <li><p>Let <var>reservedEnvironment</var> be null.<li><p>Let <var>responseOrigin</var> be null.

   <li><p>Let <var>coopEnforcementResult</var> be a new <a href=origin.html#coop-enforcement-result id=navigating-across-documents:coop-enforcement-result>cross-origin opener policy enforcement result</a> whose <a href=origin.html#coop-enforcement-bcg-switch id=navigating-across-documents:coop-enforcement-bcg-switch>needs a browsing context group switch</a> is false, <a href=origin.html#coop-enforcement-origin id=navigating-across-documents:coop-enforcement-origin>origin</a> is <var>browsingContext</var>'s
   <a id=navigating-across-documents:active-document-10 href=browsers.html#active-document>active document</a>'s <a id=navigating-across-documents:concept-origin-6 href=origin.html#concept-origin>origin</a>, and <a href=origin.html#coop-enforcement-coop id=navigating-across-documents:coop-enforcement-coop>cross-origin opener policy</a> is <var>browsingContext</var>'s
   <a id=navigating-across-documents:active-document-11 href=browsers.html#active-document>active document</a>'s <a href=dom.html#concept-document-coop id=navigating-across-documents:concept-document-coop-2>cross-origin opener
   policy</a>.<li><p>Let <var>finalSandboxFlags</var> be an empty <a id=navigating-across-documents:sandboxing-flag-set-3 href=origin.html#sandboxing-flag-set>sandboxing flag set</a>.<li><p>Let <var>responseCOOP</var> be "<code id=navigating-across-documents:coop-unsafe-none-2><a href=origin.html#coop-unsafe-none>unsafe-none</a></code>".<li>
    <p>While true:</p>

    <ol><li><p>Let <var>currentURL</var> be <var>response</var>'s <a href=https://fetch.spec.whatwg.org/#concept-response-location-url id=navigating-across-documents:concept-response-location-url data-x-internal=concept-response-location-url>location URL</a>, if <var>response</var> is not null,
     and <var>request</var>'s <a href=https://fetch.spec.whatwg.org/#concept-request-current-url id=navigating-across-documents:concept-request-current-url data-x-internal=concept-request-current-url>current URL</a>
     otherwise.<li>
      <p>If <var>reservedEnvironment</var> is not null and <var>currentURL</var>'s
      <a href=https://url.spec.whatwg.org/#concept-url-origin id=navigating-across-documents:concept-url-origin data-x-internal=concept-url-origin>origin</a> is not the <a href=origin.html#same-origin id=navigating-across-documents:same-origin-2>same</a> as <var>reservedEnvironment</var>'s <a href=webappapis.html#concept-environment-creation-url id=navigating-across-documents:concept-environment-creation-url>creation URL</a>'s <a href=https://url.spec.whatwg.org/#concept-url-origin id=navigating-across-documents:concept-url-origin-2 data-x-internal=concept-url-origin>origin</a>, then:</p>

      <ol><li><p>Run the <a id=navigating-across-documents:environment-discarding-steps href=webappapis.html#environment-discarding-steps>environment discarding steps</a> for
       <var>reservedEnvironment</var>.<li><p>Set <var>reservedEnvironment</var> to null.</ol>
     <li>
      <p>If <var>reservedEnvironment</var> is null, then:</p>

      <ol><li><p>Let <var>topLevelCreationURL</var> be <var>currentURL</var>.<li><p>Let <var>topLevelOrigin</var> be null.<li>
        <p>If <var>browsingContext</var> is not a <a id=navigating-across-documents:top-level-browsing-context-5 href=browsers.html#top-level-browsing-context>top-level browsing context</a>, then:</p>

        <ol><li><p>Let <var>parentEnvironment</var> be <var>browsingContext</var>'s <a href=browsers.html#bc-container id=navigating-across-documents:bc-container-5>container</a>'s <a id=navigating-across-documents:relevant-settings-object-3 href=webappapis.html#relevant-settings-object>relevant settings object</a>.<li><p>Set <var>topLevelCreationURL</var> to <var>parentEnvironment</var>'s <a id=navigating-across-documents:concept-environment-top-level-creation-url href=webappapis.html#concept-environment-top-level-creation-url>top-level
         creation URL</a> and <var>topLevelOrigin</var> to <var>parentEnvironment</var>'s
         <a id=navigating-across-documents:concept-environment-top-level-origin href=webappapis.html#concept-environment-top-level-origin>top-level origin</a>.</ol>
       <li>
        <p>Set <var>reservedEnvironment</var> to a new <a id=navigating-across-documents:environment-2 href=webappapis.html#environment>environment</a> whose <a href=webappapis.html#concept-environment-id id=navigating-across-documents:concept-environment-id-2>id</a> is a unique opaque string, <a href=webappapis.html#concept-environment-target-browsing-context id=navigating-across-documents:concept-environment-target-browsing-context>target browsing context</a> is
        <var>browsingContext</var>, <a href=webappapis.html#concept-environment-creation-url id=navigating-across-documents:concept-environment-creation-url-2>creation
        URL</a> is <var>currentURL</var>, <a id=navigating-across-documents:concept-environment-top-level-creation-url-2 href=webappapis.html#concept-environment-top-level-creation-url>top-level creation URL</a> is
        <var>topLevelCreationURL</var>, and <a id=navigating-across-documents:concept-environment-top-level-origin-2 href=webappapis.html#concept-environment-top-level-origin>top-level origin</a> is
        <var>topLevelOrigin</var>.</p>

        <p class=note>The created environment's <a href=webappapis.html#concept-environment-active-service-worker id=navigating-across-documents:concept-environment-active-service-worker>active service worker</a> is set in
        the <a href=https://w3c.github.io/ServiceWorker/#on-fetch-request-algorithm id=navigating-across-documents:on-fetch-request-algorithm data-x-internal=on-fetch-request-algorithm>Handle Fetch</a> algorithm during the fetch
        if the request URL matches a service worker registration. <a href=references.html#refsSW>[SW]</a></p>
       </ol>
     <li><p>Set <var>request</var>'s <a href=https://fetch.spec.whatwg.org/#concept-request-reserved-client id=navigating-across-documents:concept-request-reserved-client data-x-internal=concept-request-reserved-client>reserved
     client</a> to <var>reservedEnvironment</var>.<li><p>If the result of <a id=navigating-across-documents:should-navigation-request-of-type-be-blocked-by-content-security-policy href=https://w3c.github.io/webappsec-csp/#should-block-navigation-request data-x-internal=should-navigation-request-of-type-be-blocked-by-content-security-policy>Should navigation request of type be blocked by Content Security
     Policy?</a> given <var>request</var> and <var>navigationType</var> is "<code>Blocked</code>", then set <var>response</var> to a <a id=navigating-across-documents:network-error-2 href=https://fetch.spec.whatwg.org/#concept-network-error data-x-internal=network-error>network error</a> and
     <a id=navigating-across-documents:break href=https://infra.spec.whatwg.org/#iteration-break data-x-internal=break>break</a>. <a href=references.html#refsCSP>[CSP]</a><li>
      <p>Otherwise:</p>

      <ol><li><p>If <var>response</var> is null, <a href=https://fetch.spec.whatwg.org/#concept-fetch id=navigating-across-documents:concept-fetch-2 data-x-internal=concept-fetch>fetch</a> <var>request</var>.<li><p>Otherwise, perform <a id=navigating-across-documents:http-redirect-fetch href=https://fetch.spec.whatwg.org/#concept-http-redirect-fetch data-x-internal=http-redirect-fetch>HTTP-redirect fetch</a> using
       <var>request</var> and <var>response</var>.<li><p>Wait for the <a href=webappapis.html#concept-task id=navigating-across-documents:concept-task>task</a> on the <a id=navigating-across-documents:networking-task-source href=webappapis.html#networking-task-source>networking task
       source</a> to <a id=navigating-across-documents:process-response href=https://fetch.spec.whatwg.org/#process-response data-x-internal=process-response>process response</a> and set <var>response</var> to the
       result.<li><p>Set <var>finalSandboxFlags</var> to the <a href=https://infra.spec.whatwg.org/#set-union id=navigating-across-documents:set-union-3 data-x-internal=set-union>union</a> of
       <var>browsingContext</var>'s <a href=origin.html#concept-bc-sandboxing-flags id=navigating-across-documents:concept-bc-sandboxing-flags-3>sandboxing
       flags</a> and <var>response</var>'s <a id=navigating-across-documents:forced-sandboxing-flag-set-3 href=origin.html#forced-sandboxing-flag-set>forced sandboxing flag set</a>.<li><p>Set <var>responseOrigin</var> to the result of <a id=navigating-across-documents:determining-the-origin-2 href=browsers.html#determining-the-origin>determining the origin</a>
       given <var>browsingContext</var>, <var>request</var>'s <a href=https://fetch.spec.whatwg.org/#concept-request-url id=navigating-across-documents:concept-request-url-9 data-x-internal=concept-request-url>url</a>, <var>finalSandboxFlags</var>,
       <var>incumbentNavigationOrigin</var>, and <var>activeDocumentNavigationOrigin</var>.<li>
        <p>If <var>browsingContext</var> is a <a id=navigating-across-documents:top-level-browsing-context-6 href=browsers.html#top-level-browsing-context>top-level browsing context</a>, then:</p>

        <ol><li><p>Set <var>responseCOOP</var> to the result of <a href=origin.html#obtain-coop id=navigating-across-documents:obtain-coop>obtaining a
         cross-origin opener policy</a> given <var>response</var> and
         <var>reservedEnvironment</var>.<li>
          <p>If <var>sandboxFlags</var> is not empty and <var>responseCOOP</var> is not "<code id=navigating-across-documents:coop-unsafe-none-3><a href=origin.html#coop-unsafe-none>unsafe-none</a></code>", then set <var>response</var> to an
          appropriate <a id=navigating-across-documents:network-error-3 href=https://fetch.spec.whatwg.org/#concept-network-error data-x-internal=network-error>network error</a> and <a id=navigating-across-documents:break-2 href=https://infra.spec.whatwg.org/#iteration-break data-x-internal=break>break</a>.</p>

          <p class=note>This results in a network error as one cannot simultaneously provide a
          clean slate to a response using cross-origin opener policy and sandbox the result of
          navigating to that response.</p>
         <li><p>Set <var>coopEnforcementResult</var> to the result of <a href=origin.html#coop-enforce id=navigating-across-documents:coop-enforce>enforcing the response's cross-origin opener policy</a> given
         <var>browsingContext</var>, <var>responseOrigin</var>, <var>responseCOOP</var>, and
         <var>coopEnforcementResult</var>.</ol>
       <li>
        <p>If <var>response</var> is not a <a id=navigating-across-documents:network-error-4 href=https://fetch.spec.whatwg.org/#concept-network-error data-x-internal=network-error>network error</a>, <var>browsingContext</var>
        is a <a id=navigating-across-documents:child-browsing-context-3 href=browsers.html#child-browsing-context>child browsing context</a>, and the result of performing a
        <a id=navigating-across-documents:cross-origin-resource-policy-check href=https://fetch.spec.whatwg.org/#cross-origin-resource-policy-check data-x-internal=cross-origin-resource-policy-check>cross-origin resource policy check</a> with <var>browsingContext</var>'s
        <a href=browsers.html#bc-container-document id=navigating-across-documents:bc-container-document>container document</a>'s <a id=navigating-across-documents:concept-origin-7 href=origin.html#concept-origin>origin</a>,
        <var>browsingContext</var>'s <a href=browsers.html#bc-container-document id=navigating-across-documents:bc-container-document-2>container
        document</a>'s <a id=navigating-across-documents:relevant-settings-object-4 href=webappapis.html#relevant-settings-object>relevant settings object</a>, <var>request</var>'s <a href=https://fetch.spec.whatwg.org/#concept-request-destination id=navigating-across-documents:concept-request-destination-3 data-x-internal=concept-request-destination>destination</a>, <var>response</var>, and true
        is <b>blocked</b>, then set <var>response</var> to a <a id=navigating-across-documents:network-error-5 href=https://fetch.spec.whatwg.org/#concept-network-error data-x-internal=network-error>network error</a> and
        <a id=navigating-across-documents:break-3 href=https://infra.spec.whatwg.org/#iteration-break data-x-internal=break>break</a>.</p>

        <p class=note>Here we're running the <a id=navigating-across-documents:cross-origin-resource-policy-check-2 href=https://fetch.spec.whatwg.org/#cross-origin-resource-policy-check data-x-internal=cross-origin-resource-policy-check>cross-origin resource policy check</a>
        against the <a id=navigating-across-documents:parent-browsing-context href=browsers.html#parent-browsing-context>parent browsing context</a> rather than
        <var>sourceBrowsingContext</var>. This is because we care about the same-originness of the
        embedded content against the parent context, not the navigation source.</p>
       <li>
        <p>If <var>response</var> does not have a <a href=https://fetch.spec.whatwg.org/#concept-response-location-url id=navigating-across-documents:concept-response-location-url-2 data-x-internal=concept-response-location-url>location URL</a> or the <a href=https://fetch.spec.whatwg.org/#concept-response-location-url id=navigating-across-documents:concept-response-location-url-3 data-x-internal=concept-response-location-url>location URL</a> is not a <a id=navigating-across-documents:url-2 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> whose
        <a href=https://url.spec.whatwg.org/#concept-url-scheme id=navigating-across-documents:concept-url-scheme-4 data-x-internal=concept-url-scheme>scheme</a> is an <a id=navigating-across-documents:http(s)-scheme href=https://fetch.spec.whatwg.org/#http-scheme data-x-internal=http(s)-scheme>HTTP(S) scheme</a>,
        then <a id=navigating-across-documents:break-4 href=https://infra.spec.whatwg.org/#iteration-break data-x-internal=break>break</a>.</p>

        <p class=note>Navigation handles redirects manually as navigation is the only place in
        the web platform that cares for redirects to <code id=navigating-across-documents:mailto-protocol><a data-x-internal=mailto-protocol href=https://tools.ietf.org/html/rfc6068#section-2>mailto:</a></code>
        URLs and such.</p>
       </ol>
     </ol>
   <li><p>If <var>response</var> has a <a href=https://fetch.spec.whatwg.org/#concept-response-location-url id=navigating-across-documents:concept-response-location-url-4 data-x-internal=concept-response-location-url>location
   URL</a> that is failure, then set <var>response</var> to a <a id=navigating-across-documents:network-error-6 href=https://fetch.spec.whatwg.org/#concept-network-error data-x-internal=network-error>network
   error</a>.<li><p>Otherwise, if <var>response</var> has a <a href=https://fetch.spec.whatwg.org/#concept-response-location-url id=navigating-across-documents:concept-response-location-url-5 data-x-internal=concept-response-location-url>location URL</a> that is a <a id=navigating-across-documents:url-3 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> whose <a href=https://url.spec.whatwg.org/#concept-url-scheme id=navigating-across-documents:concept-url-scheme-5 data-x-internal=concept-url-scheme>scheme</a> is "<code>blob</code>", "<code>file</code>", "<code>filesystem</code>", or "<code>javascript</code>", then set <var>response</var> to a network error.<li><p>Otherwise, if <var>response</var> has a <a href=https://fetch.spec.whatwg.org/#concept-response-location-url id=navigating-across-documents:concept-response-location-url-6 data-x-internal=concept-response-location-url>location URL</a> that is a <a id=navigating-across-documents:url-4 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> whose <a href=https://url.spec.whatwg.org/#concept-url-scheme id=navigating-across-documents:concept-url-scheme-6 data-x-internal=concept-url-scheme>scheme</a> is a <a id=navigating-across-documents:fetch-scheme-3 href=https://fetch.spec.whatwg.org/#fetch-scheme data-x-internal=fetch-scheme>fetch scheme</a>, then run
   <a href=#process-a-navigate-fetch id=navigating-across-documents:process-a-navigate-fetch-2>process a navigate fetch</a> with a new <a href=https://fetch.spec.whatwg.org/#concept-request id=navigating-across-documents:concept-request-9 data-x-internal=concept-request>request</a>
   whose <a href=https://fetch.spec.whatwg.org/#concept-request-url id=navigating-across-documents:concept-request-url-10 data-x-internal=concept-request-url>url</a> is <var>response</var>'s <a href=https://fetch.spec.whatwg.org/#concept-response-location-url id=navigating-across-documents:concept-response-location-url-7 data-x-internal=concept-response-location-url>location URL</a>, <var>sourceBrowsingContext</var>,
   <var>browsingContext</var>, <var>navigationType</var>, <var>sandboxFlags</var>,
   <var>incumbentNavigationOrigin</var>, <var>activeDocumentNavigationOrigin</var>, and
   <var>historyHandling</var>, and return.

   <li><p>Otherwise, if <var>response</var> has a <a href=https://fetch.spec.whatwg.org/#concept-response-location-url id=navigating-across-documents:concept-response-location-url-8 data-x-internal=concept-response-location-url>location URL</a> that is a <a id=navigating-across-documents:url-5 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a>, run the
   <a href=#process-a-navigate-url-scheme id=navigating-across-documents:process-a-navigate-url-scheme-2>process a navigate URL scheme</a> given <var>response</var>'s <a href=https://fetch.spec.whatwg.org/#concept-response-location-url id=navigating-across-documents:concept-response-location-url-9 data-x-internal=concept-response-location-url>location URL</a> and
   <var>browsingContext</var>, and return.<li>
    <p><strong>Fallback in prefer-online mode</strong>: If <var>response</var> was not fetched from
    an <a id=navigating-across-documents:application-cache-2 href=offline.html#application-cache>application cache</a>, and was to be fetched using `<code>GET</code>`, and
    there are <a href=offline.html#relevant-application-cache id=navigating-across-documents:relevant-application-cache-2>relevant application caches</a> that are
    identified by a URL with the <a id=navigating-across-documents:same-origin-3 href=origin.html#same-origin>same origin</a> as the URL in question, and that have this
    URL as one of their entries, excluding entries marked as <a href=offline.html#concept-appcache-foreign id=navigating-across-documents:concept-appcache-foreign-2>foreign</a>, and whose <a href=offline.html#concept-appcache-mode id=navigating-across-documents:concept-appcache-mode-2>mode</a> is <a href=offline.html#concept-appcache-mode-prefer-online id=navigating-across-documents:concept-appcache-mode-prefer-online>prefer-online</a>, and the user didn't cancel
    the navigation attempt during the earlier step, and <var>response</var> is either a network
    error or its <a href=https://fetch.spec.whatwg.org/#concept-response-status id=navigating-across-documents:concept-response-status data-x-internal=concept-response-status>status</a> is not an <a id=navigating-across-documents:ok-status href=https://fetch.spec.whatwg.org/#ok-status data-x-internal=ok-status>ok
    status</a>, then:</p>

    <p>Let <var>candidate</var> be the response identified by the URL in question from the
    <a href=offline.html#concept-appcache-selection id=navigating-across-documents:concept-appcache-selection-2>most appropriate application cache</a> of those that
    match.</p> 

    <p>If <var>candidate</var> is not marked as <a href=offline.html#concept-appcache-foreign id=navigating-across-documents:concept-appcache-foreign-3>foreign</a>, then the user agent must discard the failed
    load and instead continue along these steps using <var>candidate</var> as <var>response</var>.
    The user agent may indicate to the user that the original page load failed, and that the page
    used was a previously cached response.</p>
   <li>
    <p><strong>Fallback for fallback entries</strong>: If <var>response</var> was not fetched from
    an <a id=navigating-across-documents:application-cache-3 href=offline.html#application-cache>application cache</a>, and was to be fetched using `<code>GET</code>`, and
    its URL <a href=offline.html#concept-appcache-matches-fallback id=navigating-across-documents:concept-appcache-matches-fallback>matches the fallback namespace</a>
    of one or more <a href=offline.html#relevant-application-cache id=navigating-across-documents:relevant-application-cache-3>relevant application caches</a>, and
    the <a href=offline.html#concept-appcache-selection id=navigating-across-documents:concept-appcache-selection-3>most appropriate application cache</a> of those
    that match does not have an entry in its <a href=offline.html#concept-appcache-onlinesafelist id=navigating-across-documents:concept-appcache-onlinesafelist>online
    safelist</a> that has the <a id=navigating-across-documents:same-origin-4 href=origin.html#same-origin>same origin</a> as <var>response</var>'s URL and that is a
    <a id=navigating-across-documents:prefix-match href=infrastructure.html#prefix-match>prefix match</a> for <var>response</var>'s URL, and the user didn't cancel the
    navigation attempt during the earlier step, and <var>response</var> is either a network error or
    its <a href=https://fetch.spec.whatwg.org/#concept-response-status id=navigating-across-documents:concept-response-status-2 data-x-internal=concept-response-status>status</a> is not an <a id=navigating-across-documents:ok-status-2 href=https://fetch.spec.whatwg.org/#ok-status data-x-internal=ok-status>ok status</a>,
    then:</p>
    

    <p>Let <var>candidate</var> be the <a href=offline.html#concept-appcache-fallback id=navigating-across-documents:concept-appcache-fallback>fallback
    response</a> specified for the <a href=offline.html#concept-appcache-fallback-ns id=navigating-across-documents:concept-appcache-fallback-ns>fallback
    namespace</a> in question. If multiple application caches match, the user agent must use the
    fallback of the <a href=offline.html#concept-appcache-selection id=navigating-across-documents:concept-appcache-selection-4>most appropriate application
    cache</a> of those that match.</p>

    <p>If <var>candidate</var> is not marked as <a href=offline.html#concept-appcache-foreign id=navigating-across-documents:concept-appcache-foreign-4>foreign</a>, then the user agent must discard the failed
    load and instead continue along these steps using <var>candidate</var> as <var>response</var>.
    The document's <a href=https://dom.spec.whatwg.org/#concept-document-url id=navigating-across-documents:the-document的-address-2 data-x-internal=the-document的-address>URL</a>, if appropriate, will still be the
    originally requested URL, not the fallback URL, but the user agent may indicate to the user that
    the original page load failed, that the page used was a fallback response, and what the URL of
    the fallback response actually is.</p>
   <li><p>Let <var>navigationParams</var> be a new <a href=#navigation-params id=navigating-across-documents:navigation-params-4>navigation params</a> whose <a href=#navigation-params-request id=navigating-across-documents:navigation-params-request-3>request</a> is <var>request</var>, <a href=#navigation-params-response id=navigating-across-documents:navigation-params-response-3>response</a> is <var>response</var>, <a href=#navigation-params-origin id=navigating-across-documents:navigation-params-origin-3>origin</a> is <var>responseOrigin</var>, <a href=#navigation-params-sandboxing id=navigating-across-documents:navigation-params-sandboxing-3>final sandboxing flag set</a> is
   <var>finalSandboxFlags</var>, <a href=#navigation-params-coop id=navigating-across-documents:navigation-params-coop-3>cross-origin opener
   policy</a> is <var>responseCOOP</var>, <a href=#navigation-params-reserved-environment id=navigating-across-documents:navigation-params-reserved-environment-3>reserved environment</a> is
   <var>reservedEnvironment</var>, <a href=#navigation-params-browsing-context id=navigating-across-documents:navigation-params-browsing-context-4>browsing
   context</a> is <var>browsingContext</var>, <a href=#navigation-params-bc-switch-needed id=navigating-across-documents:navigation-params-bc-switch-needed-3>browsing context switch needed</a> is
   <var>coopEnforcementResult</var>'s <a href=origin.html#coop-enforcement-bcg-switch id=navigating-across-documents:coop-enforcement-bcg-switch-2>needs a browsing
   context group switch</a>, and <a href=#navigation-params-hh id=navigating-across-documents:navigation-params-hh-3>history
   handling</a> is <var>historyHandling</var>.<li><p>Run <a href=#process-a-navigate-response id=navigating-across-documents:process-a-navigate-response-3>process a navigate response</a> with <var>navigationType</var>, the
   <a href=#source-browsing-context id=navigating-across-documents:source-browsing-context-8>source browsing context</a>, and <var>navigationParams</var>.</ol>

  <p>To <dfn id=process-a-navigate-response data-export="">process a navigate response</dfn>, given a string <var>navigationType</var>, a
  <a id=navigating-across-documents:browsing-context-5 href=browsers.html#browsing-context>browsing context</a> <var>source</var>, and a <a href=#navigation-params id=navigating-across-documents:navigation-params-5>navigation params</a>
  <var>navigationParams</var>:</p>

  <ol><li><p>Let <var>response</var> be <var>navigationParams</var>'s <a href=#navigation-params-response id=navigating-across-documents:navigation-params-response-4>response</a>.<li><p>Let <var>browsingContext</var> be <var>navigationParams</var>'s <a href=#navigation-params-browsing-context id=navigating-across-documents:navigation-params-browsing-context-5>browsing context</a>.<li><p>Let <var>failure</var> be false.<li>
    <p>If <var>response</var> is a <a id=navigating-across-documents:network-error-7 href=https://fetch.spec.whatwg.org/#concept-network-error data-x-internal=network-error>network error</a>, then set <var>failure</var> to
    true.</p>

    <p>Otherwise, if the result of <a id=navigating-across-documents:should-navigation-response-to-navigation-request-of-type-in-target-be-blocked-by-content-security-policy href=https://w3c.github.io/webappsec-csp/#should-block-navigation-response data-x-internal=should-navigation-response-to-navigation-request-of-type-in-target-be-blocked-by-content-security-policy>Should navigation response to navigation request of type in
    target be blocked by Content Security Policy?</a> given <var>navigationParams</var>'s <a href=#navigation-params-request id=navigating-across-documents:navigation-params-request-4>request</a>, <var>response</var>,
    <var>navigationType</var>, and <var>browsingContext</var> is "<code>Blocked</code>",
    then set <var>failure</var> to true. <a href=references.html#refsCSP>[CSP]</a></p>

    <p>Otherwise, if the result of <a href="origin.html#check-a-navigation-response's-adherence-to-its-embedder-policy" id="navigating-across-documents:check-a-navigation-response's-adherence-to-its-embedder-policy">checking a navigation response's adherence to its embedder policy</a> given
    <var>response</var> and <var>browsingContext</var> is false, then set <var>failure</var> to
    true.</p>

    <p>Otherwise, if the result of <a href="#check-a-navigation-response's-adherence-to-x-frame-options" id="navigating-across-documents:check-a-navigation-response's-adherence-to-x-frame-options">checking a navigation response's adherence to
    `<code>X-Frame-Options</code>`</a> given <var>response</var>, <var>browsingContext</var>,
    and <var>navigationParams</var>'s <a href=#navigation-params-origin id=navigating-across-documents:navigation-params-origin-4>origin</a> is
    false, then set <var>failure</var> to true.</p>
   <li>
    <p>If <var>failure</var> is true, then:</p>

    <ol><li><p><a href=#read-ua-inline id=navigating-across-documents:read-ua-inline>Display the inline content with an appropriate error
     shown to the user</a> given <var>browsingContext</var>.<li><p>Run the <a href=webappapis.html#environment-discarding-steps id=navigating-across-documents:environment-discarding-steps-2>environment discarding steps</a>
     for <var>navigationParams</var>'s <a href=#navigation-params-reserved-environment id=navigating-across-documents:navigation-params-reserved-environment-4>reserved environment</a>.<li><p>Return.</ol>

    <p class=note>This is where the network errors defined and propagated by <cite>Fetch</cite>,
    such as DNS or TLS errors, end up being displayed to users. <a href=references.html#refsFETCH>[FETCH]</a></p>
   <li><p>If <var>response</var>'s <a href=https://fetch.spec.whatwg.org/#concept-response-status id=navigating-across-documents:concept-response-status-3 data-x-internal=concept-response-status>status</a> is 204 or
   205, then return.<li>
    <p>If <var>response</var> has a `<code id=navigating-across-documents:http-content-disposition><a data-x-internal=http-content-disposition href=https://tools.ietf.org/html/rfc6266>Content-Disposition</a></code>` header specifying the <code>attachment</code> disposition type, then:</p>

    <ol><li><p>If the result of running the <a id=navigating-across-documents:allowed-to-download href=links.html#allowed-to-download>allowed to download</a> given <var>source</var>
     and <var>browsingContext</var> is true, then handle <var>response</var> <a id=navigating-across-documents:as-a-download href=links.html#as-a-download>as a
     download</a>.<li><p>Return.</ol>
   <li><p>Let <var>type</var> be the <a href=https://mimesniff.spec.whatwg.org/#computed-mime-type id=navigating-across-documents:content-type-sniffing-2 data-x-internal=content-type-sniffing-2>computed type of
   <var>response</var></a>.<li>
    <p>If the user agent has been configured to process resources of the given <var>type</var>
    using some mechanism other than rendering the content in a <a id=navigating-across-documents:browsing-context-6 href=browsers.html#browsing-context>browsing context</a>, then
    skip this step. Otherwise, if the <var>type</var> is one of the following types, jump to the
    appropriate entry in the following list, and process <var>response</var> as described there:</p>

    <dl class=switch><dt>an <a id=navigating-across-documents:html-mime-type href=https://mimesniff.spec.whatwg.org/#html-mime-type data-x-internal=html-mime-type>HTML MIME type</a><dd>Follow the steps given in the <a href=#navigate-html id=navigating-across-documents:navigate-html>HTML document</a> section
     providing <var>navigationParams</var>. Once the steps have completed, return.<dt>an <a id=navigating-across-documents:xml-mime-type href=https://mimesniff.spec.whatwg.org/#xml-mime-type data-x-internal=xml-mime-type>XML MIME type</a> that is not an <a href=#explicitly-supported-xml-mime-type id=navigating-across-documents:explicitly-supported-xml-mime-type>explicitly supported XML MIME
     type</a><dd>Follow the steps given in the <a href=#read-xml id=navigating-across-documents:read-xml>XML document</a> section
     providing <var>navigationParams</var> and <var>type</var>. Once the steps have completed,
     return.<dt>a <a id=navigating-across-documents:javascript-mime-type href=https://mimesniff.spec.whatwg.org/#javascript-mime-type data-x-internal=javascript-mime-type>JavaScript MIME type</a><dt>a <a id=navigating-across-documents:json-mime-type href=https://mimesniff.spec.whatwg.org/#json-mime-type data-x-internal=json-mime-type>JSON MIME type</a> that is not an <a href=#explicitly-supported-json-mime-type id=navigating-across-documents:explicitly-supported-json-mime-type>explicitly supported JSON MIME
     type</a><dt>"<code id=navigating-across-documents:text/cache-manifest><a href=iana.html#text/cache-manifest>text/cache-manifest</a></code>"<dt>"<code id=navigating-across-documents:text/css><a href=indices.html#text/css>text/css</a></code>"<dt>"<code id=navigating-across-documents:text/plain><a data-x-internal=text/plain href=https://tools.ietf.org/html/rfc2046#section-4.1.3>text/plain</a></code>"<dt>"<code id=navigating-across-documents:text/vtt><a href=indices.html#text/vtt>text/vtt</a></code>"<dd>Follow the steps given in the <a href=#read-text id=navigating-across-documents:read-text>plain text file</a> section
     providing <var>navigationParams</var> and <var>type</var>. Once the steps have completed,
     return.<dt>"<code id=navigating-across-documents:multipart/x-mixed-replace><a href=iana.html#multipart/x-mixed-replace>multipart/x-mixed-replace</a></code>"<dd>Follow the steps given in the <a href=#read-multipart-x-mixed-replace id=navigating-across-documents:read-multipart-x-mixed-replace>multipart/x-mixed-replace</a> section providing
     <var>navigationParams</var>. Once the steps have completed, return.<dt>A supported image, video, or audio type<dd>Follow the steps given in the <a href=#read-media id=navigating-across-documents:read-media>media</a> section providing
     <var>navigationParams</var> and <var>type</var>. Once the steps have completed, return.<dt>A type that will use an external application to render the content in
     <var>browsingContext</var><dd>Follow the steps given in the <a href=#read-plugin id=navigating-across-documents:read-plugin>plugin</a> section
     providing <var>navigationParams</var> and <var>type</var>. Once the steps have completed,
     return.</dl>

    <p>An <dfn id=explicitly-supported-xml-mime-type>explicitly supported XML MIME type</dfn> is an <a id=navigating-across-documents:xml-mime-type-2 href=https://mimesniff.spec.whatwg.org/#xml-mime-type data-x-internal=xml-mime-type>XML MIME type</a> for which
    the user agent is configured to use an external application to render the content (either a
    <a id=navigating-across-documents:plugin href=infrastructure.html#plugin>plugin</a> rendering directly in <var>browsingContext</var>, or a separate
    application), or one for which the user agent has dedicated processing rules (e.g., a web
    browser with a built-in Atom feed viewer would be said to explicitly support the
    <code id=navigating-across-documents:application/atom+xml><a href=indices.html#application/atom+xml>application/atom+xml</a></code> MIME type), or one for which the user agent has a dedicated
    handler.</p>

    <p>An <dfn id=explicitly-supported-json-mime-type>explicitly supported JSON MIME type</dfn> is a <a id=navigating-across-documents:json-mime-type-2 href=https://mimesniff.spec.whatwg.org/#json-mime-type data-x-internal=json-mime-type>JSON MIME type</a> for which
    the user agent is configured to use an external application to render the content (either a
    <a id=navigating-across-documents:plugin-2 href=infrastructure.html#plugin>plugin</a> rendering directly in <var>browsingContext</var>, or a separate
    application), or one for which the user agent has dedicated processing rules, or one for which
    the user agent has a dedicated handler.</p>
   <li id=navigate-non-Document><p><i>Non-document content</i>: If, given <var>type</var>, the new
   resource is to be handled by displaying some sort of inline content, e.g., a native rendering of
   the content or an error message because the specified type is not supported, then <a href=#read-ua-inline id=navigating-across-documents:read-ua-inline-2>display the inline content</a> given <var>browsingContext</var>,
   and then return.<li><p>Otherwise, the document's <var>type</var> is such that the resource will not affect
   <var>browsingContext</var>, e.g., because the resource is to be handed to an external application
   or because it is an unknown type that will be processed <a id=navigating-across-documents:as-a-download-2 href=links.html#as-a-download>as a download</a>. <a href=#hand-off-to-external-software id=navigating-across-documents:hand-off-to-external-software>Process the resource appropriately</a>.</p>
  </ol>

  <p>To <dfn id=process-a-navigate-url-scheme>process a navigate URL scheme</dfn>, given a <a id=navigating-across-documents:url-6 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> <var>url</var> and
  <a id=navigating-across-documents:browsing-context-7 href=browsers.html#browsing-context>browsing context</a> <var>browsingContext</var>, run these steps:</p>

  <ol><li><p>If <var>url</var> is to be handled using a mechanism that does not affect
   <var>browsingContext</var>, e.g., because <var>url</var>'s <a href=https://url.spec.whatwg.org/#concept-url-scheme id=navigating-across-documents:concept-url-scheme-7 data-x-internal=concept-url-scheme>scheme</a> is handled externally, then <a href=#hand-off-to-external-software id=navigating-across-documents:hand-off-to-external-software-2>proceed with that mechanism instead</a>.<li>
    <p>Otherwise, <var>url</var> is to be handled by displaying some sort of inline content, e.g.,
    an error message because the specified scheme is not one of the supported protocols, or an
    inline prompt to allow the user to select <a href=system-state.html#dom-navigator-registerprotocolhandler id=navigating-across-documents:dom-navigator-registerprotocolhandler>a
    registered handler</a> for the given scheme. <a href=#read-ua-inline id=navigating-across-documents:read-ua-inline-3>Display the
    inline content</a> given <var>browsingContext</var>.</p>

    <p class=note>In the case of a registered handler being used, <a href=#navigate id=navigating-across-documents:navigate-6>navigate</a> will be
    invoked with a new URL.</p>
   </ol>

  <p>When a resource is handled by <dfn id=hand-off-to-external-software>passing its URL or
  data to an external software package</dfn> separate from the user agent (e.g. handing a <code id=navigating-across-documents:mailto-protocol-2><a data-x-internal=mailto-protocol href=https://tools.ietf.org/html/rfc6068#section-2>mailto:</a></code> URL to a mail client, or a Word document to a word
  processor), user agents should attempt to mitigate the risk that this is an attempt to exploit the
  target software, e.g. by prompting the user to confirm that the <a href=#source-browsing-context id=navigating-across-documents:source-browsing-context-9>source browsing
  context</a>'s <a id=navigating-across-documents:active-document-12 href=browsers.html#active-document>active document</a>'s <a id=navigating-across-documents:concept-origin-8 href=origin.html#concept-origin>origin</a> is to be allowed to invoke the
  specified software. In particular, if the <a href=#navigate id=navigating-across-documents:navigate-7>navigate</a> algorithm was invoked when
  <a href=#source-browsing-context id=navigating-across-documents:source-browsing-context-10>source browsing context</a>'s <a id=navigating-across-documents:active-window-2 href=browsers.html#active-window>active window</a> does not have <a id=navigating-across-documents:transient-activation href=interaction.html#transient-activation>transient
  activation</a>, the user agent should not invoke the external software package without prior
  user confirmation.</p>

  <p class=example>For example, there could be a vulnerability in the target software's URL
  handler which a hostile page would attempt to exploit by tricking a user into clicking a link.</p>

  <p>To <dfn id=javascript-protocol>execute a <code>javascript:</code> URL request</dfn>,
  given a <a href=https://fetch.spec.whatwg.org/#concept-request id=navigating-across-documents:concept-request-10 data-x-internal=concept-request>request</a> <var>request</var> and two <a href=browsers.html#browsing-context id=navigating-across-documents:browsing-context-8>browsing contexts</a> <var>source</var> and
  <var>browsingContext</var>, run these steps:</p>

  <ol id=concept-js-deref><li><p>Let <var>response</var> be a <a href=https://fetch.spec.whatwg.org/#concept-response id=navigating-across-documents:concept-response-3 data-x-internal=concept-response>response</a> whose <a href=https://fetch.spec.whatwg.org/#concept-response-status id=navigating-across-documents:concept-response-status-4 data-x-internal=concept-response-status>status</a> is <code>204</code>.<li>
    <p>If both of the following are true:</p>

    <ul><li>
      <p><var>source</var>'s <a id=navigating-across-documents:active-document-13 href=browsers.html#active-document>active document</a>'s <a id=navigating-across-documents:concept-origin-9 href=origin.html#concept-origin>origin</a> is <a id=navigating-across-documents:same-origin-5 href=origin.html#same-origin>same
      origin</a> with <var>browsingContext</var>'s <a id=navigating-across-documents:active-document-14 href=browsers.html#active-document>active document</a>'s
      <a id=navigating-across-documents:concept-origin-10 href=origin.html#concept-origin>origin</a>.</p>

      <p class=XXX>As explained in <a href=https://github.com/whatwg/html/issues/2591>issue
      #2591</a> this step does not work and presents a security issue.</p>
     <li><p>The result of <a id=navigating-across-documents:should-navigation-request-of-type-be-blocked-by-content-security-policy-2 href=https://w3c.github.io/webappsec-csp/#should-block-navigation-request data-x-internal=should-navigation-request-of-type-be-blocked-by-content-security-policy>Should navigation request of type be blocked by Content Security
     Policy?</a> given <var>request</var> and "<code>other</code>" is "<code>Allowed</code>". <a href=references.html#refsCSP>[CSP]</a></ul>

    <p>then:</p>

    <ol><li><p>Let <var>urlString</var> be the result of running the <a href=https://url.spec.whatwg.org/#concept-url-serializer id=navigating-across-documents:concept-url-serializer data-x-internal=concept-url-serializer>URL serializer</a> on <var>request</var>'s <a href=https://fetch.spec.whatwg.org/#concept-request-url id=navigating-across-documents:concept-request-url-11 data-x-internal=concept-request-url>url</a>.<li><p>Let <var>encodedScriptSource</var> be the result of removing the leading "<code>javascript:</code>" from <var>urlString</var>.<li><p>Let <var>scriptSource</var> be the <a href=https://encoding.spec.whatwg.org/#utf-8-decode id=navigating-across-documents:utf-8-decode data-x-internal=utf-8-decode>UTF-8 decoding</a>
     of the <a href=https://url.spec.whatwg.org/#string-percent-decode id=navigating-across-documents:percent-decode data-x-internal=percent-decode>percent-decoding</a> of
     <var>encodedScriptSource</var>.<li><p><a href=https://infra.spec.whatwg.org/#list-append id=navigating-across-documents:list-append data-x-internal=list-append>Append</a> <var>browsingContext</var>'s <a id=navigating-across-documents:active-document-15 href=browsers.html#active-document>active
     document</a>'s <a href=https://dom.spec.whatwg.org/#concept-document-url id=navigating-across-documents:the-document的-address-3 data-x-internal=the-document的-address>URL</a> to <var>request</var>'s <a href=https://fetch.spec.whatwg.org/#concept-request-url-list id=navigating-across-documents:concept-request-url-list data-x-internal=concept-request-url-list>URL list</a>.<li><p>Let <var>settings</var> be <var>browsingContext</var>'s <a id=navigating-across-documents:active-document-16 href=browsers.html#active-document>active document</a>'s
     <a id=navigating-across-documents:relevant-settings-object-5 href=webappapis.html#relevant-settings-object>relevant settings object</a>.<li><p>Let <var>baseURL</var> be <var>settings</var>'s <a id=navigating-across-documents:api-base-url href=webappapis.html#api-base-url>API base URL</a>.<li><p>Let <var>script</var> be the result of <a id=navigating-across-documents:creating-a-classic-script href=webappapis.html#creating-a-classic-script>creating a classic script</a> given
     <var>scriptSource</var>, <var>settings</var>, <var>baseURL</var>, and the <a id=navigating-across-documents:default-classic-script-fetch-options href=webappapis.html#default-classic-script-fetch-options>default
     classic script fetch options</a>.<li><p>Let <var>evaluationStatus</var> be the result of <a href=webappapis.html#run-a-classic-script id=navigating-across-documents:run-a-classic-script>running the classic script</a> <var>script</var>.<li><p>Let <var>result</var> be undefined if <var>evaluationStatus</var> is an <a id=navigating-across-documents:abrupt-completion href=https://tc39.es/ecma262/#sec-completion-record-specification-type data-x-internal=abrupt-completion>abrupt
     completion</a> or <var>evaluationStatus</var>.[[Value]] is empty, or
     <var>evaluationStatus</var>.[[Value]] otherwise.<li>
      <p>If <a href=https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values id=navigating-across-documents:js-type data-x-internal=js-type>Type</a>(<var>result</var>) is String, then set
      <var>response</var> to a <a href=https://fetch.spec.whatwg.org/#concept-response id=navigating-across-documents:concept-response-4 data-x-internal=concept-response>response</a> whose <a href=https://fetch.spec.whatwg.org/#concept-response-header-list id=navigating-across-documents:concept-response-header-list data-x-internal=concept-response-header-list>header list</a> consists of
      `<code id=navigating-across-documents:content-type><a href=infrastructure.html#content-type>Content-Type</a></code>`/`<code id=navigating-across-documents:text/html><a href=iana.html#text/html>text/html</a></code>` and `<code id=navigating-across-documents:http-referrer-policy><a data-x-internal=http-referrer-policy href=https://w3c.github.io/webappsec-referrer-policy/#referrer-policy-header-dfn>Referrer-Policy</a></code>`/<var>settings</var>'s <a id=navigating-across-documents:referrer-policy href=https://w3c.github.io/webappsec-referrer-policy/#referrer-policy data-x-internal=referrer-policy>referrer
      policy</a>, and whose <a href=https://fetch.spec.whatwg.org/#concept-response-body id=navigating-across-documents:concept-response-body data-x-internal=concept-response-body>body</a> is
      <var>result</var>.</p>

      <p class=XXX>The exact conversion between the string <var>result</var> and the bytes that
      comprise a <a href=https://fetch.spec.whatwg.org/#concept-response-body id=navigating-across-documents:concept-response-body-2 data-x-internal=concept-response-body>response body</a> is not yet specified,
      pending further investigation into user agent behavior. See <a href=https://github.com/whatwg/html/issues/1129>issue #1129</a>.</p>
     </ol>
   <li><p>Return <var>response</var>.</ol>

  <p class=XXX>In addition to the specific issues linked above, <code id=navigating-across-documents:javascript-protocol-5><a href=#javascript-protocol>javascript:</a></code> URLs have a <a href=https://github.com/whatwg/html/labels/topic%3A%20javascript%3A%20URLs>dedicated label</a>
  on the issue tracker documenting various problems with their specification.</p>

  <hr>

  <p>Some of the sections below, to which the above algorithm defers in certain cases, use the
  following steps to <dfn id=initialise-the-document-object>create and initialize a <code>Document</code> object</dfn>,
  given a <a href=https://dom.spec.whatwg.org/#concept-document-type id=navigating-across-documents:concept-document-type data-x-internal=concept-document-type>type</a> <var>type</var>, <a href=https://dom.spec.whatwg.org/#concept-document-content-type id=navigating-across-documents:concept-document-content-type data-x-internal=concept-document-content-type>content type</a> <var>contentType</var>, and
  <a href=#navigation-params id=navigating-across-documents:navigation-params-6>navigation params</a> <var>navigationParams</var>:</p>

  <ol><li><p>Let <var>browsingContext</var> be <var>navigationParams</var>'s <a href=#navigation-params-browsing-context id=navigating-across-documents:navigation-params-browsing-context-6>browsing context</a>.<li><p>If <var>navigationParams</var>'s <a href=#navigation-params-bc-switch-needed id=navigating-across-documents:navigation-params-bc-switch-needed-4>browsing context switch needed</a> is true, then
   set <var>browsingContext</var> to the result of the <a href=origin.html#obtain-browsing-context-navigation id=navigating-across-documents:obtain-browsing-context-navigation>obtain a browsing context to use for a navigation
   response</a> algorithm, given <var>browsingContext</var>, <var>navigationParams</var>'s <a href=#navigation-params-sandboxing id=navigating-across-documents:navigation-params-sandboxing-4>final sandboxing flag set</a>, and
   <var>navigationParams</var>'s <a href=#navigation-params-coop id=navigating-across-documents:navigation-params-coop-4>cross-origin opener
   policy</a>.<li>
    <p>Let <var>permissionsPolicy</var> be the result of <a id=navigating-across-documents:creating-a-permissions-policy-from-a-response href=https://w3c.github.io/webappsec-feature-policy/#create-from-response data-x-internal=creating-a-permissions-policy-from-a-response>creating a permissions policy from a
    response</a> given <var>browsingContext</var>, <var>navigationParams</var>'s <a href=#navigation-params-origin id=navigating-across-documents:navigation-params-origin-5>origin</a>, and <var>navigationParams</var>'s <a href=#navigation-params-response id=navigating-across-documents:navigation-params-response-5>response</a>. <a href=references.html#refsPERMISSIONSPOLICY>[PERMISSIONSPOLICY]</a></p>

    <div class=note>
     <p>The <a id=navigating-across-documents:creating-a-permissions-policy-from-a-response-2 href=https://w3c.github.io/webappsec-feature-policy/#create-from-response data-x-internal=creating-a-permissions-policy-from-a-response>creating a permissions policy from a response</a> algorithm makes use of the
     passed <a id=navigating-across-documents:concept-origin-11 href=origin.html#concept-origin>origin</a>. If <code id=navigating-across-documents:dom-document-domain><a href=origin.html#dom-document-domain>document.domain</a></code> has
     been used for <var>browsingContext</var>'s <a href=browsers.html#bc-container-document id=navigating-across-documents:bc-container-document-3>container document</a>, then its <a id=navigating-across-documents:concept-origin-12 href=origin.html#concept-origin>origin</a> cannot
     be <a id=navigating-across-documents:same-origin-domain href=origin.html#same-origin-domain>same origin-domain</a> with the passed origin, because these steps run before the
     <var>document</var> is created, so it cannot itself yet have used <code id=navigating-across-documents:dom-document-domain-2><a href=origin.html#dom-document-domain>document.domain</a></code>. Note that this means that Permissions
     Policy checks are less permissive compared to doing a <a id=navigating-across-documents:same-origin-6 href=origin.html#same-origin>same origin</a> check instead.</p>

     <p>See below for some examples of this in action.</p>
    </div>
   <li><p>Let <var>creationURL</var> be <var>navigationParams</var>'s <a href=#navigation-params-response id=navigating-across-documents:navigation-params-response-6>response</a>'s <a href=https://fetch.spec.whatwg.org/#concept-response-url id=navigating-across-documents:concept-response-url-2 data-x-internal=concept-response-url>URL</a>.<li><p>If <var>navigationParams</var>'s <a href=#navigation-params-request id=navigating-across-documents:navigation-params-request-5>request</a>
   is non-null, then set <var>creationURL</var> to <var>navigationParams</var>'s <a href=#navigation-params-request id=navigating-across-documents:navigation-params-request-6>request</a>'s <a href=https://fetch.spec.whatwg.org/#concept-request-current-url id=navigating-across-documents:concept-request-current-url-2 data-x-internal=concept-request-current-url>current URL</a>.<li><p>If <var>browsingContext</var>'s only entry in its <a id=navigating-across-documents:session-history-2 href=history.html#session-history>session history</a> is the
   initial <code id=navigating-across-documents:about:blank><a href=infrastructure.html#about:blank>about:blank</a></code> <code id=navigating-across-documents:document-8><a href=dom.html#document>Document</a></code> that was added when that <a id=navigating-across-documents:browsing-context-9 href=browsers.html#browsing-context>browsing
   context</a> was <a href=browsers.html#creating-a-new-browsing-context id=navigating-across-documents:creating-a-new-browsing-context>created</a>, and
   <var>navigationParams</var>'s <a href=#navigation-params-hh id=navigating-across-documents:navigation-params-hh-4>history handling</a> is
   "<code id=navigating-across-documents:hh-replace><a href=#hh-replace>replace</a></code>", and that <code id=navigating-across-documents:document-9><a href=dom.html#document>Document</a></code>'s <a id=navigating-across-documents:concept-origin-13 href=origin.html#concept-origin>origin</a>
   is <a id=navigating-across-documents:same-origin-domain-2 href=origin.html#same-origin-domain>same origin-domain</a> with <var>navigationParams</var>'s <a href=#navigation-params-origin id=navigating-across-documents:navigation-params-origin-6>origin</a>, then do nothing.<li>
    <p>Otherwise:</p>

    <ol><li><p>Let <var>oiHeader</var> be the result of <a id=navigating-across-documents:getting-a-structured-field-value href=https://fetch.spec.whatwg.org/#concept-header-list-get-structured-header data-x-internal=getting-a-structured-field-value>getting a structured field value</a>
     given `<code id=navigating-across-documents:origin-isolation-2><a href=iana.html#origin-isolation-2>Origin-Isolation</a></code>` and "<code>item</code>" from <var>response</var>'s <a href=https://fetch.spec.whatwg.org/#concept-response-header-list id=navigating-across-documents:concept-response-header-list-2 data-x-internal=concept-response-header-list>header list</a>.<li><p>Let <var>requestsOI</var> be true if <var>oiHeader</var> is not
     null and <var>oiHeader</var>[0] is the <a href=https://httpwg.org/http-extensions/draft-ietf-httpbis-header-structure.html#boolean id=navigating-across-documents:http-structured-header-boolean data-x-internal=http-structured-header-boolean>boolean</a> true; otherwise false.<li><p>If <var>reservedEnvironment</var> is a <a id=navigating-across-documents:non-secure-context href=webappapis.html#non-secure-context>non-secure context</a>, then set
     <var>requestsOI</var> to false.<li><p>Let <var>agent</var> be the result of <a href=webappapis.html#obtain-similar-origin-window-agent id=navigating-across-documents:obtain-similar-origin-window-agent>obtaining a similar-origin window agent</a>
     given <var>navigationParams</var>'s <a href=#navigation-params-origin id=navigating-across-documents:navigation-params-origin-7>origin</a>,
     <var>browsingContext</var>'s <a href=browsers.html#tlbc-group id=navigating-across-documents:tlbc-group>group</a>, and
     <var>requestsOI</var>.<li>
      <p>Let <var>realm execution context</var> be the result of <a id=navigating-across-documents:creating-a-new-javascript-realm href=webappapis.html#creating-a-new-javascript-realm>creating a new JavaScript
      realm</a> given <var>agent</var> and the following customizations:</p>

      <ul><li><p>For the global object, create a new <code id=navigating-across-documents:window-2><a href=window-object.html#window>Window</a></code> object.<li><p>For the global <b>this</b> binding, use <var>browsingContext</var>'s
       <code id=navigating-across-documents:windowproxy><a href=window-object.html#windowproxy>WindowProxy</a></code> object.</ul>
     <li><p>Let <var>topLevelCreationURL</var> be <var>creationURL</var>.<li><p>Let <var>topLevelOrigin</var> be <var>navigationParams</var>'s <a href=#navigation-params-request id=navigating-across-documents:navigation-params-request-7>origin</a>.<li>
      <p>If <var>browsingContext</var> is not a <a id=navigating-across-documents:top-level-browsing-context-7 href=browsers.html#top-level-browsing-context>top-level browsing context</a>, then:</p>

      <ol><li><p>Let <var>parentEnvironment</var> be <var>browsingContext</var>'s <a href=browsers.html#bc-container id=navigating-across-documents:bc-container-6>container</a>'s <a id=navigating-across-documents:relevant-settings-object-6 href=webappapis.html#relevant-settings-object>relevant settings object</a>.<li><p>Set <var>topLevelCreationURL</var> to <var>parentEnvironment</var>'s <a id=navigating-across-documents:concept-environment-top-level-creation-url-3 href=webappapis.html#concept-environment-top-level-creation-url>top-level
       creation URL</a>.<li><p>Set <var>topLevelOrigin</var> to <var>parentEnvironment</var>'s <a id=navigating-across-documents:concept-environment-top-level-origin-3 href=webappapis.html#concept-environment-top-level-origin>top-level
       origin</a>.</ol>
     <li><p><a id=navigating-across-documents:set-up-a-window-environment-settings-object href=window-object.html#set-up-a-window-environment-settings-object>Set up a window environment settings object</a> with <var>realm execution
     context</var>, <var>navigationParams</var>'s <a href=#navigation-params-reserved-environment id=navigating-across-documents:navigation-params-reserved-environment-5>reserved environment</a>,
     <var>topLevelCreationURL</var>, and <var>topLevelOrigin</var>.</ol>
   <li><p>Let <var>document</var> be a new <code id=navigating-across-documents:document-10><a href=dom.html#document>Document</a></code>, whose <a href=https://dom.spec.whatwg.org/#concept-document-type id=navigating-across-documents:concept-document-type-2 data-x-internal=concept-document-type>type</a> is <var>type</var>, <a href=https://dom.spec.whatwg.org/#concept-document-content-type id=navigating-across-documents:concept-document-content-type-2 data-x-internal=concept-document-content-type>content type</a> is <var>contentType</var>,
   <a id=navigating-across-documents:concept-origin-14 href=origin.html#concept-origin>origin</a> is <var>navigationParams</var>'s <a href=#navigation-params-origin id=navigating-across-documents:navigation-params-origin-8>origin</a>, <a href=dom.html#concept-document-permissions-policy id=navigating-across-documents:concept-document-permissions-policy>permissions policy</a> is
   <var>permissionsPolicy</var>, <a id=navigating-across-documents:active-sandboxing-flag-set href=origin.html#active-sandboxing-flag-set>active sandboxing flag set</a> is
   <var>navigationParams</var>'s <a href=#navigation-params-sandboxing id=navigating-across-documents:navigation-params-sandboxing-5>final sandboxing flag
   set</a>, and <a href=dom.html#concept-document-coop id=navigating-across-documents:concept-document-coop-3>cross-origin opener policy</a> is
   <var>navigationParams</var>'s <a href=#navigation-params-coop id=navigating-across-documents:navigation-params-coop-5>cross-origin opener
   policy</a>.<li id="set-the-document's-address"><p>Set <var>document</var>'s <a href=https://dom.spec.whatwg.org/#concept-document-url id=navigating-across-documents:the-document的-address-4 data-x-internal=the-document的-address>URL</a> to <var>creationURL</var>.<li><p>Set <var>document</var>'s <a href=dom.html#concept-document-referrer-policy id=navigating-across-documents:concept-document-referrer-policy>referrer
   policy</a> to the result of <a href=https://w3c.github.io/webappsec-referrer-policy/#parse-referrer-policy-from-header id=navigating-across-documents:parse-referrer-policy-header data-x-internal=parse-referrer-policy-header>parsing the
   `<code>Referrer-Policy</code>` header</a> of <var>navigationParams</var>'s <a href=#navigation-params-response id=navigating-across-documents:navigation-params-response-7>response</a>. <a href=references.html#refsREFERRERPOLICY>[REFERRERPOLICY]</a><li><p>Set <var>document</var>'s <a href=dom.html#concept-document-embedder-policy id=navigating-across-documents:concept-document-embedder-policy>embedder
   policy</a> to the result of <a href=origin.html#obtain-an-embedder-policy id=navigating-across-documents:obtain-an-embedder-policy>obtaining an embedder
   policy</a> from <var>navigationParams</var>'s <a href=#navigation-params-response id=navigating-across-documents:navigation-params-response-8>response</a>.<li><p><a id="navigating-across-documents:initialize-a-document's-csp-list" href=https://w3c.github.io/webappsec-csp/#initialize-document-csp data-x-internal="initialize-a-document's-csp-list">Initialize a <code>Document</code>'s CSP list</a> given
   <var>document</var>, <var>navigationParams</var>'s <a href=#navigation-params-response id=navigating-across-documents:navigation-params-response-9>response</a>, and <var>navigationParams</var>'s <a href=#navigation-params-request id=navigating-across-documents:navigation-params-request-8>request</a>. <a href=references.html#refsCSP>[CSP]</a></p>

   <li>
    <p>If <var>navigationParams</var>'s <a href=#navigation-params-request id=navigating-across-documents:navigation-params-request-9>request</a> is
    non-null, then:</p>

    <ol><li><p>Set <var>document</var>'s <a href="dom.html#the-document's-referrer" id="navigating-across-documents:the-document's-referrer">referrer</a> to the
     empty string.<li><p>Let <var>referrer</var> be <var>navigationParams</var>'s <a href=#navigation-params-request id=navigating-across-documents:navigation-params-request-10>request</a>'s <a href=https://fetch.spec.whatwg.org/#concept-request-referrer id=navigating-across-documents:concept-request-referrer data-x-internal=concept-request-referrer>referrer</a>.<li>
      <p>If <var>referrer</var> is a <a id=navigating-across-documents:url-record href=https://url.spec.whatwg.org/#concept-url data-x-internal=url-record>URL record</a>, then set <var>document</var>'s <a href="dom.html#the-document's-referrer" id="navigating-across-documents:the-document's-referrer-2">referrer</a> to the <a href=https://url.spec.whatwg.org/#concept-url-serializer id=navigating-across-documents:concept-url-serializer-2 data-x-internal=concept-url-serializer>serialization</a> of <var>referrer</var>.</p>

      <p class=note>Per <cite>Fetch</cite>, <var>referrer</var> will be either a <a id=navigating-across-documents:url-record-2 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url-record>URL
      record</a> or "<code>no-referrer</code>" at this point.</p>
     </ol>
   <li>
    <p>If <var>navigationParams</var>'s <a href=#navigation-params-response id=navigating-across-documents:navigation-params-response-10>response</a>
    has a `<code id=navigating-across-documents:refresh><a href=iana.html#refresh>Refresh</a></code>` header, then:</p>

    <ol><li><p>Let <var>value</var> be the <a href=https://infra.spec.whatwg.org/#isomorphic-decode id=navigating-across-documents:isomorphic-decode data-x-internal=isomorphic-decode>isomorphic decoding</a>
     of the value of the header.<li><p>Run the <a id=navigating-across-documents:shared-declarative-refresh-steps href=semantics.html#shared-declarative-refresh-steps>shared declarative refresh steps</a> with <var>document</var> and
     <var>value</var>.</ol>

    <p class=XXX>We do not currently have a spec for how to handle multiple `<code id=navigating-across-documents:refresh-2><a href=iana.html#refresh>Refresh</a></code>` headers. This is tracked as <a href=https://github.com/whatwg/html/issues/2900>issue #2900</a>.</p>
   <li><p>Return <var>document</var>.</ol>

  <div class=example>
   <p>In this example, the child document is not allowed to use <code id=navigating-across-documents:paymentrequest><a data-x-internal=paymentrequest href=https://w3c.github.io/payment-request/#dom-paymentrequest>PaymentRequest</a></code>,
   despite being <a id=navigating-across-documents:same-origin-domain-3 href=origin.html#same-origin-domain>same origin-domain</a> at the time the child document tries to use
   it. At the time the child document is initialized, only the parent document has set <code id=navigating-across-documents:dom-document-domain-3><a href=origin.html#dom-document-domain>document.domain</a></code>, and the child document has not.</p>

   <pre><code class=html>&lt;!-- https://foo.example.com/a.html -->
&lt;!doctype html>
&lt;script>
document.domain = 'example.com';
&lt;/script>
&lt;iframe src=b.html>&lt;/iframe></code></pre>

  <pre><code class=html>&lt;!-- https://bar.example.com/b.html -->
&lt;!doctype html>
&lt;script>
document.domain = 'example.com'; // This happens after the document is initialized
new PaymentRequest(…); // Not allowed to use
&lt;/script></code></pre>
  </div>

  <div class=example>
   <p>In this example, the child document <em>is</em> allowed to use
   <code id=navigating-across-documents:paymentrequest-2><a data-x-internal=paymentrequest href=https://w3c.github.io/payment-request/#dom-paymentrequest>PaymentRequest</a></code>, despite not being <a id=navigating-across-documents:same-origin-domain-4 href=origin.html#same-origin-domain>same origin-domain</a> at the time
   the child document tries to use it. At the time the child document is initialized, none of
   the documents have set <code id=navigating-across-documents:dom-document-domain-4><a href=origin.html#dom-document-domain>document.domain</a></code> yet so
   <a id=navigating-across-documents:same-origin-domain-5 href=origin.html#same-origin-domain>same origin-domain</a> falls back to a normal <a id=navigating-across-documents:same-origin-7 href=origin.html#same-origin>same origin</a> check.</p>

   <pre><code class=html>&lt;!-- https://example.com/a.html -->
&lt;!doctype html>
&lt;iframe src=b.html>&lt;/iframe>
&lt;!-- The child document is now initialized, before the script below is run. -->
&lt;script>
document.domain = 'example.com';
&lt;/script></code></pre>

   <pre><code class=html>&lt;!-- https://example.com/b.html -->
&lt;!doctype html>
&lt;script>
new PaymentRequest(…); // Allowed to use
&lt;/script></code></pre>
  </div>

  <p>Some of the sections below, to which the above algorithm defers in certain cases, require the
  user agent to <dfn id=update-the-session-history-with-the-new-page>update the session history with the new page</dfn>, given some <a href=#navigation-params id=navigating-across-documents:navigation-params-7>navigation
  params</a> <var>navigationParams</var>. When a user agent is required to do this, it must
  <a id=navigating-across-documents:queue-a-global-task-2 href=webappapis.html#queue-a-global-task>queue a global task</a> on the <a id=navigating-across-documents:networking-task-source-2 href=webappapis.html#networking-task-source>networking task source</a>, given the
  <a id=navigating-across-documents:concept-relevant-global href=webappapis.html#concept-relevant-global>relevant global object</a> of the <code id=navigating-across-documents:document-11><a href=dom.html#document>Document</a></code> object of the <a id=navigating-across-documents:current-entry-3 href=history.html#current-entry>current
  entry</a> (not the new one), to run the following steps:</p>

  <ol><li><p>Let <var>newDocument</var> be <var>navigationParams</var>'s <a href=#navigation-params-browsing-context id=navigating-across-documents:navigation-params-browsing-context-7>browsing context</a>'s <a id=navigating-across-documents:active-document-17 href=browsers.html#active-document>active
   document</a>.<li>
    <p><a href=#unload-a-document id=navigating-across-documents:unload-a-document-2>Unload</a> the <a href=history.html#she-document id=navigating-across-documents:she-document-2>document</a> of the <a id=navigating-across-documents:current-entry-4 href=history.html#current-entry>current entry</a>.</p>

    <p>If this instance of the <a href=#navigate id=navigating-across-documents:navigate-8>navigation</a> algorithm is canceled while
    this step is running the <a href=#unload-a-document id=navigating-across-documents:unload-a-document-3>unload a document</a> algorithm, then the <a href=#unload-a-document id=navigating-across-documents:unload-a-document-4>unload a
    document</a> algorithm must be allowed to run to completion, but this instance of the <a href=#navigate id=navigating-across-documents:navigate-9>navigation</a> algorithm must not run beyond this step. (In particular, for
    instance, the cancelation of this algorithm does not abort any event dispatch or script
    execution occurring as part of unloading the document or its descendants.)</p>
   <li>
    <dl><dt>If <var>navigationParams</var>'s <a href=#navigation-params-hh id=navigating-across-documents:navigation-params-hh-5>history
     handling</a> is "<code id=navigating-across-documents:hh-reload-3><a href=#hh-reload>reload</a></code>" or "<code id=navigating-across-documents:hh-entry-update><a href=#hh-entry-update>entry update</a></code>"<dd>
      <ol><li><p>Replace the <a href=history.html#she-document id=navigating-across-documents:she-document-3>document</a> of the <a id=navigating-across-documents:current-entry-5 href=history.html#current-entry>current
       entry</a>, and any other entries that reference the same <a href=history.html#she-document id=navigating-across-documents:she-document-4>document</a> as that entry, with <var>newDocument</var>.<li><p><a href=#traverse-the-history id=navigating-across-documents:traverse-the-history>Traverse the history</a> to the <a id=navigating-across-documents:current-entry-6 href=history.html#current-entry>current entry</a>.</ol>
     <dt>If the navigation was initiated with a <a id=navigating-across-documents:url-7 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> that <a href=https://url.spec.whatwg.org/#concept-url-equals id=navigating-across-documents:concept-url-equals-2 data-x-internal=concept-url-equals>equals</a> <var>newDocument</var>'s <a href=https://dom.spec.whatwg.org/#concept-document-url id=navigating-across-documents:the-document的-address-5 data-x-internal=the-document的-address>URL</a><dd>
      <ol><li><p>Replace the <a id=navigating-across-documents:current-entry-7 href=history.html#current-entry>current entry</a> with a new <a id=navigating-across-documents:session-history-entry-2 href=history.html#session-history-entry>session history entry</a>
       whose <a href=history.html#she-url id=navigating-across-documents:she-url>URL</a> is <var>newDocument</var>'s <a href=https://dom.spec.whatwg.org/#concept-document-url id=navigating-across-documents:the-document的-address-6 data-x-internal=the-document的-address>URL</a> and <a href=history.html#she-document id=navigating-across-documents:she-document-5>document</a> is
       <var>newDocument</var>.<li><p><a href=#traverse-the-history id=navigating-across-documents:traverse-the-history-2>Traverse the history</a> to the <a id=navigating-across-documents:current-entry-8 href=history.html#current-entry>current entry</a>.</ol>
     <dt>Otherwise<dd>
      <ol><li>
        <p>Remove all the entries in the <a id=navigating-across-documents:session-history-3 href=history.html#session-history>session history</a> after the <a id=navigating-across-documents:current-entry-9 href=history.html#current-entry>current
        entry</a>. If the <a id=navigating-across-documents:current-entry-10 href=history.html#current-entry>current entry</a> is the last entry in the session history,
        then no entries are removed.</p>

        <p class=note>This <a href=history.html#history-notes>doesn't necessarily have to affect</a> the
        user agent's user interface.</p>
       <li><p>Append a new <a id=navigating-across-documents:session-history-entry-3 href=history.html#session-history-entry>session history entry</a> to the <a id=navigating-across-documents:session-history-4 href=history.html#session-history>session history</a>,
       whose <a href=history.html#she-url id=navigating-across-documents:she-url-2>URL</a> is <var>newDocument</var>'s <a href=https://dom.spec.whatwg.org/#concept-document-url id=navigating-across-documents:the-document的-address-7 data-x-internal=the-document的-address>URL</a> and <a href=history.html#she-document id=navigating-across-documents:she-document-6>document</a> is
       <var>newDocument</var>.<li><p><a href=#traverse-the-history id=navigating-across-documents:traverse-the-history-3>Traverse the history</a> to the new entry, with <var id=navigating-across-documents:traverse-history-hh><a href=#traverse-history-hh>historyHandling</a></var> set to <var>navigationParams</var>'s <a href=#navigation-params-hh id=navigating-across-documents:navigation-params-hh-6>history handling</a>.</ol>
     </dl>
   <li><p>The <a href=#navigate id=navigating-across-documents:navigate-10>navigation algorithm</a> has now <dfn id=concept-navigate-mature>matured</dfn>.<li><p><a href=#try-to-scroll-to-the-fragment id=navigating-across-documents:try-to-scroll-to-the-fragment>Try to scroll to the fragment</a> for <var>newDocument</var>.</ol>

  <p>To <dfn id=try-to-scroll-to-the-fragment>try to scroll to the fragment</dfn> for a <code id=navigating-across-documents:document-12><a href=dom.html#document>Document</a></code> <var>document</var>,
  perform the following steps <a id=navigating-across-documents:in-parallel-2 href=infrastructure.html#in-parallel>in parallel</a>:</p>

  <ol><li><p>Wait for an <a id=navigating-across-documents:implementation-defined href=https://infra.spec.whatwg.org/#implementation-defined data-x-internal=implementation-defined>implementation-defined</a> amount of time. (This is intended to allow
   the user agent to optimize the user experience in the face of performance concerns.)<li>
    <p><a id=navigating-across-documents:queue-a-global-task-3 href=webappapis.html#queue-a-global-task>Queue a global task</a> on the <a id=navigating-across-documents:networking-task-source-3 href=webappapis.html#networking-task-source>networking task source</a> given
    <var>document</var>'s <a id=navigating-across-documents:concept-relevant-global-2 href=webappapis.html#concept-relevant-global>relevant global object</a> to run these steps:</p>

    <ol><li><p>If <var>document</var> has no parser, or its parser has <a href=parsing.html#stop-parsing id=navigating-across-documents:stop-parsing>stopped parsing</a>, or the user agent has reason to believe the user is no longer
     interested in scrolling to the <a href=https://url.spec.whatwg.org/#concept-url-fragment id=navigating-across-documents:concept-url-fragment-2 data-x-internal=concept-url-fragment>fragment</a>, then abort
     these steps.<li><p><a href=#scroll-to-the-fragment-identifier id=navigating-across-documents:scroll-to-the-fragment-identifier>Scroll to the fragment</a> given in <var>document</var>'s <a href=https://dom.spec.whatwg.org/#concept-document-url id=navigating-across-documents:the-document的-address-8 data-x-internal=the-document的-address>URL</a>. If this does not find <a href=#the-indicated-part-of-the-document id=navigating-across-documents:the-indicated-part-of-the-document>an indicated part of the document</a>, then <a href=#try-to-scroll-to-the-fragment id=navigating-across-documents:try-to-scroll-to-the-fragment-2>try to scroll to the
     fragment</a> for <var>document</var>.</ol>
   </ol>



  <h4 id=read-html><span class=secno>7.10.2</span> HTML 文件的页面加载处理模型<a href=#read-html class=self-link></a></h4>
<div data-zh-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" data-en-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" class=translate-info data-zh-file=https://github.com/whatwg-cn/html/edit/master/src/loading-web-pages/browsing-the-web/page-load-processing-model-for-html-files.zh.html data-en-file=https://github.com/whatwg-cn/html/blob/master/src/loading-web-pages/browsing-the-web/page-load-processing-model-for-html-files.en.html></div>

  <p>给定 <a href=#navigation-params id=read-html:navigation-params>导航参数</a> <dfn id=navigate-html>加载 HTML 文档</dfn> 时，
  用户代理必须在 <a href=webappapis.html#networking-task-source id=read-html:networking-task-source>网络任务源</a> <a href=webappapis.html#queue-a-task id=read-html:queue-a-task>入队一个任务</a>：</p>

  <ol><li><p>令 <var>document</var> 为给定 "<code>html</code>"，"<code>text/html</code>" 和 <var>navigationParams</var>
   <a href=#initialise-the-document-object id=read-html:initialise-the-document-object>创建和初始化 <code>Document</code> 对象</a> 的结果。<li>
    <p>创建一个 <a href=parsing.html#html-parser id=read-html:html-parser>HTML 解析器</a> 并把它关联到 <var>document</var>。
    获取过程中 <a href=webappapis.html#networking-task-source id=read-html:networking-task-source-2>网络任务源</a> 在 <a href=webappapis.html#task-queue id=read-html:task-queue>任务队列</a>
    里加入的所有 <a href=webappapis.html#concept-task id=read-html:concept-task>任务</a> 都必须把获取到的字节填充到解析器的
    <a href="parsing.html#the input byte stream" id="read-html:the input byte stream">输入字节流</a> 里，让 <a href=parsing.html#html-parser id=read-html:html-parser-2>HTML 解析器</a> 对输入流执行适当的处理。</p>

    <p class=note>在 <a href=parsing.html#tokenization id=read-html:tokenization>tokenizer</a> 里 <a href="parsing.html#the input byte stream" id="read-html:the input byte stream-2">输入字节流</a> 转化为能用的字符。
    这个过程部分依赖于资源的 <a href=infrastructure.html#content-type id=read-html:content-type>Content-Type 元数据</a> 里的字符编码信息；
    计算得到的类型不用作这一用途。</p>
   </ol>

  

  <p>当没有字节可以处理时，用户代理必须在 <a href=webappapis.html#networking-task-source id=read-html:networking-task-source-3>网络任务源</a> 里，
  用新创建的 <code id=read-html:document><a href=dom.html#document>Document</a></code> 的 <a href=webappapis.html#concept-relevant-global id=read-html:concept-relevant-global>相关全局对象</a>
  <a href=webappapis.html#queue-a-global-task id=read-html:queue-a-global-task>入队一个全局任务</a>，让解析器处理隐含的 EOF 字符，最终让
  <code id=read-html:event-load><a href=indices.html#event-load>load</a></code> 事件触发。</p>

  <p>创建 <code id=read-html:document-2><a href=dom.html#document>Document</a></code> 对象后，但在任何脚本执行前，
  当然也在解析器 <a href=parsing.html#stop-parsing id=read-html:stop-parsing>停止</a> 之前，用户代理必须给定 <var>navigationParams</var>，
  <a href=#update-the-session-history-with-the-new-page id=read-html:update-the-session-history-with-the-new-page>用新的页面更新会话历史</a>。</p>

  <p class=note><a href=parsing.html#parser-appcache>在 HTML 解析中</a>，会发生
  <a href=offline.html#concept-appcache-init id=read-html:concept-appcache-init>应用缓存选择</a>。</p>



  <h4 id=read-xml><span class=secno>7.10.3</span> <dfn>XML 文件的页面加载处理模型</dfn><a href=#read-xml class=self-link></a></h4>
<div data-zh-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" data-en-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" class=translate-info data-zh-file=https://github.com/whatwg-cn/html/edit/master/src/loading-web-pages/browsing-the-web/page-load-processing-model-for-xml-files.zh.html data-en-file=https://github.com/whatwg-cn/html/blob/master/src/loading-web-pages/browsing-the-web/page-load-processing-model-for-xml-files.en.html></div>

  <p>给定 <a href=#navigation-params id=read-xml:navigation-params>导航参数</a> <var>navigationParams</var> 和字符串 <var>type</var>，
  要显示内联 XML 文件时，用户代理必须遵循
  <cite>XML</cite> 和 <cite>Namespaces in XML</cite>, <cite>XML Media Types</cite>, <cite>DOM</cite> 和其他相关规范，
  使用 "<code>xml</code>"，<var>type</var> 和 <var>navigationParams</var> <a href=#initialise-the-document-object id=read-xml:initialise-the-document-object>
  创建和初始化 <code>Document</code> 对象</a>。也必须创建一个对应的 <a href=xhtml.html#xml-parser id=read-xml:xml-parser>XML 解析器</a>。
  <a href=references.html#refsXML>[XML]</a> <a href=references.html#refsXMLNS>[XMLNS]</a> <a href=references.html#refsRFC7303>[RFC7303]</a> <a href=references.html#refsDOM>[DOM]</a></p>

  <p class=note>编写这篇文档时，XML 规范社区其实还没有真正说明 XML 和 DOM 如何交互。</p> 

  <p>必须使用实际的 HTTP 头部和其他元数据（而不是本标准中算法修改后的），根据上述规范来确定字符编码。
  一旦建立了字符编码，必须把 <a href=https://dom.spec.whatwg.org/#concept-document-encoding id="read-xml:document's-character-encoding" data-x-internal="document's-character-encoding">文档的字符编码</a>
  设置为这个编码。</p>

  <p>如果根据上述 <cite>XML</cite> 解析的 <a href=https://dom.spec.whatwg.org/#document-element id=read-xml:document-element data-x-internal=document-element>文档元素</a> 是一个
  有着<code id=read-xml:attr-html-manifest><a href=semantics.html#attr-html-manifest>manifest</a></code> 属性值为非空字符串的 <code id=read-xml:the-html-element><a href=semantics.html#the-html-element>html</a></code> 元素，
  那么当该元素 <a href=infrastructure.html#insert-an-element-into-a-document id=read-xml:insert-an-element-into-a-document>插入到文档时</a>，
  用户代理必须相对于那个元素的 <a href=https://dom.spec.whatwg.org/#concept-node-document id=read-xml:node-document data-x-internal=node-document>节点文档</a>
  <a href=infrastructure.html#parse-a-url id=read-xml:parse-a-url>解析</a> 那个属性的值，如果解析成功，必须在
  <a href=infrastructure.html#resulting-url-record id=read-xml:resulting-url-record>结果 URL 记录</a>
  上应用 <a href=https://url.spec.whatwg.org/#concept-url-serializer id=read-xml:concept-url-serializer data-x-internal=concept-url-serializer>URL 序列化算法</a>，
  期间设置 <i>排除 fragment 标志</i>，
  来获得 <var>manifest URL</var>，然后以 <var>manifest URL</var> 为清单 URL 执行
  <a href=offline.html#concept-appcache-init id=read-xml:concept-appcache-init>应用缓存选择算法</a>，传入新创建的 <code id=read-xml:document><a href=dom.html#document>Document</a></code>。
  否则如果该属性不存在，值为空字符串，或值解析失败，则在
  <a href=https://dom.spec.whatwg.org/#document-element id=read-xml:document-element-2 data-x-internal=document-element>文档元素</a> <a href=infrastructure.html#insert-an-element-into-a-document id=read-xml:insert-an-element-into-a-document-2>插入</a> 到文档中时，用户代理必须不参考清单，并传入
  <code id=read-xml:document-2><a href=dom.html#document>Document</a></code> 来执行 <a href=offline.html#concept-appcache-init id=read-xml:concept-appcache-init-2>应用缓存选择算法</a>。</p>

  <p class=note>由于 <code id=read-xml:attr-html-manifest-2><a href=semantics.html#attr-html-manifest>manifest</a></code> 属性的解析只发生
  在解析 <a href=https://dom.spec.whatwg.org/#document-element id=read-xml:document-element-3 data-x-internal=document-element>文档元素</a> 时，任何在
  <a href=https://dom.spec.whatwg.org/#document-element id=read-xml:document-element-4 data-x-internal=document-element>文档元素</a> 之前的处理指令中引用的 URL
  （例如<code>&lt;?xml-stylesheet?></code> PI）将会从网络获取，不会被缓存。</p>

  <p>
  然后用代理必须用新创建的 <code id=read-xml:document-3><a href=dom.html#document>Document</a></code> 和 <var>navigationParams</var>，
  <a href=#update-the-session-history-with-the-new-page id=read-xml:update-the-session-history-with-the-new-page>更新会话历史为新页面</a>。
  用户代理必须在任何脚本执行之前更新会话历史，可能在文档完成解析之前（所以才能实现 <i>增量渲染</i>）。</p>

  <p>解析过程中的错误消息（例如 XML 命名空间良构性错误）可以通过修改 <code id=read-xml:document-4><a href=dom.html#document>Document</a></code>
  来内联地报告。</p>



  <h4 id=read-text><span class=secno>7.10.4</span> <dfn>文本文件的页面加载处理模型</dfn><a href=#read-text class=self-link></a></h4>
<div data-zh-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" data-en-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" class=translate-info data-zh-file=https://github.com/whatwg-cn/html/edit/master/src/loading-web-pages/browsing-the-web/page-load-processing-model-for-text-files.zh.html data-en-file=https://github.com/whatwg-cn/html/blob/master/src/loading-web-pages/browsing-the-web/page-load-processing-model-for-text-files.en.html></div>

  <p>给定 <a href=#navigation-params id=read-text:navigation-params>导航参数</a> <var>navigationParams</var> 和字符串 <var>type</var> 加载纯文本文档时，
  用户代理必须在 <a href=webappapis.html#networking-task-source id=read-text:networking-task-source>网络任务源</a> 里 <a href=webappapis.html#queue-a-task id=read-text:queue-a-task>入队一个任务</a>：</p>

  <ol><li><p>令 <var>document</var> 为给定 "<code>html</code>"，<var>type</var> 和 <var>navigationParams</var>
   <a href=#initialise-the-document-object id=read-text:initialise-the-document-object>创建和初始化 <code>Document</code> 对象</a> 的结果。<li><p>创建一个 <a href=parsing.html#html-parser id=read-text:html-parser>HTML 解析器</a> 并把它关联到 <var>document</var>。
   假装 tokenizer 输出了标签名为"pre" 的开始标签，紧接着一个 U+000A LINE FEED (LF) 字符，
   
   然后把 <a href=parsing.html#html-parser id=read-text:html-parser-2>HTML 解析器</a> 的 tokenizer 切换到 <a href=parsing.html#plaintext-state id=read-text:plaintext-state>PLAINTEXT 状态</a>。
   获取过程中 <a href=webappapis.html#networking-task-source id=read-text:networking-task-source-2>网络任务源</a> 在 <a href=webappapis.html#task-queue id=read-text:task-queue>任务队列</a>
   里加入的所有 <a href=webappapis.html#concept-task id=read-text:concept-task>任务</a> 都必须把获取到的字节填充到解析器的
   <a href="parsing.html#the input byte stream" id="read-text:the input byte stream">输入字节流</a> 里，让 <a href=parsing.html#html-parser id=read-text:html-parser-3>HTML 解析器</a> 对输入流执行适当的处理。</ol>

  <p>如何将纯文本文档的字节转换为真正字符的规则，
  以及真正渲染文字给用户的规则，定义在该资源
  <a href=https://mimesniff.spec.whatwg.org/#computed-mime-type id=read-text:content-type-sniffing-2 data-x-internal=content-type-sniffing-2>计算得到的 MIME 类型</a>
  （即 <var>type</var>）的规范中。</p>

  <p><a href=https://dom.spec.whatwg.org/#concept-document-encoding id="read-text:document's-character-encoding" data-x-internal="document's-character-encoding">文档的字符编码</a> 必须设置为解码文档时用的字符编码。</p>

  <p>在创建 <code id=read-text:document><a href=dom.html#document>Document</a></code> 对象时，用户代理必须不参考清单，并传入新创建的
  <code id=read-text:document-2><a href=dom.html#document>Document</a></code> 来执行 <a href=offline.html#concept-appcache-init id=read-text:concept-appcache-init>应用缓存选择算法</a>。</p>

  

  <p>当没有字节可以处理时，用户代理必须在 <a href=webappapis.html#networking-task-source id=read-text:networking-task-source-3>网络任务源</a> 里，
  用新创建的 <code id=read-text:document-3><a href=dom.html#document>Document</a></code> 的 <a href=webappapis.html#concept-relevant-global id=read-text:concept-relevant-global>相关全局对象</a>
  <a href=webappapis.html#queue-a-global-task id=read-text:queue-a-global-task>入队一个全局任务</a>，让解析器处理隐含的 EOF 字符，最终让
  <code id=read-text:event-load><a href=indices.html#event-load>load</a></code> 事件触发。</p>

  <p>在创建 <code id=read-text:document-4><a href=dom.html#document>Document</a></code> 对象后，页面完全结束加载之前，
  用户代理必须给定 <var>navigationParams</var>，
  <a href=#update-the-session-history-with-the-new-page id=read-text:update-the-session-history-with-the-new-page>用新的页面更新会话历史</a>。</p>

  <p>用户代理可能会添加内容到 <code id=read-text:document-5><a href=dom.html#document>Document</a></code> 的 <code id=read-text:the-head-element><a href=semantics.html#the-head-element>head</a></code> 元素，
  例如链接一个样式表，提供一个脚本，或者给文档一个 <code id=read-text:the-title-element><a href=semantics.html#the-title-element>title</a></code>。</p>

  <p class=note>特别是如果用户代理支持 RFC 3676 的 <code>Format=Flowed</code>
  特性，就需要应用额外的样式来使文字正确折行，以及处理引用特性。
  这可以通过使用 CSS 扩展来完成。</p>


  <h4 id=read-multipart-x-mixed-replace><span class=secno>7.10.5</span> <dfn> <code>multipart/x-mixed-replace</code> 资源的媒体的页面加载处理模型</dfn><a href=#read-multipart-x-mixed-replace class=self-link></a></h4>
<div data-zh-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" data-en-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" class=translate-info data-zh-file=https://github.com/whatwg-cn/html/edit/master/src/loading-web-pages/browsing-the-web/page-load-processing-model-for-multipart-x-mixed-replace-resources.zh.html data-en-file=https://github.com/whatwg-cn/html/blob/master/src/loading-web-pages/browsing-the-web/page-load-processing-model-for-multipart-x-mixed-replace-resources.en.html></div>

  <p>在 <a href=browsers.html#browsing-context id=read-multipart-x-mixed-replace:browsing-context>浏览上下文</a> 加载一个
  <code id=read-multipart-x-mixed-replace:multipart/x-mixed-replace><a href=iana.html#multipart/x-mixed-replace>multipart/x-mixed-replace</a></code> 类型的资源时，
  用户代理必须使用 multipart 类型的规则解析资源。 <a href=references.html#refsRFC2046>[RFC2046]</a></p>

  <p class=XXX>该算法传入了 <a href=#navigation-params id=read-multipart-x-mixed-replace:navigation-params>导航参数</a>，但还不清楚如何使用。</p>

  <p>对资源中的每个 body part，用户代理必须执行 <a href=#process-a-navigate-response id=read-multipart-x-mixed-replace:process-a-navigate-response>处理导航响应算法</a>，
  执行时要使用新的 body 部分和同样的 <a href=browsers.html#browsing-context id=read-multipart-x-mixed-replace:browsing-context-2>浏览上下文</a>，
  如果同一资源中的上一个 body 部分产生了 <a href=#initialise-the-document-object id=read-multipart-x-mixed-replace:initialise-the-document-object>创建和初始化 <code>Document</code> 对象</a>，
  就把 <a href=#navigation-params-hh id=read-multipart-x-mixed-replace:navigation-params-hh>历史处理</a> 设为 "<code id=read-multipart-x-mixed-replace:hh-replace><a href=#hh-replace>replace</a></code>"，
  否则使用跟最初调用这部分的 <a href=#navigate id=read-multipart-x-mixed-replace:navigate>导航</a> 时同样的配置。</p>

  <p>为使得算法处理这些 body part 的表现与处理独立的资源一致，
  在碰到边界时用户代理必须表现地就像没有更多字节一样。</p>

  <p class=note>因此， <code id=read-multipart-x-mixed-replace:event-load><a href=indices.html#event-load>load</a></code> 事件（以及 <code id=read-multipart-x-mixed-replace:event-unload><a href=indices.html#event-unload>unload</a></code> 事件）会为每个载入的 body part 触发。</p>



  <h4 id=read-media><span class=secno>7.10.6</span> <dfn>媒体的页面加载处理模型</dfn><a href=#read-media class=self-link></a></h4>
<div data-zh-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" data-en-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" class=translate-info data-zh-file=https://github.com/whatwg-cn/html/edit/master/src/loading-web-pages/browsing-the-web/page-load-processing-model-for-media.zh.html data-en-file=https://github.com/whatwg-cn/html/blob/master/src/loading-web-pages/browsing-the-web/page-load-processing-model-for-media.en.html></div>

  <p>给定 <a href=#navigation-params id=read-media:navigation-params>导航参数</a> <var>navigationParams</var> 和字符串 <var>type</var>，
  加载图片、视频或音频资源时用户代理应该：</p>

  <ol><li><p>令 <var>document</var> 为给定 "<code>html</code>"，<var>type</var> 和 <var>navigationParams</var>
   <a href=#initialise-the-document-object id=read-media:initialise-the-document-object>创建和初始化 <code>Document</code> 对象</a> 的结果。<li><p>加一个 <code id=read-media:the-html-element><a href=semantics.html#the-html-element>html</a></code> 元素到 <var>document</var>。<li><p>加一个 <code id=read-media:the-head-element><a href=semantics.html#the-head-element>head</a></code> 元素到 <code id=read-media:the-html-element-2><a href=semantics.html#the-html-element>html</a></code> 元素。<li><p>加一个 <code id=read-media:the-body-element><a href=sections.html#the-body-element>body</a></code> 元素到 <code id=read-media:the-html-element-3><a href=semantics.html#the-html-element>html</a></code> 元素。<li><p>为媒体加一个 <var>host element</var>（见下文）到 <code id=read-media:the-body-element-2><a href=sections.html#the-body-element>body</a></code> 元素。<li><p>把 <var>host element</var> 元素的适当属性（见下文）设为图片、视频或音频资源的地址。</ol>

  <p>要为媒体创建的 <var>host element</var> 元素由下表中每行的第二个单元格给出，
  同行的第一个单元格是媒体的描述。 要设置的属性是同行的第三个单元格。 </p>

  <table><thead><tr><th> 媒体类型
         <th> 媒体元素
         <th> 适当的属性
   <tbody><tr><td> Image
         <td> <code id=read-media:the-img-element><a href=embedded-content.html#the-img-element>img</a></code>
         <td> <code id=read-media:attr-img-src><a href=embedded-content.html#attr-img-src>src</a></code>
    <tr><td> Video
         <td> <code id=read-media:the-video-element><a href=media.html#the-video-element>video</a></code>
         <td> <code id=read-media:attr-media-src><a href=media.html#attr-media-src>src</a></code>
    <tr><td> Audio
         <td> <code id=read-media:the-audio-element><a href=media.html#the-audio-element>audio</a></code>
         <td> <code id=read-media:attr-media-src-2><a href=media.html#attr-media-src>src</a></code>
  </table>

  

  <p>然后，用户代理必须表现地像已经 <a href=parsing.html#stop-parsing id=read-media:stop-parsing>停止解析</a> 一样。</p>

  <p>在创建 <code id=read-media:document><a href=dom.html#document>Document</a></code> 对象时，用户代理必须不参考清单，并传入新创建的
  <code id=read-media:document-2><a href=dom.html#document>Document</a></code> 来执行 <a href=offline.html#concept-appcache-init id=read-media:concept-appcache-init>应用缓存选择算法</a>。</p>

  <p>在创建 <code id=read-media:document-3><a href=dom.html#document>Document</a></code> 对象后，页面完全结束加载之前，
  用户代理必须用 <var>navigationParams</var> <a href=#update-the-session-history-with-the-new-page id=read-media:update-the-session-history-with-the-new-page>更新会话历史到新页面</a>。</p>

  <p>用户代理可能会添加内容到 <code id=read-media:document-4><a href=dom.html#document>Document</a></code> 的 <code id=read-media:the-head-element-2><a href=semantics.html#the-head-element>head</a></code> 元素，
  或者添加属性到 <var>host element</var> 元素，例如链接一个样式表，
  提供一个脚本，给文档一个 <code id=read-media:the-title-element><a href=semantics.html#the-title-element>title</a></code>，或者让媒体
  <a href=media.html#attr-media-autoplay id=read-media:attr-media-autoplay>自动播放</a>。</p>



  <h4 id=read-plugin><span class=secno>7.10.7</span> <dfn>使用插件的内容的页面加载处理模型</dfn><a href=#read-plugin class=self-link></a></h4>
<div data-zh-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" data-en-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" class=translate-info data-zh-file=https://github.com/whatwg-cn/html/edit/master/src/loading-web-pages/browsing-the-web/page-load-processing-model-for-content-that-uses-plugins.zh.html data-en-file=https://github.com/whatwg-cn/html/blob/master/src/loading-web-pages/browsing-the-web/page-load-processing-model-for-content-that-uses-plugins.en.html></div>

  <p>给定 <a href=#navigation-params id=read-plugin:navigation-params>导航参数</a> <var>navigationParams</var> 和字符串 <var>type</var>，
  加载一个需要渲染外部资源的资源时用户代理应该：</p>

  <ol><li><p>令 <var>document</var> 为给定 "<code>html</code>"，<var>type</var> 和 <var>navigationParams</var>
   <a href=#initialise-the-document-object id=read-plugin:initialise-the-document-object>创建和初始化 <code>Document</code> 对象</a> 的结果。<li><p>把 <var>document</var> 标记为 <dfn id=plugin-document>插件文档</dfn>。<li><p>加一个 <code id=read-plugin:the-html-element><a href=semantics.html#the-html-element>html</a></code> 元素到 <var>document</var>。<li><p>加一个 <code id=read-plugin:the-head-element><a href=semantics.html#the-head-element>head</a></code> 元素到 <code id=read-plugin:the-html-element-2><a href=semantics.html#the-html-element>html</a></code> 元素。<li><p>加一个 <code id=read-plugin:the-body-element><a href=sections.html#the-body-element>body</a></code> 元素到 <code id=read-plugin:the-html-element-3><a href=semantics.html#the-html-element>html</a></code> 元素。<li><p>加一个 <code id=read-plugin:the-embed-element><a href=iframe-embed-object.html#the-embed-element>embed</a></code> 元素到 <code id=read-plugin:the-body-element-2><a href=sections.html#the-body-element>body</a></code> 元素。<li><p>设置 <code id=read-plugin:the-embed-element-2><a href=iframe-embed-object.html#the-embed-element>embed</a></code> 元素的 <code id=read-plugin:attr-embed-src><a href=iframe-embed-object.html#attr-embed-src>src</a></code> 属性为资源地址。</ol>

  <p class=note><a href=#plugin-document id=read-plugin:plugin-document>插件文档</a> 这个术语用于
  <cite>Content Security Policy</cite> 作为确保 <code id=read-plugin:the-iframe-element><a href=iframe-embed-object.html#the-iframe-element>iframe</a></code>
  不能被用于逃脱 <code>plugin-types</code> 指令机制的一部分。 <a href=references.html#refsCSP>[CSP]</a></p>

  

  <p>然后，用户代理必须表现地像已经 <a href=parsing.html#stop-parsing id=read-plugin:stop-parsing>停止解析</a> 一样。</p>

  <p>在创建 <code id=read-plugin:document><a href=dom.html#document>Document</a></code> 对象时，用户代理必须不参考清单，并传入新创建的
  <code id=read-plugin:document-2><a href=dom.html#document>Document</a></code> 来执行 <a href=offline.html#concept-appcache-init id=read-plugin:concept-appcache-init>应用缓存选择算法</a>。</p>

  <p>在创建 <code id=read-plugin:document-3><a href=dom.html#document>Document</a></code> 对象后，页面完全结束加载之前，
  用户代理必须给定 <var>navigationParams</var>，
  <a href=#update-the-session-history-with-the-new-page id=read-plugin:update-the-session-history-with-the-new-page>用新的页面更新会话历史</a>。</p>

  <p>用户代理可能会添加内容到 <code id=read-plugin:document-4><a href=dom.html#document>Document</a></code> 的 <code id=read-plugin:the-head-element-2><a href=semantics.html#the-head-element>head</a></code> 元素，
  或者添加属性到 <code id=read-plugin:the-embed-element-3><a href=iframe-embed-object.html#the-embed-element>embed</a></code> 元素，例如链接一个样式表或者给文档一个 <code id=read-plugin:the-title-element><a href=semantics.html#the-title-element>title</a></code>。</p>

  <p id=sandboxPluginNavigate class=note>如果 <code id=read-plugin:document-5><a href=dom.html#document>Document</a></code> 的
  <a href=origin.html#active-sandboxing-flag-set id=read-plugin:active-sandboxing-flag-set>激活沙盒标识</a> 的
  <a href=origin.html#sandboxed-plugins-browsing-context-flag id=read-plugin:sandboxed-plugins-browsing-context-flag>沙盒插件浏览上下文标识</a> 处于已设置状态，
  如果相关 <a href=infrastructure.html#plugin id=read-plugin:plugin>插件</a> 不够
  <a href=infrastructure.html#concept-plugin-secure id=read-plugin:concept-plugin-secure>安全</a> 的话，
  合成的 <code id=read-plugin:the-embed-element-4><a href=iframe-embed-object.html#the-embed-element>embed</a></code> 元素将会 <a href=iframe-embed-object.html#sandboxPluginEmbed>渲染内容失败</a>。</p>



  <h4 id=read-ua-inline><span class=secno>7.10.8</span> <dfn>没有 DOM 的内联内容的页面加载处理模型</dfn><a href=#read-ua-inline class=self-link></a></h4>
<div data-zh-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" data-en-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" class=translate-info data-zh-file=https://github.com/whatwg-cn/html/edit/master/src/loading-web-pages/browsing-the-web/page-load-processing-model-for-inline-content-that-doesnt-have-a-dom.zh.html data-en-file=https://github.com/whatwg-cn/html/blob/master/src/loading-web-pages/browsing-the-web/page-load-processing-model-for-inline-content-that-doesnt-have-a-dom.en.html></div>

  <p>给定 <a href=browsers.html#browsing-context id=read-ua-inline:browsing-context>浏览上下文</a> <var>browsingContext</var>，
  用户代理显示内联的用户代理页面时应该：</p>

  <ol><li>
    <p>令 <var>navigationParams</var> 为新的 <a href=#navigation-params id=read-ua-inline:navigation-params>导航参数</a>，其 <a href=#navigation-params-request id=read-ua-inline:navigation-params-request>request</a> 为 null，<a href=#navigation-params-response id=read-ua-inline:navigation-params-response>response</a> 为 null，<a href=#navigation-params-origin id=read-ua-inline:navigation-params-origin>origin</a> 为新的 <a href=origin.html#concept-origin-opaque id=read-ua-inline:concept-origin-opaque>不透明源</a>，<a href=#navigation-params-sandboxing id=read-ua-inline:navigation-params-sandboxing>final sandboxing flag set</a> 为空集合，<a href=#navigation-params-coop id=read-ua-inline:navigation-params-coop>跨域 opener 策略</a> 为 "<code id=read-ua-inline:coop-unsafe-none><a href=origin.html#coop-unsafe-none>unsafe-none</a></code>"，<a href=#navigation-params-reserved-environment id=read-ua-inline:navigation-params-reserved-environment>保留环境</a> 为 null，<a href=#navigation-params-browsing-context id=read-ua-inline:navigation-params-browsing-context>浏览上下文</a> 为
    <var>browsingContext</var> 且 <a href=#navigation-params-bc-switch-needed id=read-ua-inline:navigation-params-bc-switch-needed>需要切换浏览上下文</a> 为 false。</p>

    <p class=XXX>下一步调用的算法无法处理空的 <a href=#navigation-params-response id=read-ua-inline:navigation-params-response-2>响应</a>。可能我们需要构造一个。</p>
   <li><p>令 <var>document</var> 为给定 "<code>html</code>"，"<code>text/html</code>" 和 <var>navigationParams</var>
   <a href=#initialise-the-document-object id=read-ua-inline:initialise-the-document-object>创建和初始化 <code>Document</code> 对象</a> 的结果。<li><p>或者把 <var>document</var> 关联到不使用正常 <code id=read-ua-inline:document><a href=dom.html#document>Document</a></code> 渲染规则的自定义的渲染，
   或者把 <var>document</var> 改成用户代理想要渲染的内容。</p>
  </ol>

  

  <p>一旦页面已经建立，用户代理必须表现地像已经 <a href=parsing.html#stop-parsing id=read-ua-inline:stop-parsing>停止解析</a> 一样。</p>

  <p>在创建 <code id=read-ua-inline:document-2><a href=dom.html#document>Document</a></code> 对象时，用户代理必须不参考清单，并传入新创建的
  <code id=read-ua-inline:document-3><a href=dom.html#document>Document</a></code> 来执行 <a href=offline.html#concept-appcache-init id=read-ua-inline:concept-appcache-init>应用缓存选择算法</a>。</p>

  <p>在创建 <code id=read-ua-inline:document-4><a href=dom.html#document>Document</a></code> 对象后，页面结束完全建立之前，
  用户代理必须给定 <var>navigationParams</var>，
  <a href=#update-the-session-history-with-the-new-page id=read-ua-inline:update-the-session-history-with-the-new-page>用新的页面更新会话历史</a>。</p>




  <h4 id=scroll-to-fragid><span class=secno>7.10.9</span> Navigating to a fragment<a href=#scroll-to-fragid class=self-link></a></h4>
<div data-zh-date="" data-en-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" class=translate-info data-zh-file="https://github.com/whatwg-cn/html/new/master/src/loading-web-pages/browsing-the-web/navigating-to-a-fragment.zh.html?filename=navigating-to-a-fragment.zh.html&amp;value=%E4%BB%8E%20https%3A%2F%2Fgithub.com%2Fwhatwg-cn%2Fhtml%2Fblob%2Fmaster%2Fsrc%2Floading-web-pages%2Fbrowsing-the-web%2Fnavigating-to-a-fragment.en.html%20%E6%8B%B7%E8%B4%9D%E8%8B%B1%E6%96%87%E6%BA%90%E7%A0%81%E8%87%B3%E6%AD%A4%EF%BC%8C%E5%BC%80%E5%A7%8B%E7%BF%BB%E8%AF%91" data-en-file=https://github.com/whatwg-cn/html/blob/master/src/loading-web-pages/browsing-the-web/navigating-to-a-fragment.en.html></div>

  <p>To <dfn id=navigate-fragid>navigate to a fragment</dfn> given a <a id=scroll-to-fragid:browsing-context href=browsers.html#browsing-context>browsing
  context</a> <var>browsingContext</var>, a <a id=scroll-to-fragid:url href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> <var>url</var>, and a <a href=#history-handling-behavior id=scroll-to-fragid:history-handling-behavior>history
  handling behavior</a> <var>historyHandling</var>:</p>

  <ol><li>
    <p>If <var>historyHandling</var> is not "<code id=scroll-to-fragid:hh-replace><a href=#hh-replace>replace</a></code>", then remove
    all the entries in <var>browsingContext</var>'s <a id=scroll-to-fragid:session-history href=history.html#session-history>session history</a> after the
    <a id=scroll-to-fragid:current-entry href=history.html#current-entry>current entry</a>. (If the <a id=scroll-to-fragid:current-entry-2 href=history.html#current-entry>current entry</a> is the last entry in the session
    history, then no entries are removed.)</p>

    <p class=note>This <a href=history.html#history-notes>doesn't necessarily have to affect</a> the user
    agent's user interface.</p>
   <li><p>Remove any <a href=webappapis.html#concept-task id=scroll-to-fragid:concept-task>tasks</a> queued by the <a id=scroll-to-fragid:history-traversal-task-source href=webappapis.html#history-traversal-task-source>history traversal
   task source</a> that are associated with any <code id=scroll-to-fragid:document><a href=dom.html#document>Document</a></code> objects in
   <var>browsingContext</var>'s <a id=scroll-to-fragid:top-level-browsing-context href=browsers.html#top-level-browsing-context>top-level browsing context</a>'s <a id=scroll-to-fragid:document-family href=browsers.html#document-family>document
   family</a>.<li><p>Append a new <a id=scroll-to-fragid:session-history-entry href=history.html#session-history-entry>session history entry</a> to the <a id=scroll-to-fragid:session-history-2 href=history.html#session-history>session history</a> whose
   <a href=history.html#she-url id=scroll-to-fragid:she-url>URL</a> is <var>url</var>, <a href=history.html#she-document id=scroll-to-fragid:she-document>document</a>
   is the <a id=scroll-to-fragid:current-entry-3 href=history.html#current-entry>current entry</a>'s <a href=history.html#she-document id=scroll-to-fragid:she-document-2>document</a>, and <a href=history.html#she-scroll-restoration-mode id=scroll-to-fragid:she-scroll-restoration-mode>scroll restoration mode</a> is the <a id=scroll-to-fragid:current-entry-4 href=history.html#current-entry>current
   entry</a>'s <a href=history.html#she-scroll-restoration-mode id=scroll-to-fragid:she-scroll-restoration-mode-2>scroll restoration
   mode</a>.<li><p><a href=#traverse-the-history id=scroll-to-fragid:traverse-the-history>Traverse the history</a> to the new entry, with <var id=scroll-to-fragid:traverse-history-hh><a href=#traverse-history-hh>historyHandling</a></var> set to <var>historyHandling</var> and with
   <var><a href=#nonblockingevents id=scroll-to-fragid:nonblockingevents>nonBlockingEvents</a></var> set to true. This will <a href=#scroll-to-the-fragment-identifier id=scroll-to-fragid:scroll-to-the-fragment-identifier>scroll to the
   fragment</a> given in what is now the document's <a href=https://dom.spec.whatwg.org/#concept-document-url id=scroll-to-fragid:the-document的-address data-x-internal=the-document的-address>URL</a>.</ol>

  <p class=note>If the scrolling fails because the relevant <a href=https://dom.spec.whatwg.org/#concept-id id=scroll-to-fragid:concept-id data-x-internal=concept-id>ID</a> has
  not yet been parsed, then the original <a href=#navigate id=scroll-to-fragid:navigate>navigation</a> algorithm will
  take care of the scrolling instead, as the last few steps of its <a href=#update-the-session-history-with-the-new-page id=scroll-to-fragid:update-the-session-history-with-the-new-page>update the session history
  with the new page</a> algorithm.</p>

  <hr>

  <p>When the user agent is required to <dfn id=scroll-to-the-fragment-identifier>scroll to the fragment</dfn> and <a href=#the-indicated-part-of-the-document id=scroll-to-fragid:the-indicated-part-of-the-document>the indicated part
  of the document</a>, if any, is <a id=scroll-to-fragid:being-rendered href=rendering.html#being-rendered>being rendered</a>, the user agent must either change
  the scrolling position of the document using the following algorithm, or perform some other action
  such that <a href=#the-indicated-part-of-the-document id=scroll-to-fragid:the-indicated-part-of-the-document-2>the indicated part of the document</a> is brought to the user's attention. If
  there is no indicated part, or if the indicated part is not <a id=scroll-to-fragid:being-rendered-2 href=rendering.html#being-rendered>being rendered</a>, then the
  user agent must do nothing. The aforementioned algorithm is as follows:</p>

  <ol><li><p>If there is no <a href=#the-indicated-part-of-the-document id=scroll-to-fragid:the-indicated-part-of-the-document-3>indicated part of the
   document</a>, set the <code id=scroll-to-fragid:document-2><a href=dom.html#document>Document</a></code>'s <a href=#target-element id=scroll-to-fragid:target-element>target element</a> to null.<li>
    <p>If the <a href=#the-indicated-part-of-the-document id=scroll-to-fragid:the-indicated-part-of-the-document-4>indicated part of the
    document</a> is the top of the document, then:</p>

    <ol><li><p>Set the <code id=scroll-to-fragid:document-3><a href=dom.html#document>Document</a></code>'s <a href=#target-element id=scroll-to-fragid:target-element-2>target element</a> to null.<li><p><a id=scroll-to-fragid:scroll-to-the-beginning-of-the-document href=https://drafts.csswg.org/cssom-view/#scroll-to-the-beginning-of-the-document data-x-internal=scroll-to-the-beginning-of-the-document>Scroll to the beginning of the document</a> for the <code id=scroll-to-fragid:document-4><a href=dom.html#document>Document</a></code>. <a href=references.html#refsCSSOMVIEW>[CSSOMVIEW]</a></ol>
   <li>
    <p>Otherwise:</p>

    <ol><li><p>Let <var>target</var> be element that is <a href=#the-indicated-part-of-the-document id=scroll-to-fragid:the-indicated-part-of-the-document-5>the indicated part of the
     document</a>.<li><p>Set the <code id=scroll-to-fragid:document-5><a href=dom.html#document>Document</a></code>'s <a href=#target-element id=scroll-to-fragid:target-element-3>target element</a> to
     <var>target</var>.<li><p><a href=https://drafts.csswg.org/cssom-view/#scroll-an-element-into-view id=scroll-to-fragid:scroll-an-element-into-view data-x-internal=scroll-an-element-into-view>Scroll <var>target</var> into view</a>,
     with <var>behavior</var> set to "auto", <var>block</var> set to "start", and <var>inline</var>
     set to "nearest". <a href=references.html#refsCSSOMVIEW>[CSSOMVIEW]</a><li><p>Run the <a id=scroll-to-fragid:focusing-steps href=interaction.html#focusing-steps>focusing steps</a> for <var>target</var>, with the
     <code id=scroll-to-fragid:document-6><a href=dom.html#document>Document</a></code>'s <a id=scroll-to-fragid:viewport href=https://drafts.csswg.org/css2/#viewport data-x-internal=viewport>viewport</a> as the <var>fallback target</var>.<li><p>Move the <a id=scroll-to-fragid:sequential-focus-navigation-starting-point href=interaction.html#sequential-focus-navigation-starting-point>sequential focus navigation starting point</a> to
     <var>target</var>.</ol>
   </ol>

  <p><dfn id=the-indicated-part-of-the-document>The indicated part of the document</dfn> is the one that the <a href=https://url.spec.whatwg.org/#concept-url-fragment id=scroll-to-fragid:concept-url-fragment data-x-internal=concept-url-fragment>fragment</a>, if any, identifies. The semantics of the <a href=https://url.spec.whatwg.org/#concept-url-fragment id=scroll-to-fragid:concept-url-fragment-2 data-x-internal=concept-url-fragment>fragment</a> in terms of mapping it to a node is defined by the
  specification that defines the <a id=scroll-to-fragid:mime-type href=https://mimesniff.spec.whatwg.org/#mime-type data-x-internal=mime-type>MIME type</a> used by the <code id=scroll-to-fragid:document-7><a href=dom.html#document>Document</a></code> (for
  example, the processing of <a href=https://url.spec.whatwg.org/#concept-url-fragment id=scroll-to-fragid:concept-url-fragment-3 data-x-internal=concept-url-fragment>fragments</a> for <a href=https://mimesniff.spec.whatwg.org/#xml-mime-type id=scroll-to-fragid:xml-mime-type data-x-internal=xml-mime-type>XML MIME types</a> is the responsibility of RFC7303). <a href=references.html#refsRFC7303>[RFC7303]</a></p>

  <p>There is also a <dfn id=target-element>target element</dfn> for each <code id=scroll-to-fragid:document-8><a href=dom.html#document>Document</a></code>, which is used in
  defining the <code id=scroll-to-fragid:selector-target><a href=semantics-other.html#selector-target>:target</a></code> pseudo-class and is updated by the
  above algorithm. It is initially null.</p>

  <p>For HTML documents (and <a href=https://mimesniff.spec.whatwg.org/#html-mime-type id=scroll-to-fragid:html-mime-type data-x-internal=html-mime-type>HTML MIME types</a>), the following
  processing model must be followed to determine what <a href=#the-indicated-part-of-the-document id=scroll-to-fragid:the-indicated-part-of-the-document-6>the indicated part of the
  document</a> is.</p>

  <ol><li><p>Let <var>fragment</var> be the document's <a href=https://dom.spec.whatwg.org/#concept-document-url id=scroll-to-fragid:the-document的-address-2 data-x-internal=the-document的-address>URL</a>'s
   <a href=https://url.spec.whatwg.org/#concept-url-fragment id=scroll-to-fragid:concept-url-fragment-4 data-x-internal=concept-url-fragment>fragment</a>.<li><p>If <var>fragment</var> is the empty string, then <a href=#the-indicated-part-of-the-document id=scroll-to-fragid:the-indicated-part-of-the-document-7>the indicated part of the
   document</a> is the top of the document; return.<li><p>If <a href=#find-a-potential-indicated-element id=scroll-to-fragid:find-a-potential-indicated-element>find a potential indicated element</a> with <var>fragment</var> returns
   non-null, then the return value is <a href=#the-indicated-part-of-the-document id=scroll-to-fragid:the-indicated-part-of-the-document-8>the indicated part of the document</a>;
   return.<li><p>Let <var>fragmentBytes</var> be the result of <a href=https://url.spec.whatwg.org/#string-percent-decode id=scroll-to-fragid:percent-decode data-x-internal=percent-decode>percent-decoding</a> <var>fragment</var>.<li><p>Let <var>decodedFragment</var> be the result of running <a id=scroll-to-fragid:utf-8-decode-without-bom href=https://encoding.spec.whatwg.org/#utf-8-decode-without-bom data-x-internal=utf-8-decode-without-bom>UTF-8 decode without
   BOM</a> on <var>fragmentBytes</var>.<li><p>If <a href=#find-a-potential-indicated-element id=scroll-to-fragid:find-a-potential-indicated-element-2>find a potential indicated element</a> with <var>decodedFragment</var> returns
   non-null, then the return value is <a href=#the-indicated-part-of-the-document id=scroll-to-fragid:the-indicated-part-of-the-document-9>the indicated part of the document</a>;
   return.<li><p>If <var>decodedFragment</var> is an <a id=scroll-to-fragid:ascii-case-insensitive href=https://infra.spec.whatwg.org/#ascii-case-insensitive data-x-internal=ascii-case-insensitive>ASCII case-insensitive</a> match for the
   string <code>top</code>, then <a href=#the-indicated-part-of-the-document id=scroll-to-fragid:the-indicated-part-of-the-document-10>the indicated part of the document</a> is the
   top of the document; return.<li><p>There is no <a href=#the-indicated-part-of-the-document id=scroll-to-fragid:the-indicated-part-of-the-document-11>indicated part of the
   document</a>.</ol>

  <p>To <dfn id=find-a-potential-indicated-element>find a potential indicated element</dfn> given a string <var>fragment</var>, run these
  steps:</p>

  <ol><li><p>If there is an element <a href=https://dom.spec.whatwg.org/#in-a-document-tree id=scroll-to-fragid:in-a-document-tree data-x-internal=in-a-document-tree>in the document tree</a> that
   has an <a href=https://dom.spec.whatwg.org/#concept-id id=scroll-to-fragid:concept-id-2 data-x-internal=concept-id>ID</a> equal to <var>fragment</var>, then return the first
   such element in <a id=scroll-to-fragid:tree-order href=https://dom.spec.whatwg.org/#concept-tree-order data-x-internal=tree-order>tree order</a>.<li><p>If there is an <code id=scroll-to-fragid:the-a-element><a href=text-level-semantics.html#the-a-element>a</a></code> element <a href=https://dom.spec.whatwg.org/#in-a-document-tree id=scroll-to-fragid:in-a-document-tree-2 data-x-internal=in-a-document-tree>in the document
   tree</a> that has a <code id=scroll-to-fragid:attr-a-name><a href=obsolete.html#attr-a-name>name</a></code> attribute whose value is equal to
   <var>fragment</var>, then return the first such element in <a id=scroll-to-fragid:tree-order-2 href=https://dom.spec.whatwg.org/#concept-tree-order data-x-internal=tree-order>tree order</a>.<li><p>Return null.</ol>

  




  <h4 id=history-traversal><span class=secno>7.10.10</span> History traversal<a href=#history-traversal class=self-link></a></h4>
<div data-zh-date="" data-en-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" class=translate-info data-zh-file="https://github.com/whatwg-cn/html/new/master/src/loading-web-pages/browsing-the-web/history-traversal/index.zh.html?filename=index.zh.html&amp;value=%E4%BB%8E%20https%3A%2F%2Fgithub.com%2Fwhatwg-cn%2Fhtml%2Fblob%2Fmaster%2Fsrc%2Floading-web-pages%2Fbrowsing-the-web%2Fhistory-traversal%2Findex.en.html%20%E6%8B%B7%E8%B4%9D%E8%8B%B1%E6%96%87%E6%BA%90%E7%A0%81%E8%87%B3%E6%AD%A4%EF%BC%8C%E5%BC%80%E5%A7%8B%E7%BF%BB%E8%AF%91" data-en-file=https://github.com/whatwg-cn/html/blob/master/src/loading-web-pages/browsing-the-web/history-traversal/index.en.html></div> 

  

  <p>To <dfn id=traverse-the-history>traverse the history</dfn> to a <a id=history-traversal:session-history-entry href=history.html#session-history-entry>session history entry</a> <var>entry</var>,
  with an optional <a href=#history-handling-behavior id=history-traversal:history-handling-behavior>history handling behavior</a> <dfn id=traverse-history-hh><var>historyHandling</var></dfn> (default "<code id=history-traversal:hh-default><a href=#hh-default>default</a></code>"), an optional boolean <dfn id=nonblockingevents><var>nonBlockingEvents</var></dfn>
  (default false), and an optional boolean <dfn id=explicithistorynavigation><var>explicitHistoryNavigation</var></dfn> (default
  false):</p>

  <p class=note>This algorithm is not just invoked when <a href=history.html#traverse-the-history-by-a-delta id=history-traversal:traverse-the-history-by-a-delta>explicitly going back or forwards in the session history</a> — it is also invoked
  in other situations, for example when <a href=#navigate id=history-traversal:navigate>navigating a browsing context</a>,
  as part of <a href=#update-the-session-history-with-the-new-page id=history-traversal:update-the-session-history-with-the-new-page>updating the session history
  with the new page</a>.</p>

  <ol><li>
    <p>If <var>entry</var>'s <a href=history.html#she-document id=history-traversal:she-document>document</a> is null, then:</p>

    <ol><li><p>Let <var>request</var> be a new <a href=https://fetch.spec.whatwg.org/#concept-request id=history-traversal:concept-request data-x-internal=concept-request>request</a> whose
     <a href=https://fetch.spec.whatwg.org/#concept-request-url id=history-traversal:concept-request-url data-x-internal=concept-request-url>url</a> is <var>entry</var>'s <a href=history.html#she-url id=history-traversal:she-url>URL</a>.<li><p>If <var>explicitHistoryNavigation</var> is true, then set <var>request</var>'s <a href=https://fetch.spec.whatwg.org/#concept-request-history-navigation-flag id=history-traversal:concept-request-history-navigation-flag data-x-internal=concept-request-history-navigation-flag>history-navigation flag</a>.<li><p>Assert: <var>historyHandling</var> is not "<code id=history-traversal:hh-replace><a href=#hh-replace>replace</a></code>".<li>
      <p><a href=#navigate id=history-traversal:navigate-2>Navigate</a> the <a id=history-traversal:browsing-context href=browsers.html#browsing-context>browsing
      context</a> to <var>request</var> with <var id=history-traversal:navigation-hh><a href=#navigation-hh>historyHandling</a></var>
      set to "<code id=history-traversal:hh-entry-update><a href=#hh-entry-update>entry update</a></code>". The navigation must be done using
      the same <a href=#source-browsing-context id=history-traversal:source-browsing-context>source browsing context</a> as was used the first time <var>entry</var> was
      created.</p>

      <p class=note>The "<a href=#navigate id=history-traversal:navigate-3>navigate</a>" algorithm reinvokes this "traverse" algorithm to
      complete the traversal, at which point <var>entry</var>'s <a href=history.html#she-document id=history-traversal:she-document-2>document</a> is non-null.</p>

      <p class=note>If the resource was obtained using a non-idempotent action, for example a POST
      form submission, or if the resource is no longer available, for example because the computer
      is now offline and the page wasn't cached, navigating to it again might not be possible. In
      this case, the navigation will result in a different page than previously; for example, it
      might be an error message explaining the problem or offering to resubmit the form.</p>
     <li><p>Return.</ol>
   <li><p>If the <a id=history-traversal:current-entry href=history.html#current-entry>current entry</a>'s <a href=history.html#she-title id=history-traversal:she-title>title</a> is null, then
   set its <a href=history.html#she-title id=history-traversal:she-title-2>title</a> to the value returned by the <code id=history-traversal:document.title><a href=dom.html#document.title>document.title</a></code> IDL attribute.<li><p><a href=#save-persisted-state id=history-traversal:save-persisted-state>Save persisted state</a> to the <a id=history-traversal:current-entry-2 href=history.html#current-entry>current entry</a>.<li><p>Let <var>newDocument</var> be <var>entry</var>'s <a href=history.html#she-document id=history-traversal:she-document-3>document</a>.<li><p>If <var>newDocument</var> is different than the <a id=history-traversal:current-entry-3 href=history.html#current-entry>current entry</a>'s <a href=history.html#she-document id=history-traversal:she-document-4>document</a>, then:</p>

    <ol><li><p>Remove any <a href=webappapis.html#concept-task id=history-traversal:concept-task>tasks</a> queued by the <a id=history-traversal:history-traversal-task-source href=webappapis.html#history-traversal-task-source>history traversal
     task source</a> that are associated with any <code id=history-traversal:document><a href=dom.html#document>Document</a></code> objects in the
     <a id=history-traversal:top-level-browsing-context href=browsers.html#top-level-browsing-context>top-level browsing context</a>'s <a id=history-traversal:document-family href=browsers.html#document-family>document family</a>.<li>
      <p>If <var>newDocument</var>'s <a id=history-traversal:concept-origin href=origin.html#concept-origin>origin</a> is not <a id=history-traversal:same-origin href=origin.html#same-origin>same origin</a> with the
      <a id=history-traversal:current-entry-4 href=history.html#current-entry>current entry</a>'s <a href=history.html#she-document id=history-traversal:she-document-5>document</a>'s
      <a id=history-traversal:concept-origin-2 href=origin.html#concept-origin>origin</a>, then:</p>

      <ol><li><p>Let <var>entriesToUpdate</var> be all <a href=history.html#session-history-entry id=history-traversal:session-history-entry-2>entries</a> in the <a id=history-traversal:session-history href=history.html#session-history>session history</a> whose <a href=history.html#she-document id=history-traversal:she-document-6>document</a>'s <a id=history-traversal:concept-origin-3 href=origin.html#concept-origin>origin</a> is <a id=history-traversal:same-origin-2 href=origin.html#same-origin>same origin</a> as
       the <a id=history-traversal:active-document href=browsers.html#active-document>active document</a> <em>and</em> that are contiguous with the <a id=history-traversal:current-entry-5 href=history.html#current-entry>current
       entry</a>.<li><p><a href=https://infra.spec.whatwg.org/#list-iterate id=history-traversal:list-iterate data-x-internal=list-iterate>For each</a> <var>entryToUpdate</var> of
       <var>entriesToUpdate</var>, set <var>entryToUpdate</var>'s <a href=history.html#she-bc-name id=history-traversal:she-bc-name>browsing context name</a> to the current <a id=history-traversal:browsing-context-name href=browsers.html#browsing-context-name>browsing context
       name</a>.<li id=resetBCName><p>If the browsing context is a <a id=history-traversal:top-level-browsing-context-2 href=browsers.html#top-level-browsing-context>top-level browsing context</a>,
       but not an <a id=history-traversal:auxiliary-browsing-context href=browsers.html#auxiliary-browsing-context>auxiliary browsing context</a>, then set the browsing context's <a href=browsers.html#browsing-context-name id=history-traversal:browsing-context-name-2>name</a> to the empty string.</ol>
     <li id=appcache-history-2><p><a id=history-traversal:set-the-active-document href=browsers.html#set-the-active-document>Set the active document</a> of the <a id=history-traversal:browsing-context-2 href=browsers.html#browsing-context>browsing
     context</a> to <var>newDocument</var>.<li>
      <p>If <var>entry</var>'s <a href=history.html#she-bc-name id=history-traversal:she-bc-name-2>browsing context name</a> is not null,
      then:</p>

      <ol><li><p>Set the browsing context's <a href=browsers.html#browsing-context-name id=history-traversal:browsing-context-name-3>name</a> to
       <var>entry</var>'s <a href=history.html#she-bc-name id=history-traversal:she-bc-name-3>browsing context name</a>.<li><p>Let <var>entriesToUpdate</var> be all <a href=history.html#session-history-entry id=history-traversal:session-history-entry-3>entries</a> in the <a id=history-traversal:session-history-2 href=history.html#session-history>session history</a> whose <a href=history.html#she-document id=history-traversal:she-document-7>document</a>'s <a id=history-traversal:concept-origin-4 href=origin.html#concept-origin>origin</a> is <a id=history-traversal:same-origin-3 href=origin.html#same-origin>same origin</a> as
       the new <a id=history-traversal:active-document-2 href=browsers.html#active-document>active document</a> and that are contiguous with <var>entry</var>.<li><p><a href=https://infra.spec.whatwg.org/#list-iterate id=history-traversal:list-iterate-2 data-x-internal=list-iterate>For each</a> <var>entryToUpdate</var> of
       <var>entriesToUpdate</var>, set <var>entryToUpdate</var>'s <a href=history.html#she-bc-name id=history-traversal:she-bc-name-4>browsing context name</a> to null.</ol>
     <li id=history-autocomplete><p>If <var>newDocument</var> has any form controls whose
     <a id=history-traversal:autofill-field-name href=form-control-infrastructure.html#autofill-field-name>autofill field name</a> is "<code id=history-traversal:attr-fe-autocomplete-off><a href=form-control-infrastructure.html#attr-fe-autocomplete-off>off</a></code>",
     invoke the <a href=form-control-infrastructure.html#concept-form-reset-control id=history-traversal:concept-form-reset-control>reset algorithm</a> of each of those
     elements.<li>
      <p>If <var>newDocument</var>'s <a id=history-traversal:current-document-readiness href=dom.html#current-document-readiness>current document readiness</a> "<code>complete</code>", then <a id=history-traversal:queue-a-global-task href=webappapis.html#queue-a-global-task>queue a global task</a> on the <a id=history-traversal:dom-manipulation-task-source href=webappapis.html#dom-manipulation-task-source>DOM
      manipulation task source</a> given <var>newDocument</var>'s <a id=history-traversal:concept-relevant-global href=webappapis.html#concept-relevant-global>relevant global
      object</a> to run the following steps:</p>

      <ol><li><p>If <var>newDocument</var>'s <a href=#page-showing id=history-traversal:page-showing>page showing</a> flag is true, then abort these
       steps.<li><p>Set <var>newDocument</var>'s <a href=#page-showing id=history-traversal:page-showing-2>page showing</a> flag to true.<li>
        <p>Run any <dfn id=session-history-document-visibility-change-steps>session history document visibility change steps</dfn> for
        <var>newDocument</var> that are defined by <a id=history-traversal:other-applicable-specifications href=infrastructure.html#other-applicable-specifications>other applicable specifications</a>.</p>

        <p class=note>This is specifically intended for use by <cite>Page Visibility</cite>. <a href=references.html#refsPAGEVIS>[PAGEVIS]</a></p>
       <li><p><a href=https://dom.spec.whatwg.org/#concept-event-fire id=history-traversal:concept-event-fire data-x-internal=concept-event-fire>Fire an event</a> named <code id=history-traversal:event-pageshow><a href=indices.html#event-pageshow>pageshow</a></code> at <var>newDocument</var>'s <a id=history-traversal:concept-relevant-global-2 href=webappapis.html#concept-relevant-global>relevant global
       object</a>, using <code id=history-traversal:pagetransitionevent><a href=#pagetransitionevent>PageTransitionEvent</a></code>, with the <code id=history-traversal:dom-pagetransitionevent-persisted><a href=#dom-pagetransitionevent-persisted>persisted</a></code> attribute initialized to true,
       and <var>legacy target override flag</var> set.</ol>

      
     </ol>
   <li><p>Set <var>newDocument</var>'s <a href=https://dom.spec.whatwg.org/#concept-document-url id=history-traversal:the-document的-address data-x-internal=the-document的-address>URL</a> to
   <var>entry</var>'s <a href=history.html#she-url id=history-traversal:she-url-2>URL</a>.<li><p>Let <var>hashChanged</var> be false, and let <var>oldURL</var> and <var>newURL</var> be
   null.<li><p>If <var>entry</var>'s <a href=history.html#she-url id=history-traversal:she-url-3>URL</a>'s <a href=https://url.spec.whatwg.org/#concept-url-fragment id=history-traversal:concept-url-fragment data-x-internal=concept-url-fragment>fragment</a> is not <a id=history-traversal:identical-to href=https://infra.spec.whatwg.org/#string-is data-x-internal=identical-to>identical to</a> the <a id=history-traversal:current-entry-6 href=history.html#current-entry>current
   entry</a>'s <a href=history.html#she-url id=history-traversal:she-url-4>URL</a>'s <a href=https://url.spec.whatwg.org/#concept-url-fragment id=history-traversal:concept-url-fragment-2 data-x-internal=concept-url-fragment>fragment</a>, and <var>entry</var>'s <a href=history.html#she-document id=history-traversal:she-document-8>document</a> equals the <a id=history-traversal:current-entry-7 href=history.html#current-entry>current entry</a>'s <a href=history.html#she-document id=history-traversal:she-document-9>document</a>, then set <var>hashChanged</var> to true, set
   <var>oldURL</var> to the <a id=history-traversal:current-entry-8 href=history.html#current-entry>current entry</a>'s <a href=history.html#she-url id=history-traversal:she-url-5>URL</a>, and set
   <var>newURL</var> to <var>entry</var>'s <a href=history.html#she-url id=history-traversal:she-url-6>URL</a>.<li><p>If <var>historyHandling</var> is "<code id=history-traversal:hh-replace-2><a href=#hh-replace>replace</a></code>", then remove
   the entry immediately before <var>entry</var> in the <a id=history-traversal:session-history-3 href=history.html#session-history>session history</a>.<li><p>If <var>entry</var>'s <a href=history.html#she-other id=history-traversal:she-other>persisted user state</a> is null, and
   its <a href=history.html#she-url id=history-traversal:she-url-7>URL</a>'s <a href=https://url.spec.whatwg.org/#concept-url-fragment id=history-traversal:concept-url-fragment-3 data-x-internal=concept-url-fragment>fragment</a> is
   non-null, then <a href=#scroll-to-the-fragment-identifier id=history-traversal:scroll-to-the-fragment-identifier>scroll to the fragment</a>.<li><p>Set the <a id=history-traversal:current-entry-9 href=history.html#current-entry>current entry</a> to <var>entry</var>.<li><p>Let <var>targetRealm</var> be the <a id=history-traversal:current-realm-record href=https://tc39.es/ecma262/#current-realm data-x-internal=current-realm-record>current Realm Record</a>.<li><p>Let <var>state</var> be null.<li><p>If <var>entry</var>'s <a href=history.html#she-serialized-state id=history-traversal:she-serialized-state>serialized state</a> is not
   null, then set <var>state</var> to <a id=history-traversal:structureddeserialize href=infrastructure.html#structureddeserialize>StructuredDeserialize</a>(<var>entry</var>'s <a href=history.html#she-serialized-state id=history-traversal:she-serialized-state-2>serialized state</a>, <var>targetRealm</var>). If this throws an
   exception, catch it and ignore the exception.<li><p>Set <var>newDocument</var>'s <code id=history-traversal:history-2><a href=history.html#history-2>History</a></code> object's <a href=history.html#concept-history-state id=history-traversal:concept-history-state>state</a> to <var>state</var>.<li><p>Let <var>stateChanged</var> be true if <var>newDocument</var> has a <a id=history-traversal:latest-entry href=history.html#latest-entry>latest
   entry</a>, and that entry is not <var>entry</var>; otherwise let it be false.</p>

   <li><p>Set <var>newDocument</var>'s <a id=history-traversal:latest-entry-2 href=history.html#latest-entry>latest entry</a> to <var>entry</var>.<li>
    <p>If <var>nonBlockingEvents</var> is false, then run the following steps
    <a id=history-traversal:immediately href=infrastructure.html#immediately>immediately</a>. Otherwise, <a id=history-traversal:queue-a-global-task-2 href=webappapis.html#queue-a-global-task>queue a global task</a> on the <a id=history-traversal:dom-manipulation-task-source-2 href=webappapis.html#dom-manipulation-task-source>DOM
    manipulation task source</a> given <var>newDocument</var>'s <a id=history-traversal:concept-relevant-global-3 href=webappapis.html#concept-relevant-global>relevant global
    object</a> to run the following steps instead.</p>

    <ol><li><p>If <var>stateChanged</var> is true, then <a href=https://dom.spec.whatwg.org/#concept-event-fire id=history-traversal:concept-event-fire-2 data-x-internal=concept-event-fire>fire an
     event</a> named <code id=history-traversal:event-popstate><a href=indices.html#event-popstate>popstate</a></code> at <var>newDocument</var>'s
     <a id=history-traversal:concept-relevant-global-4 href=webappapis.html#concept-relevant-global>relevant global object</a>, using <code id=history-traversal:popstateevent><a href=#popstateevent>PopStateEvent</a></code>, with the <code id=history-traversal:dom-popstateevent-state><a href=#dom-popstateevent-state>state</a></code> attribute initialized to <var>state</var>.<li><p><a href=#restore-persisted-state id=history-traversal:restore-persisted-state>Restore persisted state</a> from <var>entry</var>.<li><p>If <var>hashChanged</var> is true, then <a href=https://dom.spec.whatwg.org/#concept-event-fire id=history-traversal:concept-event-fire-3 data-x-internal=concept-event-fire>fire an
     event</a> named <code id=history-traversal:event-hashchange><a href=indices.html#event-hashchange>hashchange</a></code> at the <a id=history-traversal:browsing-context-3 href=browsers.html#browsing-context>browsing
     context</a>'s <a id=history-traversal:active-window href=browsers.html#active-window>active window</a>, using <code id=history-traversal:hashchangeevent><a href=#hashchangeevent>HashChangeEvent</a></code>, with the <code id=history-traversal:dom-hashchangeevent-oldurl><a href=#dom-hashchangeevent-oldurl>oldURL</a></code> attribute initialized to <var>oldURL</var>
     and the <code id=history-traversal:dom-hashchangeevent-newurl><a href=#dom-hashchangeevent-newurl>newURL</a></code> attribute initialized to
     <var>newURL</var>.</ol>
   </ol>



  <h5 id=persisted-user-state-restoration><span class=secno>7.10.10.1</span> Persisted history entry state<a href=#persisted-user-state-restoration class=self-link></a></h5>
<div data-zh-date="" data-en-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" class=translate-info data-zh-file="https://github.com/whatwg-cn/html/new/master/src/loading-web-pages/browsing-the-web/history-traversal/persisted-history-entry-state.zh.html?filename=persisted-history-entry-state.zh.html&amp;value=%E4%BB%8E%20https%3A%2F%2Fgithub.com%2Fwhatwg-cn%2Fhtml%2Fblob%2Fmaster%2Fsrc%2Floading-web-pages%2Fbrowsing-the-web%2Fhistory-traversal%2Fpersisted-history-entry-state.en.html%20%E6%8B%B7%E8%B4%9D%E8%8B%B1%E6%96%87%E6%BA%90%E7%A0%81%E8%87%B3%E6%AD%A4%EF%BC%8C%E5%BC%80%E5%A7%8B%E7%BF%BB%E8%AF%91" data-en-file=https://github.com/whatwg-cn/html/blob/master/src/loading-web-pages/browsing-the-web/history-traversal/persisted-history-entry-state.en.html></div>

  <p>To <dfn id=save-persisted-state>save persisted state</dfn> to a <a id=persisted-user-state-restoration:session-history-entry href=history.html#session-history-entry>session history entry</a>
  <var>entry</var>:</p>

  <ol><li><p>Set the <a href=history.html#she-scroll-position id=persisted-user-state-restoration:she-scroll-position>scroll position data</a> of <var>entry</var>
   to contain the scroll positions for all of <var>entry</var>'s <a href=history.html#she-document id=persisted-user-state-restoration:she-document>document</a>'s <a href=#restorable-scrollable-regions id=persisted-user-state-restoration:restorable-scrollable-regions>restorable scrollable regions</a>.<li><p>Optionally, update <var>entry</var>'s <a href=history.html#she-other id=persisted-user-state-restoration:she-other>persisted user state</a>
   to reflect any state that the user agent wishes to persist, such as the values of form
   fields.</ol>

  <p id=restore-persisted-user-state>To <dfn id=restore-persisted-state>restore persisted state</dfn> from a <a id=persisted-user-state-restoration:session-history-entry-2 href=history.html#session-history-entry>session
  history entry</a> <var>entry</var>:</p>

  <ol><li>
    <p>If <var>entry</var>'s <a href=history.html#she-scroll-restoration-mode id=persisted-user-state-restoration:she-scroll-restoration-mode>scroll restoration
    mode</a> is "<code id=persisted-user-state-restoration:dom-scrollrestoration-auto><a href=history.html#dom-scrollrestoration-auto>auto</a></code>", then the user agent may
    use <var>entry</var>'s <a href=history.html#she-scroll-position id=persisted-user-state-restoration:she-scroll-position-2>scroll position data</a> to restore
    the scroll positions of <var>entry</var>'s <a href=history.html#she-document id=persisted-user-state-restoration:she-document-2>document</a>'s
    <a href=#restorable-scrollable-regions id=persisted-user-state-restoration:restorable-scrollable-regions-2>restorable scrollable regions</a>.</p>

    <p class=note>The user agent not restoring scroll positions does not imply that scroll
    positions will be left at any particular value (e.g., (0,0)). The actual scroll position depends
    on the navigation type and the user agent's particular caching strategy. So web applications
    cannot assume any particular scroll position but rather are urged to set it to what they want it
    to be.</p>
   <li>
    <p>Optionally, update other aspects of <var>entry</var>'s <a href=history.html#she-document id=persisted-user-state-restoration:she-document-3>document</a> and its rendering, for instance values of form fields,
    that the user agent had previously recorded in <var>entry</var>'s <a href=history.html#she-other id=persisted-user-state-restoration:she-other-2>persisted user state</a>.</p>

    <p class=note>This can even include updating the <code id=persisted-user-state-restoration:dir-属性><a href=dom.html#dir-属性>dir</a></code> attribute
    of <code id=persisted-user-state-restoration:the-textarea-element><a href=form-elements.html#the-textarea-element>textarea</a></code> elements or <code id=persisted-user-state-restoration:the-input-element><a href=input.html#the-input-element>input</a></code> elements whose <code id=persisted-user-state-restoration:attr-input-type><a href=input.html#attr-input-type>type</a></code> attribute is in either the <a href="input.html#text-(type=text)-state-and-search-state-(type=search)" id="persisted-user-state-restoration:text-(type=text)-state-and-search-state-(type=search)">Text</a> state or the <a href="input.html#text-(type=text)-state-and-search-state-(type=search)" id="persisted-user-state-restoration:text-(type=text)-state-and-search-state-(type=search)-2">Search</a> state, if the persisted state includes the
    directionality of user input in such controls.</p>
   </ol>

  <hr>

  <p>The <dfn id=restorable-scrollable-regions>restorable scrollable regions</dfn> of a <code id=persisted-user-state-restoration:document><a href=dom.html#document>Document</a></code> <var>document</var> are
  <var>document</var>'s <a id=persisted-user-state-restoration:viewport href=https://drafts.csswg.org/css2/#viewport data-x-internal=viewport>viewport</a>, and all of <var>document</var>'s scrollable regions
  excepting any <a href=browsers.html#child-browsing-context id=persisted-user-state-restoration:child-browsing-context>child browsing contexts</a> of
  <var>document</var>.</p>

  <p class=note><a id=persisted-user-state-restoration:child-browsing-context-2 href=browsers.html#child-browsing-context>Child browsing context</a> scroll restoration is handled by the history
  entry for those browsing contexts' <code id=persisted-user-state-restoration:document-2><a href=dom.html#document>Document</a></code>s.</p>

  



  <h5 id=the-popstateevent-interface><span class=secno>7.10.10.2</span> The <code id=the-popstateevent-interface:popstateevent><a href=#popstateevent>PopStateEvent</a></code> interface<a href=#the-popstateevent-interface class=self-link></a></h5><div class="mdn-anno wrapped"><button onclick=toggleStatus(this) class=mdn-anno-btn><b title="Support in all current engines." class=all-engines-flag>✔</b><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/PopStateEvent title="PopStateEvent is an interface for the popstate event.">PopStateEvent</a><p class=all-engines-text>Support in all current engines.<div class=support><span class="firefox yes"><span>Firefox</span><span>4+</span></span><span class="safari yes"><span>Safari</span><span>6+</span></span><span class="chrome yes"><span>Chrome</span><span>4+</span></span><hr><span class="opera yes"><span>Opera</span><span>12.1+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>6+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>4.4+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>12.1+</span></span></div></div></div>
<div data-zh-date="" data-en-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" class=translate-info data-zh-file="https://github.com/whatwg-cn/html/new/master/src/loading-web-pages/browsing-the-web/history-traversal/the-popstateevent-interface.zh.html?filename=the-popstateevent-interface.zh.html&amp;value=%E4%BB%8E%20https%3A%2F%2Fgithub.com%2Fwhatwg-cn%2Fhtml%2Fblob%2Fmaster%2Fsrc%2Floading-web-pages%2Fbrowsing-the-web%2Fhistory-traversal%2Fthe-popstateevent-interface.en.html%20%E6%8B%B7%E8%B4%9D%E8%8B%B1%E6%96%87%E6%BA%90%E7%A0%81%E8%87%B3%E6%AD%A4%EF%BC%8C%E5%BC%80%E5%A7%8B%E7%BF%BB%E8%AF%91" data-en-file=https://github.com/whatwg-cn/html/blob/master/src/loading-web-pages/browsing-the-web/history-traversal/the-popstateevent-interface.en.html></div>

  <pre><code class=idl>[Exposed=Window]
interface <dfn id=popstateevent>PopStateEvent</dfn> : <a id=the-popstateevent-interface:event href=https://dom.spec.whatwg.org/#interface-event data-x-internal=event>Event</a> {
  constructor(DOMString type, optional <a href=#popstateeventinit id=the-popstateevent-interface:popstateeventinit>PopStateEventInit</a> eventInitDict = {});

  readonly attribute any <a href=#dom-popstateevent-state id=the-popstateevent-interface:dom-popstateevent-state>state</a>;
};

dictionary <dfn id=popstateeventinit>PopStateEventInit</dfn> : <a id=the-popstateevent-interface:eventinit href=https://dom.spec.whatwg.org/#dictdef-eventinit data-x-internal=eventinit>EventInit</a> {
  any state = null;
};</code></pre>

  <dl class=domintro><dt><var>event</var> . <code id=dom-popstateevent-state-dev><a href=#dom-popstateevent-state>state</a></code><dd>
    <p>Returns a copy of the information that was provided to <code id=the-popstateevent-interface:dom-history-pushstate><a href=history.html#dom-history-pushstate>pushState()</a></code> or <code id=the-popstateevent-interface:dom-history-replacestate><a href=history.html#dom-history-replacestate>replaceState()</a></code>.</p>
   </dl>

  

  <p>The <dfn id=dom-popstateevent-state><code>state</code></dfn> attribute must return the
  value it was initialized to. It represents the context information for the event, or null, if the
  state represented is the initial state of the <code id=the-popstateevent-interface:document><a href=dom.html#document>Document</a></code>.</p>

  



  <h5 id=the-hashchangeevent-interface><span class=secno>7.10.10.3</span> The <code id=the-hashchangeevent-interface:hashchangeevent><a href=#hashchangeevent>HashChangeEvent</a></code> interface<a href=#the-hashchangeevent-interface class=self-link></a></h5><div class="mdn-anno wrapped"><button onclick=toggleStatus(this) class=mdn-anno-btn><b title="Support in all current engines." class=all-engines-flag>✔</b><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/HashChangeEvent title="The HashChangeEvent interface represents events that fire when the fragment identifier of the URL has changed.">HashChangeEvent</a><p class=all-engines-text>Support in all current engines.<div class=support><span class="firefox yes"><span>Firefox</span><span>3.6+</span></span><span class="safari yes"><span>Safari</span><span>5+</span></span><span class="chrome yes"><span>Chrome</span><span>8+</span></span><hr><span class="opera yes"><span>Opera</span><span>10.6+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>8+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>5+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>4.4+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>11+</span></span></div></div></div>
<div data-zh-date="" data-en-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" class=translate-info data-zh-file="https://github.com/whatwg-cn/html/new/master/src/loading-web-pages/browsing-the-web/history-traversal/the-hashchangeevent-interface.zh.html?filename=the-hashchangeevent-interface.zh.html&amp;value=%E4%BB%8E%20https%3A%2F%2Fgithub.com%2Fwhatwg-cn%2Fhtml%2Fblob%2Fmaster%2Fsrc%2Floading-web-pages%2Fbrowsing-the-web%2Fhistory-traversal%2Fthe-hashchangeevent-interface.en.html%20%E6%8B%B7%E8%B4%9D%E8%8B%B1%E6%96%87%E6%BA%90%E7%A0%81%E8%87%B3%E6%AD%A4%EF%BC%8C%E5%BC%80%E5%A7%8B%E7%BF%BB%E8%AF%91" data-en-file=https://github.com/whatwg-cn/html/blob/master/src/loading-web-pages/browsing-the-web/history-traversal/the-hashchangeevent-interface.en.html></div>

  <pre><code class=idl>[Exposed=Window]
interface <dfn id=hashchangeevent>HashChangeEvent</dfn> : <a id=the-hashchangeevent-interface:event href=https://dom.spec.whatwg.org/#interface-event data-x-internal=event>Event</a> {
  constructor(DOMString type, optional <a href=#hashchangeeventinit id=the-hashchangeevent-interface:hashchangeeventinit>HashChangeEventInit</a> eventInitDict = {});

  readonly attribute USVString <a href=#dom-hashchangeevent-oldurl id=the-hashchangeevent-interface:dom-hashchangeevent-oldurl>oldURL</a>;
  readonly attribute USVString <a href=#dom-hashchangeevent-newurl id=the-hashchangeevent-interface:dom-hashchangeevent-newurl>newURL</a>;
};

dictionary <dfn id=hashchangeeventinit>HashChangeEventInit</dfn> : <a id=the-hashchangeevent-interface:eventinit href=https://dom.spec.whatwg.org/#dictdef-eventinit data-x-internal=eventinit>EventInit</a> {
  USVString oldURL = "";
  USVString newURL = "";
};</code></pre>

  <dl class=domintro><dt><var>event</var> . <code id=dom-hashchangeevent-oldurl-dev><a href=#dom-hashchangeevent-oldurl>oldURL</a></code><div class="mdn-anno wrapped before"><button onclick=toggleStatus(this) class=mdn-anno-btn><b title="Support in all current engines." class=all-engines-flag>✔</b><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/HashChangeEvent/oldURL title="The oldURL read-only property of the HashChangeEvent interface returns the previous URL from which the window was navigated.">HashChangeEvent/oldURL</a><p class=all-engines-text>Support in all current engines.<div class=support><span class="firefox yes"><span>Firefox</span><span>6+</span></span><span class="safari yes"><span>Safari</span><span>5.1+</span></span><span class="chrome yes"><span>Chrome</span><span>8+</span></span><hr><span class="opera yes"><span>Opera</span><span>12.1+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>6+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>6+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>4.4+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>12.1+</span></span></div></div></div><dd>
    <p>Returns the <a id=the-hashchangeevent-interface:url href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> of the <a id=the-hashchangeevent-interface:session-history-entry href=history.html#session-history-entry>session history entry</a> that was previously
    current.</p>
   <dt><var>event</var> . <code id=dom-hashchangeevent-newurl-dev><a href=#dom-hashchangeevent-newurl>newURL</a></code><div class="mdn-anno wrapped before"><button onclick=toggleStatus(this) class=mdn-anno-btn><b title="Support in all current engines." class=all-engines-flag>✔</b><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/HashChangeEvent/newURL title="The newURL read-only property of the HashChangeEvent interface returns the new URL to which the window is navigating.">HashChangeEvent/newURL</a><p class=all-engines-text>Support in all current engines.<div class=support><span class="firefox yes"><span>Firefox</span><span>6+</span></span><span class="safari yes"><span>Safari</span><span>5.1+</span></span><span class="chrome yes"><span>Chrome</span><span>8+</span></span><hr><span class="opera yes"><span>Opera</span><span>12.1+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>6+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>6+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>4.4+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>12.1+</span></span></div></div></div><dd>
    <p>Returns the <a id=the-hashchangeevent-interface:url-2 href=https://url.spec.whatwg.org/#concept-url data-x-internal=url>URL</a> of the <a id=the-hashchangeevent-interface:session-history-entry-2 href=history.html#session-history-entry>session history entry</a> that is now
    current.</p>
   </dl>

  

  <p>The <dfn id=dom-hashchangeevent-oldurl><code>oldURL</code></dfn> attribute must return
  the value it was initialized to. It represents context information for the event, specifically the
  URL of the <a id=the-hashchangeevent-interface:session-history-entry-3 href=history.html#session-history-entry>session history entry</a> that was traversed from.</p>

  <p>The <dfn id=dom-hashchangeevent-newurl><code>newURL</code></dfn> attribute must return
  the value it was initialized to. It represents context information for the event, specifically the
  URL of the <a id=the-hashchangeevent-interface:session-history-entry-4 href=history.html#session-history-entry>session history entry</a> that was traversed to.</p>

  



  <h5 id=the-pagetransitionevent-interface><span class=secno>7.10.10.4</span> The <code id=the-pagetransitionevent-interface:pagetransitionevent><a href=#pagetransitionevent>PageTransitionEvent</a></code> interface<a href=#the-pagetransitionevent-interface class=self-link></a></h5><div class="mdn-anno wrapped"><button onclick=toggleStatus(this) class=mdn-anno-btn><b title="Support in all current engines." class=all-engines-flag>✔</b><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/PageTransitionEvent title="The PageTransitionEvent event object is available inside handler functions for the pageshow and pagehide events, fired when a document is being loaded or unloaded.">PageTransitionEvent</a><p class=all-engines-text>Support in all current engines.<div class=support><span class="firefox yes"><span>Firefox</span><span>1.5+</span></span><span class="safari yes"><span>Safari</span><span>5+</span></span><span class="chrome yes"><span>Chrome</span><span>4+</span></span><hr><span class="opera yes"><span>Opera</span><span>15+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>11</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>4+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>37+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>14+</span></span></div></div></div>
<div data-zh-date="" data-en-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" class=translate-info data-zh-file="https://github.com/whatwg-cn/html/new/master/src/loading-web-pages/browsing-the-web/history-traversal/the-pagetransitionevent-interface.zh.html?filename=the-pagetransitionevent-interface.zh.html&amp;value=%E4%BB%8E%20https%3A%2F%2Fgithub.com%2Fwhatwg-cn%2Fhtml%2Fblob%2Fmaster%2Fsrc%2Floading-web-pages%2Fbrowsing-the-web%2Fhistory-traversal%2Fthe-pagetransitionevent-interface.en.html%20%E6%8B%B7%E8%B4%9D%E8%8B%B1%E6%96%87%E6%BA%90%E7%A0%81%E8%87%B3%E6%AD%A4%EF%BC%8C%E5%BC%80%E5%A7%8B%E7%BF%BB%E8%AF%91" data-en-file=https://github.com/whatwg-cn/html/blob/master/src/loading-web-pages/browsing-the-web/history-traversal/the-pagetransitionevent-interface.en.html></div>

  <pre><code class=idl>[Exposed=Window]
interface <dfn id=pagetransitionevent>PageTransitionEvent</dfn> : <a id=the-pagetransitionevent-interface:event href=https://dom.spec.whatwg.org/#interface-event data-x-internal=event>Event</a> {
  constructor(DOMString type, optional <a href=#pagetransitioneventinit id=the-pagetransitionevent-interface:pagetransitioneventinit>PageTransitionEventInit</a> eventInitDict = {});

  readonly attribute boolean <a href=#dom-pagetransitionevent-persisted id=the-pagetransitionevent-interface:dom-pagetransitionevent-persisted>persisted</a>;
};

dictionary <dfn id=pagetransitioneventinit>PageTransitionEventInit</dfn> : <a id=the-pagetransitionevent-interface:eventinit href=https://dom.spec.whatwg.org/#dictdef-eventinit data-x-internal=eventinit>EventInit</a> {
  boolean persisted = false;
};</code></pre>

  <dl class=domintro><dt><var>event</var> . <code id=dom-pagetransitionevent-persisted-dev><a href=#dom-pagetransitionevent-persisted>persisted</a></code><div class="mdn-anno wrapped before"><button onclick=toggleStatus(this) class=mdn-anno-btn><b title="Support in all current engines." class=all-engines-flag>✔</b><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/PageTransitionEvent/persisted title="The persisted read-only property indicates if a webpage is loading from a cache.">PageTransitionEvent/persisted</a><p class=all-engines-text>Support in all current engines.<div class=support><span class="firefox yes"><span>Firefox</span><span>11+</span></span><span class="safari yes"><span>Safari</span><span>5+</span></span><span class="chrome yes"><span>Chrome</span><span>4+</span></span><hr><span class="opera yes"><span>Opera</span><span>15+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>11</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>14+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>4+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>37+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>14+</span></span></div></div></div><dd>
    <p>For the <code id=the-pagetransitionevent-interface:event-pageshow><a href=indices.html#event-pageshow>pageshow</a></code> event, returns false if the page is
    newly being loaded (and the <code id=the-pagetransitionevent-interface:event-load><a href=indices.html#event-load>load</a></code> event will fire). Otherwise,
    returns true.</p>

    <p>For the <code id=the-pagetransitionevent-interface:event-pagehide><a href=indices.html#event-pagehide>pagehide</a></code> event, returns false if the page is
    going away for the last time. Otherwise, returns true, meaning that (if nothing conspires to
    make the page unsalvageable) the page might be reused if the user navigates back to this
    page.</p>

    <p>Things that can cause the page to be unsalvageable include:</p>

    <ul class=brief><li>The user agent decided to not keep the <code id=the-pagetransitionevent-interface:document><a href=dom.html#document>Document</a></code> alive in a <a id=the-pagetransitionevent-interface:session-history-entry href=history.html#session-history-entry>session
     history entry</a> after <a href=#unload-a-document id=the-pagetransitionevent-interface:unload-a-document>unload</a>
     <li>Having <code id=the-pagetransitionevent-interface:the-iframe-element><a href=iframe-embed-object.html#the-iframe-element>iframe</a></code>s that are not salvageable
     <li>Active <code id=the-pagetransitionevent-interface:websocket><a href=web-sockets.html#websocket>WebSocket</a></code> objects
     <li><a href=#abort-a-document id=the-pagetransitionevent-interface:abort-a-document>Aborting a <code>Document</code></a>
    </ul>
   </dl>

  

  <p>The <dfn id=dom-pagetransitionevent-persisted><code>persisted</code></dfn> attribute must
  return the value it was initialized to. It represents the context information for the event.</p>


  <h4 id=loading-documents><span class=secno>7.10.11</span> Loading documents<a href=#loading-documents class=self-link></a></h4>
<div data-zh-date="" data-en-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" class=translate-info data-zh-file="https://github.com/whatwg-cn/html/new/master/src/loading-web-pages/browsing-the-web/loading-documents.zh.html?filename=loading-documents.zh.html&amp;value=%E4%BB%8E%20https%3A%2F%2Fgithub.com%2Fwhatwg-cn%2Fhtml%2Fblob%2Fmaster%2Fsrc%2Floading-web-pages%2Fbrowsing-the-web%2Floading-documents.en.html%20%E6%8B%B7%E8%B4%9D%E8%8B%B1%E6%96%87%E6%BA%90%E7%A0%81%E8%87%B3%E6%AD%A4%EF%BC%8C%E5%BC%80%E5%A7%8B%E7%BF%BB%E8%AF%91" data-en-file=https://github.com/whatwg-cn/html/blob/master/src/loading-web-pages/browsing-the-web/loading-documents.en.html></div>

  <p>A <code id=loading-documents:document><a href=dom.html#document>Document</a></code> has a <dfn id=completely-loaded-time>completely loaded time</dfn> (a time or null), which is
  initially null.</p>

  <p>A <code id=loading-documents:document-2><a href=dom.html#document>Document</a></code> is considered <dfn id=completely-loaded>completely loaded</dfn> if its <a href=#completely-loaded-time id=loading-documents:completely-loaded-time>completely
  loaded time</a> is non-null.

  <p>To <dfn id=completely-finish-loading>completely finish loading</dfn> a <code id=loading-documents:document-3><a href=dom.html#document>Document</a></code> <var>document</var>:</p>

  <ol><li><p>Assert: <var>document</var>'s <a href=browsers.html#concept-document-bc id=loading-documents:concept-document-bc>browsing context</a>
   is non-null.<li><p>Set <var>document</var>'s <a href=#completely-loaded-time id=loading-documents:completely-loaded-time-2>completely loaded time</a> to the current
   time.<li><p>Let <var>container</var> be <var>document</var>'s <a href=browsers.html#concept-document-bc id=loading-documents:concept-document-bc-2>browsing context</a>'s <a href=browsers.html#bc-container id=loading-documents:bc-container>container</a>.<li><p>If <var>container</var> is an <code id=loading-documents:the-iframe-element><a href=iframe-embed-object.html#the-iframe-element>iframe</a></code> element, then <a id=loading-documents:queue-an-element-task href=webappapis.html#queue-an-element-task>queue an element
   task</a> on the <a id=loading-documents:dom-manipulation-task-source href=webappapis.html#dom-manipulation-task-source>DOM manipulation task source</a> given <var>container</var> to run
   the <a id=loading-documents:iframe-load-event-steps href=iframe-embed-object.html#iframe-load-event-steps>iframe load event steps</a> given <var>container</var>.<li><p>Otherwise, if <var>container</var> is non-null, then <a id=loading-documents:queue-an-element-task-2 href=webappapis.html#queue-an-element-task>queue an element task</a> on
   the <a id=loading-documents:dom-manipulation-task-source-2 href=webappapis.html#dom-manipulation-task-source>DOM manipulation task source</a> given <var>container</var> to <a href=https://dom.spec.whatwg.org/#concept-event-fire id=loading-documents:concept-event-fire data-x-internal=concept-event-fire>fire an event</a> named <code id=loading-documents:event-load><a href=indices.html#event-load>load</a></code> at
   <var>container</var>.</p>
  </ol>

  


  <h4 id=unloading-documents><span class=secno>7.10.12</span> Unloading documents<a href=#unloading-documents class=self-link></a></h4>
<div data-zh-date="" data-en-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" class=translate-info data-zh-file="https://github.com/whatwg-cn/html/new/master/src/loading-web-pages/browsing-the-web/unloading-documents/index.zh.html?filename=index.zh.html&amp;value=%E4%BB%8E%20https%3A%2F%2Fgithub.com%2Fwhatwg-cn%2Fhtml%2Fblob%2Fmaster%2Fsrc%2Floading-web-pages%2Fbrowsing-the-web%2Funloading-documents%2Findex.en.html%20%E6%8B%B7%E8%B4%9D%E8%8B%B1%E6%96%87%E6%BA%90%E7%A0%81%E8%87%B3%E6%AD%A4%EF%BC%8C%E5%BC%80%E5%A7%8B%E7%BF%BB%E8%AF%91" data-en-file=https://github.com/whatwg-cn/html/blob/master/src/loading-web-pages/browsing-the-web/unloading-documents/index.en.html></div>

  

  <p>A <code id=unloading-documents:document><a href=dom.html#document>Document</a></code> has a <dfn id=concept-document-salvageable><i>salvageable</i></dfn> state, which must initially be
  true, and a <dfn id=page-showing>page showing</dfn> flag, which must initially be false. The <a href=#page-showing id=unloading-documents:page-showing>page
  showing</a> flag is used to ensure that scripts receive <code id=unloading-documents:event-pageshow><a href=indices.html#event-pageshow>pageshow</a></code> and <code id=unloading-documents:event-pagehide><a href=indices.html#event-pagehide>pagehide</a></code> events
  in a consistent manner (e.g. that they never receive two <code id=unloading-documents:event-pagehide-2><a href=indices.html#event-pagehide>pagehide</a></code> events in a row without an intervening <code id=unloading-documents:event-pageshow-2><a href=indices.html#event-pageshow>pageshow</a></code>, or vice versa).</p>

  <p><a href=webappapis.html#event-loop id=unloading-documents:event-loop>Event loops</a> have a <dfn id=termination-nesting-level>termination nesting level</dfn>
  counter, which must initially be 0.</p>

  <p>To <dfn id=prompt-to-unload-a-document>prompt to unload</dfn>, given a <code id=unloading-documents:document-2><a href=dom.html#document>Document</a></code>
  object <var>document</var> and optionally a <var>recursiveFlag</var>, run these steps:</p>

  <ol><li><p>Increase the <a id=unloading-documents:event-loop-2 href=webappapis.html#event-loop>event loop</a>'s <a href=#termination-nesting-level id=unloading-documents:termination-nesting-level>termination nesting level</a> by
   1.<li><p>Increase the <var>document</var>'s <a id=unloading-documents:ignore-opens-during-unload-counter href=dynamic-markup-insertion.html#ignore-opens-during-unload-counter>ignore-opens-during-unload counter</a> by
   1.<li><p>Let <var>event</var> be the result of <a id=unloading-documents:creating-an-event href=https://dom.spec.whatwg.org/#concept-event-create data-x-internal=creating-an-event>creating an event</a> using
   <code id=unloading-documents:beforeunloadevent><a href=#beforeunloadevent>BeforeUnloadEvent</a></code>.<li><p>Initialize <var>event</var>'s <code id=unloading-documents:dom-event-type><a data-x-internal=dom-event-type href=https://dom.spec.whatwg.org/#dom-event-type>type</a></code> attribute to <code id=unloading-documents:event-beforeunload><a href=indices.html#event-beforeunload>beforeunload</a></code> and its <code id=unloading-documents:dom-event-cancelable><a data-x-internal=dom-event-cancelable href=https://dom.spec.whatwg.org/#dom-event-cancelable>cancelable</a></code> attribute true.<li><p><i>Dispatch</i>: <a href=https://dom.spec.whatwg.org/#concept-event-dispatch id=unloading-documents:concept-event-dispatch data-x-internal=concept-event-dispatch>Dispatch</a> <var>event</var> at
   <var>document</var>'s <a id=unloading-documents:concept-relevant-global href=webappapis.html#concept-relevant-global>relevant global object</a>.<li><p>Decrease the <a id=unloading-documents:event-loop-3 href=webappapis.html#event-loop>event loop</a>'s <a href=#termination-nesting-level id=unloading-documents:termination-nesting-level-2>termination nesting level</a> by
   1.<li>
    <p>If <var>document</var>'s <a id=unloading-documents:active-sandboxing-flag-set href=origin.html#active-sandboxing-flag-set>active sandboxing flag set</a> does not have its
    <a id=unloading-documents:sandboxed-modals-flag href=origin.html#sandboxed-modals-flag>sandboxed modals flag</a> set, and the <code id=unloading-documents:dom-beforeunloadevent-returnvalue><a href=#dom-beforeunloadevent-returnvalue>returnValue</a></code> attribute of the <var>event</var>
    object is not the empty string, or if the event was canceled, then the user agent may ask the
    user to confirm that they wish to unload the document.</p>

    <p class=note>The message shown to the user is not customizable, but instead determined by
    the user agent. In particular, the actual value of the <code id=unloading-documents:dom-beforeunloadevent-returnvalue-2><a href=#dom-beforeunloadevent-returnvalue>returnValue</a></code> attribute is ignored.</p>

    <p>The user agent is encouraged to avoid asking the user for confirmation if it judges that
    doing so would be annoying, deceptive, or pointless. A simple heuristic might be that if the
    user has not interacted with the document, the user agent would not ask for confirmation before
    unloading it.</p>

    <p>If the user agent asks the user for confirmation, it must <a id=unloading-documents:pause href=webappapis.html#pause>pause</a> while waiting
    for the user's response.</p>

    <p>If the user did not confirm the page navigation, then the user agent <dfn id=refused-to-allow-the-document-to-be-unloaded>refused to allow
    the document to be unloaded</dfn>.</p>
   <li>
    <p>If the <var>recursiveFlag</var> is not set, then:</p>

    <ol><li><p>Let <var>descendants</var> be the <a id=unloading-documents:list-of-the-descendant-browsing-contexts href=browsers.html#list-of-the-descendant-browsing-contexts>list of the descendant browsing contexts</a>
     of <var>document</var>.<li>
      <p>For each <var>browsingContext</var> in <var>descendants</var>:</p>

      <ol><li><p><a href=#prompt-to-unload-a-document id=unloading-documents:prompt-to-unload-a-document>Prompt to unload</a> <var>browsingContext</var>'s <a id=unloading-documents:active-document href=browsers.html#active-document>active
       document</a> with the <var>recursiveFlag</var> set.<li><p>If the user <a href=#refused-to-allow-the-document-to-be-unloaded id=unloading-documents:refused-to-allow-the-document-to-be-unloaded>refused to allow the document to be unloaded</a>, then the user
       implicitly also <a href=#refused-to-allow-the-document-to-be-unloaded id=unloading-documents:refused-to-allow-the-document-to-be-unloaded-2>refused to allow
       <var>document</var> to be unloaded</a>; <a id=unloading-documents:break href=https://infra.spec.whatwg.org/#iteration-break data-x-internal=break>break</a>.</ol>
     </ol>
   <li><p>Decrease the <var>document</var>'s <a id=unloading-documents:ignore-opens-during-unload-counter-2 href=dynamic-markup-insertion.html#ignore-opens-during-unload-counter>ignore-opens-during-unload counter</a> by
   1.</ol>

  <p>To <dfn id=unload-a-document data-lt="unload a document" data-export="">unload</dfn> a
  <code id=unloading-documents:document-3><a href=dom.html#document>Document</a></code> <var>document</var>, optionally given a <var>recursiveFlag</var>:</p>

  <ol><li><p>Increase the <a id=unloading-documents:event-loop-4 href=webappapis.html#event-loop>event loop</a>'s <a href=#termination-nesting-level id=unloading-documents:termination-nesting-level-3>termination nesting level</a> by
   one.<li><p>Increase <var>document</var>'s <a id=unloading-documents:ignore-opens-during-unload-counter-3 href=dynamic-markup-insertion.html#ignore-opens-during-unload-counter>ignore-opens-during-unload counter</a> by
   one.<li><p>If <var>document</var>'s <a href=#page-showing id=unloading-documents:page-showing-2>page showing</a> flag is false, then jump to the
   step labeled <i>unload event</i> below (i.e. skip firing the <code id=unloading-documents:event-pagehide-3><a href=indices.html#event-pagehide>pagehide</a></code> event and don't rerun the <a href=#unloading-document-visibility-change-steps id=unloading-documents:unloading-document-visibility-change-steps>unloading document
   visibility change steps</a>).<li><p>Set <var>document</var>'s <a href=#page-showing id=unloading-documents:page-showing-3>page showing</a> flag to false.<li><p>If the user agent does not intend to keep <var>document</var> alive
   in a <a id=unloading-documents:session-history-entry href=history.html#session-history-entry>session history entry</a> (such that it can be reused later on <a href=#traverse-the-history id=unloading-documents:traverse-the-history>history traversal</a>), set <var>document</var>'s
   <i id=unloading-documents:concept-document-salvageable><a href=#concept-document-salvageable>salvageable</a></i> state to false.<li><p><a href=https://dom.spec.whatwg.org/#concept-event-fire id=unloading-documents:concept-event-fire data-x-internal=concept-event-fire>Fire an event</a> named <code id=unloading-documents:event-pagehide-4><a href=indices.html#event-pagehide>pagehide</a></code> at <var>document</var>'s <a id=unloading-documents:concept-relevant-global-2 href=webappapis.html#concept-relevant-global>relevant global
   object</a>, using <code id=unloading-documents:pagetransitionevent><a href=#pagetransitionevent>PageTransitionEvent</a></code>, with the <code id=unloading-documents:dom-pagetransitionevent-persisted><a href=#dom-pagetransitionevent-persisted>persisted</a></code> attribute initialized to true if
   <var>document</var>'s <i id=unloading-documents:concept-document-salvageable-2><a href=#concept-document-salvageable>salvageable</a></i> state is
   true, and false otherwise, and <var>legacy target override flag</var> set.<li>
    <p>Run any <dfn id=unloading-document-visibility-change-steps>unloading document visibility change steps</dfn> for <var>document</var> that
    are defined by <a id=unloading-documents:other-applicable-specifications href=infrastructure.html#other-applicable-specifications>other applicable specifications</a>.</p>

    <p class=note>This is specifically intended for use by <cite>Page Visibility</cite>.
    <a href=references.html#refsPAGEVIS>[PAGEVIS]</a></p>
   <li><p><i>Unload event</i>: If <var>document</var>'s <i id=unloading-documents:concept-document-salvageable-3><a href=#concept-document-salvageable>salvageable</a></i> state is false, then <a href=https://dom.spec.whatwg.org/#concept-event-fire id=unloading-documents:concept-event-fire-2 data-x-internal=concept-event-fire>fire an event</a> named <code id=unloading-documents:event-unload><a href=indices.html#event-unload>unload</a></code>
   at <var>document</var>'s <a id=unloading-documents:concept-relevant-global-3 href=webappapis.html#concept-relevant-global>relevant global object</a>, with <var>legacy target override
   flag</var> set.<li><p>Decrease the <a id=unloading-documents:event-loop-5 href=webappapis.html#event-loop>event loop</a>'s <a href=#termination-nesting-level id=unloading-documents:termination-nesting-level-4>termination nesting level</a> by
   one.<li><p>Run any <a href=#unloading-document-cleanup-steps id=unloading-documents:unloading-document-cleanup-steps>unloading document cleanup steps</a> for <var>document</var> that are
   defined by this specification and <a id=unloading-documents:other-applicable-specifications-2 href=infrastructure.html#other-applicable-specifications>other applicable specifications</a>.<li>
    <p>If the <var>recursiveFlag</var> is not set, then:</p>

    <ol><li><p>Let <var>descendants</var> be the <a id=unloading-documents:list-of-the-descendant-browsing-contexts-2 href=browsers.html#list-of-the-descendant-browsing-contexts>list of the descendant browsing
     contexts</a> of <var>document</var>.<li>
      <p>For each <var>browsingContext</var> in <var>descendants</var>:</p>

      <ol><li><p><a href=#unload-a-document id=unloading-documents:unload-a-document>Unload</a> the <a id=unloading-documents:active-document-2 href=browsers.html#active-document>active document</a> of
       <var>browsingContext</var> with the <var>recursiveFlag</var> set.<li><p>If the <i id=unloading-documents:concept-document-salvageable-4><a href=#concept-document-salvageable>salvageable</a></i> state of the
       <a id=unloading-documents:active-document-3 href=browsers.html#active-document>active document</a> of <var>browsingContext</var> is false, then set the
       <i id=unloading-documents:concept-document-salvageable-5><a href=#concept-document-salvageable>salvageable</a></i> state of <var>document</var> to
       false also.</ol>
     <li><p>If <var>document</var>'s <i id=unloading-documents:concept-document-salvageable-6><a href=#concept-document-salvageable>salvageable</a></i> state
     is false, then <a href=window-object.html#discard-a-document id=unloading-documents:discard-a-document>discard</a><var>document</var>.</ol>
   <li><p>Decrease <var>document</var>'s <a id=unloading-documents:ignore-opens-during-unload-counter-4 href=dynamic-markup-insertion.html#ignore-opens-during-unload-counter>ignore-opens-during-unload counter</a> by
   one.</ol>

  <p>This specification defines the following <dfn id=unloading-document-cleanup-steps data-export="">unloading document cleanup steps</dfn>.
  Other specifications can define more.  Given a <code id=unloading-documents:document-4><a href=dom.html#document>Document</a></code> <var>document</var>:</p>

  <ol><li><p>Let <var>window</var> be <var>document</var>'s <a id=unloading-documents:concept-relevant-global-4 href=webappapis.html#concept-relevant-global>relevant global
   object</a>.<li>
    <p>For each <code id=unloading-documents:websocket><a href=web-sockets.html#websocket>WebSocket</a></code> object <var>webSocket</var> whose <a id=unloading-documents:concept-relevant-global-5 href=webappapis.html#concept-relevant-global>relevant global
    object</a> is <var>window</var>, <a id=unloading-documents:make-disappear href=web-sockets.html#make-disappear>make disappear</a> <var>webSocket</var>.</p>

    <p>If this affected any <code id=unloading-documents:websocket-2><a href=web-sockets.html#websocket>WebSocket</a></code> objects, then set <var>document</var>'s <i id=unloading-documents:concept-document-salvageable-7><a href=#concept-document-salvageable>salvageable</a></i> state to false.</p>
   <li>
    <p>If <var>document</var>'s <i id=unloading-documents:concept-document-salvageable-8><a href=#concept-document-salvageable>salvageable</a></i>
    state is false, then:</p>

    <ol><li><p>For each <code id=unloading-documents:eventsource><a href=server-sent-events.html#eventsource>EventSource</a></code> object <var>eventSource</var> whose <a id=unloading-documents:concept-relevant-global-6 href=webappapis.html#concept-relevant-global>relevant
     global object</a> is equal to <var>window</var>, <a href=server-sent-events.html#concept-eventsource-forcibly-close id=unloading-documents:concept-eventsource-forcibly-close>forcibly close</a>
     <var>eventSource</var>.<li><p>Empty <var>window</var>'s <a id=unloading-documents:list-of-active-timers href=timers-and-user-prompts.html#list-of-active-timers>list of active timers</a>.</ol>
   </ol>

  




  <h5 id=the-beforeunloadevent-interface><span class=secno>7.10.12.1</span> The <code id=the-beforeunloadevent-interface:beforeunloadevent><a href=#beforeunloadevent>BeforeUnloadEvent</a></code> interface<a href=#the-beforeunloadevent-interface class=self-link></a></h5><div class="mdn-anno wrapped"><button onclick=toggleStatus(this) class=mdn-anno-btn><b title="Support in all current engines." class=all-engines-flag>✔</b><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/BeforeUnloadEvent title="The beforeunload event is fired when the window, the document and its resources are about to be unloaded.">BeforeUnloadEvent</a><p class=all-engines-text>Support in all current engines.<div class=support><span class="firefox yes"><span>Firefox</span><span>1.5+</span></span><span class="safari yes"><span>Safari</span><span>7+</span></span><span class="chrome yes"><span>Chrome</span><span>30+</span></span><hr><span class="opera yes"><span>Opera</span><span>17+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>4+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>7+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>30+</span></span><span class="webview_android yes"><span>WebView Android</span><span>37+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>3.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>18+</span></span></div></div></div>
<div data-zh-date="" data-en-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" class=translate-info data-zh-file="https://github.com/whatwg-cn/html/new/master/src/loading-web-pages/browsing-the-web/unloading-documents/the-beforeunloadevent-interface.zh.html?filename=the-beforeunloadevent-interface.zh.html&amp;value=%E4%BB%8E%20https%3A%2F%2Fgithub.com%2Fwhatwg-cn%2Fhtml%2Fblob%2Fmaster%2Fsrc%2Floading-web-pages%2Fbrowsing-the-web%2Funloading-documents%2Fthe-beforeunloadevent-interface.en.html%20%E6%8B%B7%E8%B4%9D%E8%8B%B1%E6%96%87%E6%BA%90%E7%A0%81%E8%87%B3%E6%AD%A4%EF%BC%8C%E5%BC%80%E5%A7%8B%E7%BF%BB%E8%AF%91" data-en-file=https://github.com/whatwg-cn/html/blob/master/src/loading-web-pages/browsing-the-web/unloading-documents/the-beforeunloadevent-interface.en.html></div>

  <pre><code class=idl>[Exposed=Window]
interface <dfn id=beforeunloadevent>BeforeUnloadEvent</dfn> : <a id=the-beforeunloadevent-interface:event href=https://dom.spec.whatwg.org/#interface-event data-x-internal=event>Event</a> {
  attribute DOMString <a href=#dom-beforeunloadevent-returnvalue id=the-beforeunloadevent-interface:dom-beforeunloadevent-returnvalue>returnValue</a>;
};</code></pre>

  <p class=note>There are no <code id=the-beforeunloadevent-interface:beforeunloadevent-2><a href=#beforeunloadevent>BeforeUnloadEvent</a></code>-specific initialization methods.</p>

  <p>The <code id=the-beforeunloadevent-interface:beforeunloadevent-3><a href=#beforeunloadevent>BeforeUnloadEvent</a></code> interface is a legacy interface which allows <a href=#prompt-to-unload-a-document id=the-beforeunloadevent-interface:prompt-to-unload-a-document>prompting to unload</a> to be controlled not only by canceling the
  event, but by setting the <code id=the-beforeunloadevent-interface:dom-beforeunloadevent-returnvalue-2><a href=#dom-beforeunloadevent-returnvalue>returnValue</a></code>
  attribute to a value besides the empty string. Authors should use the <code id=the-beforeunloadevent-interface:dom-event-preventdefault><a data-x-internal=dom-event-preventdefault href=https://dom.spec.whatwg.org/#dom-event-preventdefault>preventDefault()</a></code> method, or other means of canceling
  events, instead of using <code id=the-beforeunloadevent-interface:dom-beforeunloadevent-returnvalue-3><a href=#dom-beforeunloadevent-returnvalue>returnValue</a></code>.</p>

  

  <p>The <dfn id=dom-beforeunloadevent-returnvalue><code>returnValue</code></dfn> attribute
  controls the process of <a href=#prompt-to-unload-a-document id=the-beforeunloadevent-interface:prompt-to-unload-a-document-2>prompting to unload</a>. When the event
  is created, the attribute must be set to the empty string. On getting, it must return the last
  value it was set to. On setting, the attribute must be set to the new value.</p>

  <p class=note>This attribute is a <code>DOMString</code> only for historical reasons.
  Any value besides the empty string will be treated as a request to ask the user for
  confirmation.</p>

  


  


  <h4 id=aborting-a-document-load><span class=secno>7.10.13</span> Aborting a document load<a href=#aborting-a-document-load class=self-link></a></h4>
<div data-zh-date="" data-en-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" class=translate-info data-zh-file="https://github.com/whatwg-cn/html/new/master/src/loading-web-pages/browsing-the-web/aborting-a-document-load.zh.html?filename=aborting-a-document-load.zh.html&amp;value=%E4%BB%8E%20https%3A%2F%2Fgithub.com%2Fwhatwg-cn%2Fhtml%2Fblob%2Fmaster%2Fsrc%2Floading-web-pages%2Fbrowsing-the-web%2Faborting-a-document-load.en.html%20%E6%8B%B7%E8%B4%9D%E8%8B%B1%E6%96%87%E6%BA%90%E7%A0%81%E8%87%B3%E6%AD%A4%EF%BC%8C%E5%BC%80%E5%A7%8B%E7%BF%BB%E8%AF%91" data-en-file=https://github.com/whatwg-cn/html/blob/master/src/loading-web-pages/browsing-the-web/aborting-a-document-load.en.html></div>

  <p>To <dfn id=abort-a-document>abort</dfn> a <code id=aborting-a-document-load:document><a href=dom.html#document>Document</a></code> <var>document</var>:</p>

  <ol><li><p><a href=#abort-a-document id=aborting-a-document-load:abort-a-document>Abort</a> the <a href=browsers.html#active-document id=aborting-a-document-load:active-document>active
   documents</a> of every <a id=aborting-a-document-load:child-browsing-context href=browsers.html#child-browsing-context>child browsing context</a>. If this results in any of those
   <code id=aborting-a-document-load:document-2><a href=dom.html#document>Document</a></code> objects having their <i id=aborting-a-document-load:concept-document-salvageable><a href=#concept-document-salvageable>salvageable</a></i> state set to false, then set
   <var>document</var>'s <i id=aborting-a-document-load:concept-document-salvageable-2><a href=#concept-document-salvageable>salvageable</a></i> state to false
   also.<li><p>Cancel any instances of the <a href=https://fetch.spec.whatwg.org/#concept-fetch id=aborting-a-document-load:concept-fetch data-x-internal=concept-fetch>fetch</a> algorithm in the
   context of <var>document</var>, discarding any <a href=webappapis.html#concept-task id=aborting-a-document-load:concept-task>tasks</a>
   <a href=webappapis.html#queue-a-task id=aborting-a-document-load:queue-a-task>queued</a> for them, and discarding any further data received from
   the network for them. If this resulted in any instances of the <a href=https://fetch.spec.whatwg.org/#concept-fetch id=aborting-a-document-load:concept-fetch-2 data-x-internal=concept-fetch>fetch</a> algorithm being canceled or any <a href=webappapis.html#queue-a-task id=aborting-a-document-load:queue-a-task-2>queued</a> <a href=webappapis.html#concept-task id=aborting-a-document-load:concept-task-2>tasks</a> or any network data getting
   discarded, then set <var>document</var>'s <i id=aborting-a-document-load:concept-document-salvageable-3><a href=#concept-document-salvageable>salvageable</a></i> state to false.<li>
    <p>If <var>document</var> has an <a id=aborting-a-document-load:active-parser href=dom.html#active-parser>active parser</a>, then:</p>

    <ol><li><p>Set <var>document</var>'s <a id=aborting-a-document-load:active-parser-was-aborted href=dynamic-markup-insertion.html#active-parser-was-aborted>active parser was aborted</a> to true.<li><p><a href=parsing.html#abort-a-parser id=aborting-a-document-load:abort-a-parser>Abort that parser</a>.<li><p>Set <var>document</var>'s <i id=aborting-a-document-load:concept-document-salvageable-4><a href=#concept-document-salvageable>salvageable</a></i> state
     to false.</ol>
   </ol>

  <p>User agents may allow users to explicitly invoke the <a href=#abort-a-document id=aborting-a-document-load:abort-a-document-2>abort a
  document</a> algorithm for a <code id=aborting-a-document-load:document-3><a href=dom.html#document>Document</a></code>. If the user does so, then, if that
  <code id=aborting-a-document-load:document-4><a href=dom.html#document>Document</a></code> is an <a id=aborting-a-document-load:active-document-2 href=browsers.html#active-document>active document</a>, the user agent should <a id=aborting-a-document-load:queue-a-task-3 href=webappapis.html#queue-a-task>queue a
  task</a> to <a href=https://dom.spec.whatwg.org/#concept-event-fire id=aborting-a-document-load:concept-event-fire data-x-internal=concept-event-fire>fire an event</a> named <code id=aborting-a-document-load:event-abort><a href=indices.html#event-abort>abort</a></code> at that <code id=aborting-a-document-load:document-5><a href=dom.html#document>Document</a></code> object's <a id=aborting-a-document-load:concept-relevant-global href=webappapis.html#concept-relevant-global>relevant global
  object</a> before invoking the <a href=#abort-a-document id=aborting-a-document-load:abort-a-document-3>abort</a> algorithm.</p>

  

  <p>To <dfn id=stop-document-loading>stop document loading</dfn> given a <code id=aborting-a-document-load:document-6><a href=dom.html#document>Document</a></code> object <var>document</var>,
  run these steps:</p>

  <ol><li><p>If <var>document</var> is not an <a id=aborting-a-document-load:active-document-3 href=browsers.html#active-document>active document</a>, then return.<li><p>Let <var>browsingContext</var> be <var>document</var>'s <a href=browsers.html#concept-document-bc id=aborting-a-document-load:concept-document-bc>browsing context</a>.<li><p>If there is an existing attempt to <a href=#navigate id=aborting-a-document-load:navigate>navigate</a> <var>browsingContext</var> and
   that attempt is not currently running the <a href=#unload-a-document id=aborting-a-document-load:unload-a-document>unload a document</a> algorithm, then cancel
   that <a href=#navigate id=aborting-a-document-load:navigate-2>navigation</a>.<li><p><a href=#abort-a-document id=aborting-a-document-load:abort-a-document-4>Abort</a> <var>document</var>.</ol>

  


  <h4 id=the-x-frame-options-header><span class=secno>7.10.14</span> The `<code id=the-x-frame-options-header:x-frame-options><a href=iana.html#x-frame-options>X-Frame-Options</a></code>` header<a href=#the-x-frame-options-header class=self-link></a></h4>
<div data-zh-date="" data-en-date="Wed Nov 04 2020 06:47:17 GMT+0000 (UTC)" class=translate-info data-zh-file="https://github.com/whatwg-cn/html/new/master/src/loading-web-pages/browsing-the-web/the-x-frame-options-header.zh.html?filename=the-x-frame-options-header.zh.html&amp;value=%E4%BB%8E%20https%3A%2F%2Fgithub.com%2Fwhatwg-cn%2Fhtml%2Fblob%2Fmaster%2Fsrc%2Floading-web-pages%2Fbrowsing-the-web%2Fthe-x-frame-options-header.en.html%20%E6%8B%B7%E8%B4%9D%E8%8B%B1%E6%96%87%E6%BA%90%E7%A0%81%E8%87%B3%E6%AD%A4%EF%BC%8C%E5%BC%80%E5%A7%8B%E7%BF%BB%E8%AF%91" data-en-file=https://github.com/whatwg-cn/html/blob/master/src/loading-web-pages/browsing-the-web/the-x-frame-options-header.en.html></div>

  <p>The `<code id=the-x-frame-options-header:x-frame-options-2><a href=iana.html#x-frame-options>X-Frame-Options</a></code>` HTTP response header is a legacy way of controlling whether
  and how a <code id=the-x-frame-options-header:document><a href=dom.html#document>Document</a></code> may be loaded inside of a <a id=the-x-frame-options-header:child-browsing-context href=browsers.html#child-browsing-context>child browsing context</a>. It
  is obsoleted by the <code id=the-x-frame-options-header:frame-ancestors-directive><a data-x-internal=frame-ancestors-directive href=https://w3c.github.io/webappsec-csp/#frame-ancestors>frame-ancestors</a></code> CSP directive,
  which provides more granular control over the same situations. It was originally defined in
  <cite>HTTP Header Field X-Frame-Options</cite>, but the definition and processing
  model here supersedes that document. <a href=references.html#refsCSP>[CSP]</a> <a href=references.html#refsRFC7034>[RFC7034]</a>

  <p class=note>In particular, <cite>HTTP Header Field X-Frame-Options</cite> specified an `<code>ALLOW-FROM</code>` variant of the header, but that is not to be implemented.</p>

  <p class=note>Per the below processing model, if
  both a CSP <code id=the-x-frame-options-header:frame-ancestors-directive-2><a data-x-internal=frame-ancestors-directive href=https://w3c.github.io/webappsec-csp/#frame-ancestors>frame-ancestors</a></code> directive and an
  `<code id=the-x-frame-options-header:x-frame-options-3><a href=iana.html#x-frame-options>X-Frame-Options</a></code>` header are used in the same <a href=https://fetch.spec.whatwg.org/#concept-response id=the-x-frame-options-header:concept-response data-x-internal=concept-response>response</a>, then `<code id=the-x-frame-options-header:x-frame-options-4><a href=iana.html#x-frame-options>X-Frame-Options</a></code>` is ignored.</p>

  <p>For web developers and conformance checkers, its value <a href=https://fetch.spec.whatwg.org/#abnf id=the-x-frame-options-header:header-abnf data-x-internal=header-abnf>ABNF</a>
  is:</p>

  <pre><code class=abnf>X-Frame-Options = "DENY" / "SAMEORIGIN"</code></pre>

  

  <p>To <dfn id="check-a-navigation-response's-adherence-to-x-frame-options">check a navigation response's adherence to `<code>X-Frame-Options</code>`</dfn>, given
  a <a href=https://fetch.spec.whatwg.org/#concept-response id=the-x-frame-options-header:concept-response-2 data-x-internal=concept-response>response</a> <var>response</var>, a <a id=the-x-frame-options-header:browsing-context href=browsers.html#browsing-context>browsing
  context</a> <var>browsingContext</var>, and an <a id=the-x-frame-options-header:concept-origin href=origin.html#concept-origin>origin</a>
  <var>destinationOrigin</var>:</p>

  <ol><li><p>If <var>browsingContext</var> is not a <a id=the-x-frame-options-header:child-browsing-context-2 href=browsers.html#child-browsing-context>child browsing context</a>, then return
   true.<li>
    <p><a href=https://infra.spec.whatwg.org/#list-iterate id=the-x-frame-options-header:list-iterate data-x-internal=list-iterate>For each</a> <var>policy</var> of <var>response</var>'s <a href=https://fetch.spec.whatwg.org/#concept-response-csp-list id=the-x-frame-options-header:concept-response-csp-list data-x-internal=concept-response-csp-list>CSP list</a>:</p>

    <ol><li><p>If <var>policy</var>'s <a href=https://w3c.github.io/webappsec-csp/#policy-disposition id=the-x-frame-options-header:csp-disposition data-x-internal=csp-disposition>disposition</a> is not "<code>enforce</code>", then <a id=the-x-frame-options-header:continue href=https://infra.spec.whatwg.org/#iteration-continue data-x-internal=continue>continue</a>.<li><p>If <var>policy</var>'s <a href=https://w3c.github.io/webappsec-csp/#policy-directive-set id=the-x-frame-options-header:csp-directive-set data-x-internal=csp-directive-set>directive set</a> <a href=https://infra.spec.whatwg.org/#list-contain id=the-x-frame-options-header:list-contains data-x-internal=list-contains>contains</a> a <code id=the-x-frame-options-header:frame-ancestors-directive-3><a data-x-internal=frame-ancestors-directive href=https://w3c.github.io/webappsec-csp/#frame-ancestors>frame-ancestors</a></code> directive, then return true.</ol>
   <li><p>Let <var>rawXFrameOptions</var> be the result of <a href=https://fetch.spec.whatwg.org/#concept-header-list-get-decode-split id=the-x-frame-options-header:concept-header-list-get-decode-split data-x-internal=concept-header-list-get-decode-split>getting, decoding, and splitting</a>
   `<code id=the-x-frame-options-header:x-frame-options-5><a href=iana.html#x-frame-options>X-Frame-Options</a></code>` from <var>response</var>'s <a href=https://fetch.spec.whatwg.org/#concept-response-header-list id=the-x-frame-options-header:concept-response-header-list data-x-internal=concept-response-header-list>header list</a>.<li><p>Let <var>xFrameOptions</var> be a new <a id=the-x-frame-options-header:set href=https://infra.spec.whatwg.org/#ordered-set data-x-internal=set>set</a>.<li><p><a href=https://infra.spec.whatwg.org/#list-iterate id=the-x-frame-options-header:list-iterate-2 data-x-internal=list-iterate>For each</a> <var>value</var> of
   <var>rawXFrameOptions</var>, <a href=https://infra.spec.whatwg.org/#set-append id=the-x-frame-options-header:set-append data-x-internal=set-append>append</a> <var>value</var>,
   <a id=the-x-frame-options-header:converted-to-ascii-lowercase href=https://infra.spec.whatwg.org/#ascii-lowercase data-x-internal=converted-to-ascii-lowercase>converted to ASCII lowercase</a>, to <var>xFrameOptions</var>.<li>
    <p>If <var>xFrameOptions</var>'s <a href=https://infra.spec.whatwg.org/#list-size id=the-x-frame-options-header:list-size data-x-internal=list-size>size</a> is greater than 1, and
    <var>xFrameOptions</var> <a href=https://infra.spec.whatwg.org/#list-contain id=the-x-frame-options-header:list-contains-2 data-x-internal=list-contains>contains</a> any of "<code>deny</code>", "<code>allowall</code>", or "<code>sameorigin</code>", then return false.</p>

    <p class=note>The intention here is to block any attempts at applying
    `<code id=the-x-frame-options-header:x-frame-options-6><a href=iana.html#x-frame-options>X-Frame-Options</a></code>` which were trying to do something valid, but appear confused.</p>

    <p class=note>This is the only impact of the legacy `<code>ALLOWALL</code>` value
    on the processing model.</p>
   <li>
    <p>If <var>xFrameOptions</var>'s <a href=https://infra.spec.whatwg.org/#list-size id=the-x-frame-options-header:list-size-2 data-x-internal=list-size>size</a> is greater than 1, then
    return true.</p>

    <p class=note>This means it contains multiple invalid values, which we treat the same way as
    if the header was omitted entirely.</p>
   <li><p>If <var>xFrameOptions</var>[0] is "<code>deny</code>", then return
   false.<li>
    <p>If <var>xFrameOptions</var>[0] is "<code>sameorigin</code>", then:</p>

    <ol><li><p>Let <var>containerDocument</var> be <var>browsingContext</var>'s <a href=browsers.html#bc-container-document id=the-x-frame-options-header:bc-container-document>container document</a>.<li>
      <p><a id=the-x-frame-options-header:while href=https://infra.spec.whatwg.org/#iteration-while data-x-internal=while>While</a> <var>containerDocument</var> is not null:</p>

      <ol><li><p>If <var>containerDocument</var>'s <a id=the-x-frame-options-header:concept-origin-2 href=origin.html#concept-origin>origin</a> is not <a id=the-x-frame-options-header:same-origin href=origin.html#same-origin>same origin</a>
       with <var>destinationOrigin</var>, then return false.<li><p>Let <var>containerBC</var> be <var>containerDocument</var>'s <a href=browsers.html#concept-document-bc id=the-x-frame-options-header:concept-document-bc>browsing context</a>.</p>

       <li><p>Set <var>containerDocument</var> to <var>containerBC</var>'s <a href=browsers.html#bc-container-document id=the-x-frame-options-header:bc-container-document-2>container document</a>, if <var>containerBC</var> is
       non-null; otherwise, null.</ol>
     </ol>
   <li>
    <p>Return true.</p>

    <p class=note>If we've reached this point then we have a lone invalid value (which could
    potentially be one the legacy `<code>ALLOWALL</code>` or `<code>ALLOW-FROM</code>` forms). These are treated as if the header were omitted
    entirely.</p>
   </ol>

  <hr>

  

  <div class=example>
   <p>The following table illustrates the processing of various values for the header, including
   non-conformant ones:</p>

   <table class=data><thead><tr><th>`<code id=the-x-frame-options-header:x-frame-options-7><a href=iana.html#x-frame-options>X-Frame-Options</a></code>`<th>Valid<th>Result<tbody><tr><td>`<code>DENY</code>`<td>✅<td>embedding disallowed<tr><td>`<code>SAMEORIGIN</code>`<td>✅<td>same-origin embedding allowed<tr><td>`<code>INVALID</code>`<td>❌<td>embedding allowed<tr><td>`<code>ALLOWALL</code>`<td>❌<td>embedding allowed<tr><td>`<code>ALLOW-FROM=https://example.com/</code>`<td>❌<td>embedding allowed (from anywhere)</table>
  </div>

  <div class=example>
   <p>The following table illustrates how various non-conformant cases involving multiple values are
   processed:</p>

   <table class=data><thead><tr><th>`<code id=the-x-frame-options-header:x-frame-options-8><a href=iana.html#x-frame-options>X-Frame-Options</a></code>`<th>Result<tbody><tr><td>`<code>SAMEORIGIN, SAMEORIGIN</code>`<td>same-origin embedding allowed<tr><td>`<code>SAMEORIGIN, DENY</code>`<td>embedding disallowed<tr><td>`<code>SAMEORIGIN,</code>`<td>embedding disallowed<tr><td>`<code>SAMEORIGIN, ALLOWALL</code>`<td>embedding disallowed<tr><td>`<code>SAMEORIGIN, INVALID</code>`<td>embedding disallowed<tr><td>`<code>ALLOWALL, INVALID</code>`<td>embedding disallowed<tr><td>`<code>ALLOWALL,</code>`<td>embedding disallowed<tr><td>`<code>INVALID, INVALID</code>`<td>embedding allowed</table>

   <p>The same results are obtained whether the values are delivered in a single header whose value is comma-delimited,
   or in multiple headers.</p>
  </div>




  <nav><a href=history.html>← 7.9 Session history and navigation</a> — <a href=./>Table of Contents</a> — <a href=offline.html>7.11 Offline web applications →</a></nav>
<script src=/html/resources/zh-cn.js></script>
